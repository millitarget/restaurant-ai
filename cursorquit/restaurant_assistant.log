2025-03-17 22:52:27,737 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for sandbox contextual-node-16jzjr
2025-03-17 22:52:27,833 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 22:52:27,839 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-17 22:52:29,116 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 22:52:29,242 - livekit.agents - INFO - starting worker
2025-03-17 22:52:29,577 - livekit.agents - INFO - registered worker
2025-03-17 22:52:29,578 - livekit.agents - INFO - connecting to room contextual-node-16jzjr
2025-03-17 22:52:30,245 - livekit.agents - INFO - received job request
2025-03-17 22:52:30,303 - livekit.agents - INFO - received job request
2025-03-17 22:52:30,316 - livekit.agents - INFO - initializing job runner
2025-03-17 22:52:30,317 - livekit.agents - INFO - job runner initialized
2025-03-17 22:52:30,320 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 22:52:30,324 - portuguese-restaurant-assistant - INFO - Starting restaurant voice assistant...
2025-03-17 22:52:30,326 - portuguese-restaurant-assistant - INFO - Testing API connections...
2025-03-17 22:52:30,356 - portuguese-restaurant-assistant - INFO - Fixed: Copied ELEVEN_API_KEY to ELEVENLABS_API_KEY
2025-03-17 22:52:30,383 - livekit.agents - INFO - initializing job runner
2025-03-17 22:52:30,385 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-17 22:52:30,386 - livekit.agents - INFO - job runner initialized
2025-03-17 22:52:30,388 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 22:52:30,390 - portuguese-restaurant-assistant - INFO - Starting restaurant voice assistant...
2025-03-17 22:52:30,391 - portuguese-restaurant-assistant - INFO - Testing API connections...
2025-03-17 22:52:30,405 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-17 22:52:30,413 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-17 22:52:30,431 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-17 22:52:30,451 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-17 22:52:30,452 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-17 22:52:30,524 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-17 22:52:30,525 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-17 22:52:30,526 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-17 22:52:30,527 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-17 22:52:30,535 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-17 22:52:30,536 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-17 22:52:30,537 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-17 22:52:30,538 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-17 22:52:30,605 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-17 22:52:30,607 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-17 22:52:30,607 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-17 22:52:30,609 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-17 22:52:30,628 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-17 22:52:30,629 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-17 22:52:30,630 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-17 22:52:30,631 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-17 22:52:30,767 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-17 22:52:30,795 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-17 22:52:31,114 - portuguese-restaurant-assistant - INFO - Connected to LiveKit room
2025-03-17 22:52:31,115 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-17 22:52:32,194 - portuguese-restaurant-assistant - INFO - Connected to LiveKit room
2025-03-17 22:52:32,195 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-17 23:02:41,293 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:02:41,300 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-17 23:02:43,932 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:02:43,943 - livekit.agents - INFO - starting worker
2025-03-17 23:02:44,341 - livekit.agents - INFO - registered worker
2025-03-17 23:03:01,919 - livekit.agents - INFO - received job request
2025-03-17 23:03:01,981 - livekit.agents - INFO - initializing job runner
2025-03-17 23:03:02,360 - livekit.agents - INFO - job runner initialized
2025-03-17 23:03:02,363 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:03:02,366 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-haxrrEEGWo7jvcjmp3b7if
2025-03-17 23:03:02,367 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-17 23:03:02,386 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-17 23:03:02,388 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-17 23:03:02,427 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-17 23:03:02,511 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-17 23:03:02,514 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-17 23:03:02,515 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-17 23:03:02,517 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-17 23:03:02,601 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-17 23:03:02,602 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-17 23:03:02,603 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-17 23:03:02,604 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-17 23:03:02,761 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-17 23:03:04,226 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-17 23:03:04,227 - portuguese-restaurant-assistant - INFO - Participant joined: futuristic-container
2025-03-17 23:03:04,228 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-17 23:03:04,228 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: VoicePipelineAgent.__init__() got an unexpected keyword argument 'stt_options'
2025-03-17 23:03:04,231 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 97, in entrypoint
    assistant = VoicePipelineAgent(
                ^^^^^^^^^^^^^^^^^^^
TypeError: VoicePipelineAgent.__init__() got an unexpected keyword argument 'stt_options'

2025-03-17 23:03:52,790 - livekit.agents - INFO - shutting down worker
2025-03-17 23:03:52,791 - livekit.agents - DEBUG - shutting down job task
2025-03-17 23:03:52,794 - livekit.agents - DEBUG - job exiting
2025-03-17 23:03:52,923 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: None
2025-03-17 23:03:52,926 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-17 23:03:52,927 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-17 23:04:31,750 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:04:31,756 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-17 23:04:34,932 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:04:34,941 - livekit.agents - INFO - starting worker
2025-03-17 23:04:35,280 - livekit.agents - INFO - registered worker
2025-03-17 23:04:47,597 - livekit.agents - INFO - received job request
2025-03-17 23:04:47,661 - livekit.agents - INFO - initializing job runner
2025-03-17 23:04:47,930 - livekit.agents - INFO - job runner initialized
2025-03-17 23:04:47,931 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:04:47,933 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-kLaAiKbKe5c24RM5nqYQRR
2025-03-17 23:04:47,933 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-17 23:04:47,953 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-17 23:04:47,954 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-17 23:04:47,995 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-17 23:04:48,068 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-17 23:04:48,069 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-17 23:04:48,070 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-17 23:04:48,071 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-17 23:04:48,168 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-17 23:04:48,169 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-17 23:04:48,170 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-17 23:04:48,171 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-17 23:04:48,348 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-17 23:04:49,779 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-17 23:04:49,781 - portuguese-restaurant-assistant - INFO - Participant joined: connected-stream
2025-03-17 23:04:49,782 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-17 23:04:50,577 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-17 23:04:50,578 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: STT.__init__() got an unexpected keyword argument 'key'
2025-03-17 23:04:50,585 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 107, in entrypoint
    stt=deepgram.STT(
        ^^^^^^^^^^^^^
TypeError: STT.__init__() got an unexpected keyword argument 'key'

2025-03-17 23:06:34,671 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:06:34,675 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-17 23:06:36,802 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:06:36,810 - livekit.agents - INFO - starting worker
2025-03-17 23:06:37,133 - livekit.agents - INFO - registered worker
2025-03-17 23:06:47,994 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:06:48,000 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-17 23:06:49,777 - livekit.agents - INFO - received job request
2025-03-17 23:06:49,840 - livekit.agents - INFO - initializing job runner
2025-03-17 23:06:50,569 - livekit.agents - INFO - job runner initialized
2025-03-17 23:06:50,570 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:06:50,574 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-6ZTBNv3pJ8tp556ZH8GC9R
2025-03-17 23:06:50,576 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-17 23:06:50,602 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-17 23:06:50,604 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-17 23:06:50,654 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-17 23:06:50,735 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-17 23:06:50,737 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-17 23:06:50,739 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-17 23:06:50,740 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-17 23:06:50,830 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-17 23:06:50,832 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-17 23:06:50,835 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-17 23:06:50,836 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-17 23:06:50,996 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-17 23:06:51,424 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-17 23:06:51,426 - portuguese-restaurant-assistant - INFO - Participant joined: synchronized-semaphore
2025-03-17 23:06:51,427 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-17 23:06:51,665 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:06:51,682 - livekit.agents - INFO - starting worker
2025-03-17 23:06:51,968 - livekit.agents - INFO - registered worker
2025-03-17 23:06:52,235 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-17 23:06:53,482 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.
2025-03-17 23:06:53,489 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 119, in entrypoint
    @assistant.on("error")
     ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 172, in decorator
    self.on(event, callback)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\pipeline_agent.py", line 431, in on
    return super().on(event, callback)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 161, in on
    raise ValueError(
ValueError: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.

2025-03-17 23:06:53,494 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:47> result=None> took too long: 2.06 seconds
2025-03-17 23:06:53,496 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:47> result=None> took too long: 2.08 seconds
2025-03-18 02:08:36,156 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"ping timeout\"" UnknownReason Resume
2025-03-18 02:08:36,159 - livekit - ERROR - livekit::rtc_engine::rtc_session:735:livekit::rtc_engine::rtc_session - Subscriber pc state failed
2025-03-18 02:08:36,161 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 0
2025-03-18 02:08:36,162 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "pc_state failed" UnknownReason Resume
2025-03-18 02:08:36,956 - livekit.agents - WARNING - failed to connect to livekit, retrying in 0s: worker connection closed unexpectedly
2025-03-18 02:08:36,960 - livekit.agents - WARNING - failed to connect to livekit, retrying in 2s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 02:08:36,985 - livekit - ERROR - livekit_api::signal_client::signal_stream:192:livekit_api::signal_client::signal_stream - unhandled websocket message Err(Io(Os { code: 10054, kind: ConnectionReset, message: "Uma ligação existente foi forçada a fechar pelo anfitrião remoto." }))
2025-03-18 02:08:36,985 - livekit.agents - WARNING - failed to connect to livekit, retrying in 0s: worker connection closed unexpectedly
2025-03-18 02:08:36,990 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,042 - livekit.agents - WARNING - failed to connect to livekit, retrying in 2s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 02:08:37,050 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,051 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 1
2025-03-18 02:08:37,052 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,054 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,056 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 2
2025-03-18 02:08:37,057 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,058 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,060 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 3
2025-03-18 02:08:37,061 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,062 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,063 - livekit.agents - DEBUG - shutting down job task
2025-03-18 02:08:37,064 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 4
2025-03-18 02:08:37,065 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 02:08:37,066 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,066 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 02:08:37,068 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,069 - livekit.agents - DEBUG - job exiting
2025-03-18 02:08:37,070 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 5
2025-03-18 02:08:37,088 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,091 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,092 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 6
2025-03-18 02:08:37,094 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,095 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,096 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 7
2025-03-18 02:08:37,097 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,099 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,100 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 8
2025-03-18 02:08:37,101 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,102 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,103 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 9
2025-03-18 02:08:37,104 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,105 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,106 - livekit - ERROR - livekit::rtc_engine:650:livekit::rtc_engine - failed to reconnect to the livekit room
2025-03-18 02:08:37,108 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: UnknownReason
2025-03-18 02:08:38,976 - livekit.agents - WARNING - failed to connect to livekit, retrying in 4s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 02:08:39,056 - livekit.agents - WARNING - failed to connect to livekit, retrying in 4s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:37,860 - livekit.agents - WARNING - failed to connect to livekit, retrying in 6s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:37,938 - livekit.agents - WARNING - failed to connect to livekit, retrying in 6s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:43,870 - livekit.agents - WARNING - failed to connect to livekit, retrying in 8s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:43,949 - livekit.agents - WARNING - failed to connect to livekit, retrying in 8s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:51,889 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:51,965 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:57:01,904 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:57:01,981 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:57:11,917 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:57:11,995 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:57:22,387 - livekit.agents - INFO - registered worker
2025-03-18 07:57:22,458 - livekit.agents - INFO - registered worker
2025-03-18 09:29:08,288 - livekit.agents - INFO - shutting down worker
2025-03-18 09:32:08,192 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:32:08,204 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:32:10,679 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:32:10,690 - livekit.agents - INFO - starting worker
2025-03-18 09:32:11,096 - livekit.agents - INFO - registered worker
2025-03-18 09:32:27,100 - livekit.agents - INFO - received job request
2025-03-18 09:32:27,168 - livekit.agents - INFO - initializing job runner
2025-03-18 09:32:27,678 - livekit.agents - INFO - job runner initialized
2025-03-18 09:32:27,680 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:32:27,682 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-WRo4x4NyKaRko6ZCdChJHE
2025-03-18 09:32:27,683 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:32:27,707 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:32:27,710 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:32:27,770 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:32:27,853 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:32:27,854 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:32:27,855 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:32:27,855 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:32:27,949 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:32:27,952 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:32:27,952 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:32:27,953 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:32:28,134 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:32:31,405 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:32:31,407 - portuguese-restaurant-assistant - INFO - Participant joined: ultra-firewall
2025-03-18 09:32:31,407 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:32:32,615 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-18 09:32:33,460 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.
2025-03-18 09:32:33,466 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 119, in entrypoint
    @assistant.on("error")
     ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 172, in decorator
    self.on(event, callback)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\pipeline_agent.py", line 431, in on
    return super().on(event, callback)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 161, in on
    raise ValueError(
ValueError: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.

2025-03-18 09:32:33,474 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:47> result=None> took too long: 2.06 seconds
2025-03-18 09:32:33,476 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:47> result=None> took too long: 2.06 seconds
2025-03-18 09:32:42,765 - livekit.agents - INFO - shutting down worker
2025-03-18 09:32:42,775 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:32:42,784 - livekit.agents - DEBUG - job exiting
2025-03-18 09:32:42,855 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:32:42,867 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 09:32:42,872 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:32:42,875 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:33:33,071 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:33:33,077 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:33:36,999 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:33:37,012 - livekit.agents - INFO - starting worker
2025-03-18 09:33:37,409 - livekit.agents - INFO - registered worker
2025-03-18 09:35:55,404 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:35:55,427 - livekit.agents - INFO - starting worker
2025-03-18 09:35:55,436 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 09:35:55,809 - livekit.agents - INFO - registered worker
2025-03-18 09:36:47,497 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:36:47,511 - livekit.agents - INFO - starting worker
2025-03-18 09:36:47,860 - livekit.agents - INFO - registered worker
2025-03-18 09:36:49,223 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:36:49,229 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:36:52,465 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:36:52,476 - livekit.agents - INFO - starting worker
2025-03-18 09:36:52,779 - livekit.agents - INFO - registered worker
2025-03-18 09:36:56,864 - livekit.agents - INFO - received job request
2025-03-18 09:36:56,959 - livekit.agents - INFO - initializing job runner
2025-03-18 09:36:56,965 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:36:57,327 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:36:57,328 - livekit.agents - INFO - job runner initialized
2025-03-18 09:36:57,329 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:36:57,334 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-NrGSSvVb5zk3xK5tCEa7u5
2025-03-18 09:36:57,335 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:36:57,336 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:36:57,359 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:36:57,360 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:36:57,405 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:36:57,487 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:36:57,489 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:36:57,490 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:36:57,490 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:36:57,572 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:36:57,574 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:36:57,574 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:36:57,575 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:36:57,747 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:36:59,189 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:36:59,190 - portuguese-restaurant-assistant - INFO - Participant joined: binary-microservice
2025-03-18 09:36:59,192 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:36:59,194 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-18 09:37:01,291 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 09:37:01,292 - livekit.agents - WARNING - Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:193> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]> took too long: 2.11 seconds
2025-03-18 09:37:01,295 - livekit.agents - WARNING - Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:193> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]> took too long: 2.11 seconds
2025-03-18 09:37:01,303 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:37:01,419 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: 'Room' object has no attribute 'connected'
2025-03-18 09:37:01,423 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 199, in entrypoint
    while ctx.room.connected:
          ^^^^^^^^^^^^^^^^^^
AttributeError: 'Room' object has no attribute 'connected'. Did you mean: 'connect'?

2025-03-18 09:37:01,826 - livekit.plugins.openai - ERROR - Error in _decode_loop
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\openai\tts.py", line 191, in _decode_loop
    async with oai_stream as stream:
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_response.py", line 650, in __aenter__
    self.__response = await self._api_request
                      ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\resources\audio\speech.py", line 180, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1767, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1461, in request
    return await self._request(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1562, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-****************************************************************************************************************************************************************************************************************************************************************************************************************************HlgA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-18 09:37:06,299 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-18 09:37:11,296 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-18 09:37:20,596 - livekit.agents - INFO - shutting down worker
2025-03-18 09:37:32,541 - livekit.agents - INFO - shutting down worker
2025-03-18 09:37:32,549 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:37:32,559 - livekit.agents - DEBUG - job exiting
2025-03-18 09:37:32,623 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:37:32,663 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=9.99999999999998)
2025-03-18 09:37:32,664 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:37:32,782 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:32,789 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:32,799 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:434> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:32,808 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() done, defined at C:\Python312\Lib\asyncio\locks.py:199> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 09:37:32,816 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<VoicePipelineAgent._play_speech.<locals>._play_nested_speech() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\pipeline_agent.py:794> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,821 - livekit.agents.pipeline - ERROR - Error in _playout_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_playout.py", line 155, in _playout_task
    await asyncio.wait(
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_playout.py", line 160, in _playout_task
    await utils.aio.gracefully_cancel(capture_task)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:37:32,858 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<AgentPlayout._playout_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,860 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-59' coro=<Event.wait() done, defined at C:\Python312\Lib\asyncio\locks.py:199> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,864 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-60' coro=<AgentPlayout._playout_task.<locals>._capture_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,868 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,871 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-31' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,876 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-35' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 09:37:32,880 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:37:32,914 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-36' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,917 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-38' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:32,923 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:32,926 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,929 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 09:37:32,983 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,987 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-33' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 09:37:32,991 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-41' coro=<AgentOutput._synthesize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[set.remove()]>
2025-03-18 09:37:32,994 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<AgentOutput._stream_synthesis_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Task pending name='Task-44' coro=<AgentOutput._stream_synthesis_task.<locals>._read_generated_audio_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[Task.task_wakeup()]> cb=[AgentOutput._synthesize_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py:188, _wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 09:37:32,999 - livekit.agents.pipeline - ERROR - Error in _synthesize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 190, in _synthesize_task
    _ = await asyncio.wait(
        ^^^^^^^^^^^^^^^^^^^
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 194, in _synthesize_task
    await utils.aio.gracefully_cancel(synth)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:37:33,025 - livekit.agents.pipeline - ERROR - Error in _stream_synthesis_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 259, in _stream_synthesis_task
    await read_tts_atask
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 265, in _stream_synthesis_task
    await utils.aio.gracefully_cancel(read_tts_atask, read_transcript_atask)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:37:33,048 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._main_task' coro=<SynthesizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py:285> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]> cb=[SynthesizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py:271]>
2025-03-18 09:37:33,053 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<AgentOutput._stream_synthesis_task.<locals>._read_generated_audio_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[Task.task_wakeup()]>
2025-03-18 09:37:33,056 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-51' coro=<ChunkedStream._run.<locals>._decode_loop() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> exception=AuthenticationError("Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-****************************************************************************************************************************************************************************************************************************************************************************************************************************HlgA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}")>
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\openai\tts.py", line 191, in _decode_loop
    async with oai_stream as stream:
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_response.py", line 650, in __aenter__
    self.__response = await self._api_request
                      ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\resources\audio\speech.py", line 180, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1767, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1461, in request
    return await self._request(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1562, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-****************************************************************************************************************************************************************************************************************************************************************************************************************************HlgA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-18 09:37:33,091 - livekit.agents.pipeline - ERROR - Error in _read_generated_audio_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 228, in _read_generated_audio_task
    async for audio in tts_stream:
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 237, in _read_generated_audio_task
    await tts_stream.aclose()
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 398, in aclose
    await aio.gracefully_cancel(self._task)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:37:33,116 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<StreamAdapterWrapper._run.<locals>._synthesize() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\stream_adapter.py:94> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:33,119 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<ChunkedStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py:165> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:33,122 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._synthesize_task' coro=<ChunkedStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py:201> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[ChunkedStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py:141]>
2025-03-18 09:44:59,045 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:44:59,046 - __main__ - INFO - Testing API connections...
2025-03-18 09:44:59,046 - __main__ - ERROR - OpenAI API key not found. Please set the OPENAI_API_KEY environment variable.
2025-03-18 09:44:59,047 - __main__ - ERROR - Deepgram API key not found. Please set the DEEPGRAM_API_KEY environment variable.
2025-03-18 09:44:59,048 - __main__ - ERROR - ElevenLabs API key not found. Please set the ELEVEN_API_KEY environment variable.
2025-03-18 09:44:59,048 - __main__ - ERROR - LiveKit API key not found. Please set the LIVEKIT_API_KEY environment variable.
2025-03-18 09:44:59,049 - __main__ - ERROR - LiveKit Secret API key not found. Please set the LIVEKIT_API_SECRET environment variable.
2025-03-18 09:44:59,052 - __main__ - ERROR - LiveKit configuration incomplete
2025-03-18 09:44:59,053 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:44:59,054 - __main__ - INFO - Preloading VAD model...
2025-03-18 09:44:59,055 - __main__ - ERROR - Failed to preload VAD model: module 'livekit.agents.vad' has no attribute 'preload_model'
2025-03-18 09:44:59,056 - __main__ - ERROR - OpenAI API key not found. Please set the OPENAI_API_KEY environment variable.
2025-03-18 09:44:59,057 - __main__ - ERROR - Cannot initialize voice assistant without a valid OpenAI API key
2025-03-18 09:45:23,571 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:45:23,572 - __main__ - INFO - Testing API connections...
2025-03-18 09:45:23,572 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:45:25,938 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:45:25,988 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:45:25,989 - __main__ - INFO - Deepgram API key found
2025-03-18 09:45:25,989 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:45:25,990 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:45:25,990 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:45:25,991 - __main__ - INFO - Preloading VAD model...
2025-03-18 09:45:25,991 - __main__ - ERROR - Failed to preload VAD model: module 'livekit.agents.vad' has no attribute 'preload_model'
2025-03-18 09:45:40,395 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:45:40,396 - __main__ - INFO - Testing API connections...
2025-03-18 09:45:40,396 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:45:43,019 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:45:43,042 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:45:43,044 - __main__ - INFO - Deepgram API key found
2025-03-18 09:45:43,044 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:45:43,045 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:45:43,046 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:45:43,047 - __main__ - INFO - Preloading VAD model...
2025-03-18 09:45:43,048 - __main__ - ERROR - Failed to preload VAD model: module 'livekit.agents.vad' has no attribute 'preload_model'
2025-03-18 09:47:11,099 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:47:11,099 - __main__ - INFO - Testing API connections...
2025-03-18 09:47:11,099 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:47:12,839 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:47:12,862 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:47:12,863 - __main__ - INFO - Deepgram API key found
2025-03-18 09:47:12,864 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:47:12,865 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:47:12,867 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:47:12,869 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:47:12,871 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:47:12,872 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:47:12,873 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:47:12,875 - __main__ - ERROR - Failed to initialize voice assistant: VoicePipelineAgent.__init__() got an unexpected keyword argument 'language'
2025-03-18 09:47:33,245 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:47:33,245 - __main__ - INFO - Testing API connections...
2025-03-18 09:47:33,246 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:47:35,199 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:47:35,209 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:47:35,210 - __main__ - INFO - Deepgram API key found
2025-03-18 09:47:35,211 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:47:35,211 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:47:35,212 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:47:35,212 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:47:35,213 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:47:35,214 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:47:35,214 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:47:35,215 - __main__ - ERROR - Failed to initialize voice assistant: VoicePipelineAgent.__init__() got an unexpected keyword argument 'chat_context'
2025-03-18 09:48:05,187 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:48:05,188 - __main__ - INFO - Testing API connections...
2025-03-18 09:48:05,188 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:48:07,302 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:48:07,328 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:48:07,329 - __main__ - INFO - Deepgram API key found
2025-03-18 09:48:07,345 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:48:07,346 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:48:07,349 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:48:07,350 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:48:07,351 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:48:07,353 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:48:07,355 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:48:08,045 - __main__ - ERROR - Failed to initialize voice assistant: VoicePipelineAgent.__init__() missing 1 required keyword-only argument: 'vad'
2025-03-18 09:48:45,314 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:48:45,315 - __main__ - INFO - Testing API connections...
2025-03-18 09:48:45,315 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:48:47,161 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:48:47,185 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:48:47,185 - __main__ - INFO - Deepgram API key found
2025-03-18 09:48:47,186 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:48:47,186 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:48:47,188 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:48:47,188 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:48:47,189 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:48:47,189 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:48:47,190 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:48:47,190 - __main__ - INFO - Loading VAD model...
2025-03-18 09:48:47,564 - __main__ - INFO - VAD model loaded successfully
2025-03-18 09:48:48,391 - __main__ - ERROR - Failed to initialize voice assistant: 'VoicePipelineAgent' object has no attribute 'on_user_speech_start'
2025-03-18 09:50:37,515 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:50:37,516 - __main__ - INFO - Testing API connections...
2025-03-18 09:50:37,516 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:50:39,480 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:50:39,504 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:50:39,505 - __main__ - INFO - Deepgram API key found
2025-03-18 09:50:39,506 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:50:39,507 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:50:39,509 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:50:39,511 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:50:39,512 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:50:39,513 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:50:39,514 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:50:39,516 - __main__ - INFO - Loading VAD model...
2025-03-18 09:50:39,872 - __main__ - INFO - VAD model loaded successfully
2025-03-18 09:50:40,760 - __main__ - INFO - Creating LiveKit room connection...
2025-03-18 09:50:40,762 - __main__ - INFO - Starting voice assistant CLI...
2025-03-18 09:50:40,762 - __main__ - ERROR - Failed to connect to LiveKit room: module 'livekit.agents' has no attribute 'dev'
2025-03-18 09:51:04,968 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:51:04,969 - __main__ - INFO - Testing API connections...
2025-03-18 09:51:04,970 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:51:06,358 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:51:06,381 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:51:06,382 - __main__ - INFO - Deepgram API key found
2025-03-18 09:51:06,384 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:51:06,385 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:51:06,387 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:51:06,388 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:51:06,389 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:51:06,391 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:51:06,393 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:51:06,394 - __main__ - INFO - Loading VAD model...
2025-03-18 09:51:06,740 - __main__ - INFO - VAD model loaded successfully
2025-03-18 09:51:07,561 - __main__ - INFO - Creating LiveKit room connection...
2025-03-18 09:51:07,561 - __main__ - INFO - Starting voice assistant CLI...
2025-03-18 09:51:32,106 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:51:32,112 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:51:35,866 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:51:35,876 - livekit.agents - INFO - starting worker
2025-03-18 09:51:36,211 - livekit.agents - INFO - registered worker
2025-03-18 09:51:42,836 - livekit.agents - INFO - received job request
2025-03-18 09:51:42,912 - livekit.agents - INFO - initializing job runner
2025-03-18 09:51:42,917 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:51:43,208 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:51:43,209 - livekit.agents - INFO - job runner initialized
2025-03-18 09:51:43,211 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:51:43,214 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-mnqJstFxXfjEPJJwXpwmMW
2025-03-18 09:51:43,215 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:51:43,216 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:51:43,239 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:51:43,243 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:51:43,292 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:51:43,377 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:51:43,380 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:51:43,381 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:51:43,383 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:51:43,773 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:51:43,778 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:51:43,783 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:51:43,787 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:51:43,938 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:51:44,368 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:51:44,373 - portuguese-restaurant-assistant - INFO - Participant joined: modular-token
2025-03-18 09:51:44,378 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:51:44,381 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-18 09:51:45,938 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 09:51:45,947 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:51:46,069 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: 'Room' object has no attribute 'connected'
2025-03-18 09:51:46,076 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 199, in entrypoint
    while ctx.room.connected:
          ^^^^^^^^^^^^^^^^^^
AttributeError: 'Room' object has no attribute 'connected'. Did you mean: 'connect'?

2025-03-18 09:51:47,791 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 09:51:47,925 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=050159db9450, ttfb=1.6978136000107042, audio_duration=2.40
2025-03-18 09:51:49,377 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=050159db9450, ttfb=1.423128700000234, audio_duration=1.66
2025-03-18 09:51:51,000 - livekit.agents - INFO - Pipeline STT metrics: duration=5.05, audio_duration=5.05
2025-03-18 09:51:51,864 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 09:51:51,868 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 09:52:17,281 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:52:17,286 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:52:17,290 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 09:52:17,295 - livekit.agents - DEBUG - job exiting
2025-03-18 09:52:17,302 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=68, stt_audio_duration=5.04999999999999)
2025-03-18 09:52:17,308 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 09:52:17,310 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:54:17,370 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:17,412 - livekit.agents - INFO - starting worker
2025-03-18 09:54:17,417 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 09:54:17,775 - livekit.agents - INFO - registered worker
2025-03-18 09:54:26,636 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:26,649 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:54:30,418 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:30,447 - livekit.agents - INFO - starting worker
2025-03-18 09:54:30,887 - livekit.agents - INFO - registered worker
2025-03-18 09:54:30,889 - livekit.agents - INFO - connecting to room contextual-node-16jzjr
2025-03-18 09:54:31,774 - livekit.agents - INFO - received job request
2025-03-18 09:54:31,826 - livekit.agents - INFO - received job request
2025-03-18 09:54:31,859 - livekit.agents - INFO - initializing job runner
2025-03-18 09:54:31,861 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:54:32,437 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:54:32,441 - livekit.agents - INFO - job runner initialized
2025-03-18 09:54:32,444 - livekit.agents - INFO - initializing job runner
2025-03-18 09:54:32,448 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:32,451 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:54:32,841 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:54:32,846 - livekit.agents - INFO - job runner initialized
2025-03-18 09:54:32,850 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room contextual-node-16jzjr
2025-03-18 09:54:32,853 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:32,880 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:54:32,881 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:54:32,885 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room contextual-node-16jzjr
2025-03-18 09:54:32,886 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:54:32,889 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:54:32,890 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:54:32,891 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:54:32,901 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:54:32,904 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:54:32,982 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:54:32,984 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:54:32,987 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:54:32,988 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:54:33,003 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:54:33,006 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:54:33,008 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:54:33,010 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:54:33,091 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:54:33,094 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:54:33,097 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:54:33,099 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:54:33,110 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:54:33,113 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:54:33,116 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:54:33,119 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:54:33,260 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:54:33,295 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:54:34,697 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:54:34,712 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:54:59,100 - livekit.agents - INFO - received job request
2025-03-18 09:54:59,171 - livekit.agents - INFO - initializing job runner
2025-03-18 09:54:59,175 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:54:59,481 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:54:59,482 - livekit.agents - INFO - job runner initialized
2025-03-18 09:54:59,483 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:59,485 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-YdCtzGAB3r7qpz9AHZM4p2
2025-03-18 09:54:59,486 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:54:59,487 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:54:59,491 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:54:59,492 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:54:59,498 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:54:59,580 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:54:59,582 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:54:59,583 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:54:59,584 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:54:59,669 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:54:59,670 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:54:59,671 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:54:59,674 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:54:59,835 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:55:00,219 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:55:00,224 - portuguese-restaurant-assistant - INFO - Participant joined: low-latency-network
2025-03-18 09:55:00,225 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:55:00,229 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:55:00,232 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: TTS.__init__() got an unexpected keyword argument 'key'
2025-03-18 09:55:00,239 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 110, in entrypoint
    tts = elevenlabs.TTS(voice="Antonio", key=elevenlabs_key)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: TTS.__init__() got an unexpected keyword argument 'key'

2025-03-18 09:55:03,719 - livekit.agents - INFO - received job request
2025-03-18 09:55:03,794 - livekit.agents - INFO - initializing job runner
2025-03-18 09:55:03,799 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:55:04,382 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:55:04,392 - livekit.agents - INFO - job runner initialized
2025-03-18 09:55:04,396 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:55:04,406 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room contextual-node-16jzjr
2025-03-18 09:55:04,409 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:55:04,410 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:55:04,413 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:55:04,497 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:55:04,499 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:55:04,500 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:55:04,502 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:55:04,604 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:55:04,607 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:55:04,608 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:55:04,609 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:55:04,799 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:55:06,290 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:55:16,261 - livekit.agents - INFO - shutting down worker
2025-03-18 09:55:16,266 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:55:16,267 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:55:16,271 - livekit.agents - DEBUG - job exiting
2025-03-18 09:55:16,273 - livekit.agents - DEBUG - job exiting
2025-03-18 09:55:16,362 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:55:16,367 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:55:16,370 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:55:16,372 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:55:16,373 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:55:16,376 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:55:16,382 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 09:55:16,464 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:76> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 09:55:38,446 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:55:38,450 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:55:41,639 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:55:41,650 - livekit.agents - INFO - starting worker
2025-03-18 09:55:42,011 - livekit.agents - INFO - registered worker
2025-03-18 09:55:49,546 - livekit.agents - INFO - received job request
2025-03-18 09:55:49,617 - livekit.agents - INFO - initializing job runner
2025-03-18 09:55:49,620 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:55:49,898 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:55:49,898 - livekit.agents - INFO - job runner initialized
2025-03-18 09:55:49,901 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:55:49,902 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-27Px6VkzZNagqWbaFhpGhS
2025-03-18 09:55:49,903 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:55:49,903 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:55:49,907 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:55:49,908 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:55:49,913 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:55:49,987 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:55:49,988 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:55:49,989 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:55:49,989 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:55:50,071 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:55:50,072 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:55:50,075 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:55:50,076 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:55:50,236 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:55:51,643 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:55:51,646 - portuguese-restaurant-assistant - INFO - Participant joined: autonomous-shell
2025-03-18 09:55:51,647 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:55:51,647 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:55:51,648 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: TTS.__init__() got an unexpected keyword argument 'key'
2025-03-18 09:55:51,650 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 110, in entrypoint
    tts = elevenlabs.TTS(voice="Antonio", key=elevenlabs_key)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: TTS.__init__() got an unexpected keyword argument 'key'

2025-03-18 09:56:07,817 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:56:07,827 - livekit.agents - INFO - starting worker
2025-03-18 09:56:07,831 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 09:56:08,162 - livekit.agents - INFO - registered worker
2025-03-18 09:56:24,683 - livekit.agents - INFO - received job request
2025-03-18 09:56:24,757 - livekit.agents - INFO - initializing job runner
2025-03-18 09:56:24,762 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:56:25,114 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:56:25,114 - livekit.agents - INFO - received job request
2025-03-18 09:56:25,116 - livekit.agents - INFO - job runner initialized
2025-03-18 09:56:25,119 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:56:25,123 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-27Px6VkzZNagqWbaFhpGhS
2025-03-18 09:56:25,125 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:56:25,126 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:56:25,130 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:56:25,132 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:56:25,137 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:56:25,180 - livekit.agents - INFO - initializing job runner
2025-03-18 09:56:25,182 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:56:25,266 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:56:25,559 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:56:25,560 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:56:25,561 - livekit.agents - INFO - job runner initialized
2025-03-18 09:56:25,594 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:56:25,595 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:56:25,596 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:56:25,600 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-93t63YNdJMfkW3wECTZ5tC
2025-03-18 09:56:25,602 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:56:25,602 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:56:25,603 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:56:25,606 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:56:25,609 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:56:25,611 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:56:25,613 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:56:25,684 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:56:25,685 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:56:25,687 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:56:25,688 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:56:25,763 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:56:25,778 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:56:25,779 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:56:25,780 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:56:25,782 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:56:25,950 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:56:26,134 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:56:26,304 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:56:26,305 - portuguese-restaurant-assistant - INFO - Participant joined: autonomous-fork
2025-03-18 09:56:26,305 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:56:26,306 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-18 09:56:28,390 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 09:56:28,391 - livekit.agents - WARNING - Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:193> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]> took too long: 2.09 seconds
2025-03-18 09:56:28,395 - livekit.agents - WARNING - Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:193> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]> took too long: 2.09 seconds
2025-03-18 09:56:28,399 - livekit.agents - WARNING - Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:193> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]> took too long: 2.09 seconds
2025-03-18 09:56:28,512 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: 'Room' object has no attribute 'connected'
2025-03-18 09:56:28,523 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 199, in entrypoint
    while ctx.room.connected:
          ^^^^^^^^^^^^^^^^^^
AttributeError: 'Room' object has no attribute 'connected'. Did you mean: 'connect'?

2025-03-18 09:56:28,646 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:56:30,668 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 09:56:30,865 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=efc4268df9ac, ttfb=2.1279976000078022, audio_duration=2.44
2025-03-18 09:56:32,492 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=efc4268df9ac, ttfb=1.4657895999844186, audio_duration=1.68
2025-03-18 09:56:33,679 - livekit.agents - INFO - Pipeline STT metrics: duration=5.00, audio_duration=5.05
2025-03-18 09:56:34,794 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 09:56:34,799 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 09:56:36,208 - livekit.agents - INFO - shutting down worker
2025-03-18 09:56:36,211 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:56:36,212 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:56:36,218 - livekit.agents - DEBUG - job exiting
2025-03-18 09:56:36,220 - livekit.agents - DEBUG - job exiting
2025-03-18 09:56:36,281 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:56:36,286 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:56:36,297 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 09:56:36,303 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:56:36,303 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=68, stt_audio_duration=5.04999999999999)
2025-03-18 09:56:36,306 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:56:36,308 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:56:36,399 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:70> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 09:56:36,404 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-43' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,406 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,407 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:56:36,428 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-65' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:56:36,430 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-64' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:56:36,434 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-61' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 09:56:36,442 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-62' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,446 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,449 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,450 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-59' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 09:56:36,455 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 09:56:36,466 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-71' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,469 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-70' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:56:36,471 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-69' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:56:36,474 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-68' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:02:28,859 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:02:28,864 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:02:33,737 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:02:33,755 - livekit.agents - INFO - starting worker
2025-03-18 10:02:34,152 - livekit.agents - INFO - registered worker
2025-03-18 10:02:44,253 - livekit.agents - INFO - received job request
2025-03-18 10:02:44,327 - livekit.agents - INFO - initializing job runner
2025-03-18 10:02:44,329 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:02:44,844 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:02:44,848 - livekit.agents - INFO - job runner initialized
2025-03-18 10:02:44,850 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:02:44,854 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-e84LdPUXUhrgCT8EkZNaeE
2025-03-18 10:02:44,855 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:02:44,856 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:02:44,881 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:02:44,883 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:02:44,946 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:02:45,078 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:02:45,079 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:02:45,081 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:02:45,082 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:02:45,170 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:02:45,171 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:02:45,173 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:02:45,175 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:02:45,343 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:02:46,889 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:02:46,892 - portuguese-restaurant-assistant - INFO - Participant joined: robotic-thread
2025-03-18 10:02:46,892 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:02:46,894 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:02:46,896 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'
2025-03-18 10:02:46,901 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 87, in entrypoint
    elevenlabs_plugin = elevenlabs.ElevenLabs(api_key=elevenlabs_key)
                        ^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'

2025-03-18 10:03:21,899 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:03:21,906 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:03:21,915 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:03:21,919 - livekit.agents - DEBUG - job exiting
2025-03-18 10:03:21,931 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:03:21,935 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:03:21,938 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:05:28,256 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:05:28,269 - livekit.agents - INFO - starting worker
2025-03-18 10:05:28,272 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 10:05:28,632 - livekit.agents - INFO - registered worker
2025-03-18 10:05:42,025 - livekit.agents - INFO - received job request
2025-03-18 10:05:42,097 - livekit.agents - INFO - initializing job runner
2025-03-18 10:05:42,099 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:05:42,416 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:05:42,417 - livekit.agents - INFO - job runner initialized
2025-03-18 10:05:42,418 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:05:42,422 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-nerEzMG7fgz3RBZvHA5nkf
2025-03-18 10:05:42,422 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:05:42,423 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:05:42,427 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:05:42,428 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:05:42,432 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:05:42,519 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:05:42,521 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:05:42,524 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:05:42,526 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:05:42,610 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:05:42,613 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:05:42,615 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:05:42,618 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:05:42,810 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:05:43,194 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:05:43,196 - portuguese-restaurant-assistant - INFO - Participant joined: programmable-mesh
2025-03-18 10:05:43,197 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:05:43,198 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-18 10:05:44,928 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: module 'livekit.rtc' has no attribute 'DTMFEvent'
2025-03-18 10:05:44,932 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 143, in entrypoint
    def on_dtmf_received(event: rtc.DTMFEvent):
                                ^^^^^^^^^^^^^
AttributeError: module 'livekit.rtc' has no attribute 'DTMFEvent'

2025-03-18 10:06:46,666 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:06:46,679 - livekit.agents - INFO - starting worker
2025-03-18 10:06:47,021 - livekit.agents - INFO - registered worker
2025-03-18 10:06:58,721 - livekit.agents - INFO - received job request
2025-03-18 10:06:58,787 - livekit.agents - INFO - initializing job runner
2025-03-18 10:06:58,788 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:06:59,145 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:06:59,147 - livekit.agents - INFO - job runner initialized
2025-03-18 10:06:59,148 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:06:59,152 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-acfsuNnnFnfBbkTqhYYuMn
2025-03-18 10:06:59,153 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:06:59,154 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:06:59,159 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:06:59,161 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:06:59,180 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:06:59,257 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:06:59,259 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:06:59,260 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:06:59,262 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:06:59,349 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:06:59,352 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:06:59,353 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:06:59,353 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:06:59,512 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:07:01,053 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:07:01,057 - portuguese-restaurant-assistant - INFO - Participant joined: modular-vault
2025-03-18 10:07:01,059 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:07:01,063 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:07:01,066 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'
2025-03-18 10:07:01,074 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 87, in entrypoint
    elevenlabs_plugin = elevenlabs.ElevenLabs(api_key=elevenlabs_key)
                        ^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'

2025-03-18 10:07:02,213 - livekit.agents - INFO - received job request
2025-03-18 10:07:02,287 - livekit.agents - INFO - initializing job runner
2025-03-18 10:07:02,290 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:07:02,777 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:07:02,781 - livekit.agents - INFO - job runner initialized
2025-03-18 10:07:02,783 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:07:02,794 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-nerEzMG7fgz3RBZvHA5nkf
2025-03-18 10:07:02,797 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:07:02,799 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:07:02,805 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:07:02,898 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:07:02,903 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:07:02,906 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:07:02,907 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:07:02,995 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:07:02,998 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:07:02,999 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:07:03,002 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:07:03,159 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:07:03,535 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:07:26,878 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:07:26,882 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:07:26,890 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:07:26,892 - livekit.agents - DEBUG - job exiting
2025-03-18 10:07:26,899 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:07:26,904 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:07:26,909 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:07:42,293 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:07:42,298 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:07:42,301 - livekit.agents - DEBUG - job exiting
2025-03-18 10:07:42,305 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:07:42,305 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:07:42,312 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:07:42,320 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:07:42,330 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:07:53,099 - livekit.agents - INFO - shutting down worker
2025-03-18 10:07:53,131 - asyncio - ERROR - Exception in callback _ProactorBasePipeTransport._call_connection_lost(None)
handle: <Handle _ProactorBasePipeTransport._call_connection_lost(None)>
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Python312\Lib\asyncio\proactor_events.py", line 165, in _call_connection_lost
    self._sock.shutdown(socket.SHUT_RDWR)
ConnectionResetError: [WinError 10054] Uma ligação existente foi forçada a fechar pelo anfitrião remoto
2025-03-18 10:07:53,233 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:53> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 10:08:00,156 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:08:00,164 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:08:03,027 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:08:03,037 - livekit.agents - INFO - starting worker
2025-03-18 10:08:03,488 - livekit.agents - INFO - registered worker
2025-03-18 10:08:08,203 - livekit.agents - INFO - received job request
2025-03-18 10:08:08,271 - livekit.agents - INFO - initializing job runner
2025-03-18 10:08:08,273 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:08:08,519 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:08:08,520 - livekit.agents - INFO - job runner initialized
2025-03-18 10:08:08,521 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:08:08,524 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-XnxZ8CCZfNzjZVQZESNcct
2025-03-18 10:08:08,524 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:08:08,525 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:08:08,527 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:08:08,529 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:08:08,532 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:08:08,629 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:08:08,632 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:08:08,636 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:08:08,639 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:08:08,728 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:08:08,730 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:08:08,731 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:08:08,733 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:08:08,898 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:08:10,310 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:08:10,311 - portuguese-restaurant-assistant - INFO - Participant joined: versatile-widget
2025-03-18 10:08:10,311 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:08:10,313 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:08:10,314 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'
2025-03-18 10:08:10,317 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 87, in entrypoint
    elevenlabs_plugin = elevenlabs.ElevenLabs(api_key=elevenlabs_key)
                        ^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'

2025-03-18 10:08:18,187 - livekit.agents - INFO - shutting down worker
2025-03-18 10:08:18,194 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:08:18,202 - livekit.agents - DEBUG - job exiting
2025-03-18 10:08:18,296 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:08:18,303 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:08:18,306 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:09:15,982 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:09:15,987 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:09:18,446 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:09:18,455 - livekit.agents - INFO - starting worker
2025-03-18 10:09:18,813 - livekit.agents - INFO - registered worker
2025-03-18 10:09:29,765 - livekit.agents - INFO - received job request
2025-03-18 10:09:29,838 - livekit.agents - INFO - initializing job runner
2025-03-18 10:09:29,842 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:09:30,225 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:09:30,227 - livekit.agents - INFO - job runner initialized
2025-03-18 10:09:30,230 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:09:30,236 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-NLX8HCtetM5ZbseHSpY6jF
2025-03-18 10:09:30,237 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:09:30,238 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:09:30,240 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:09:30,243 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:09:30,247 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:09:30,373 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:09:30,373 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:09:30,375 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:09:30,376 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:09:30,457 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:09:30,458 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:09:30,461 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:09:30,461 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:09:30,631 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:09:32,123 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:09:32,127 - portuguese-restaurant-assistant - INFO - Participant joined: innovative-shell
2025-03-18 10:09:32,130 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:09:32,134 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:09:33,598 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:09:33,654 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:09:33,767 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:09:33,826 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:09:34,551 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:09:55,426 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:09:55,870 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:09:57,031 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:09:57,053 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:09:57,176 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:09:57,190 - livekit.agents - WARNING - failed to synthesize speech, retrying in 5.0s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:10:02,206 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:10:02,210 - portuguese-restaurant-assistant - INFO - User stopped speaking: ChatMessage(role='user', id='item_eb9fb28ae8cb', name=None, content='Olá,', tool_calls=None, tool_call_id=None, tool_exception=None)
2025-03-18 10:10:13,081 - livekit.agents - INFO - shutting down worker
2025-03-18 10:10:13,087 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:10:13,122 - livekit.agents - DEBUG - job exiting
2025-03-18 10:10:13,185 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:10:13,202 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 10:10:13,204 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=0.0)
2025-03-18 10:10:13,208 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:10:13,283 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,285 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-31' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,287 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 10:10:13,299 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:10:13,300 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-38' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:10:13,303 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,304 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-35' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 10:10:13,308 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-36' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,309 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,312 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-33' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 10:10:13,314 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 10:10:13,322 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,323 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:10:13,324 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-52' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:10:13,326 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-51' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:14:28,654 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:14:28,661 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:14:31,433 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:14:31,442 - livekit.agents - INFO - starting worker
2025-03-18 10:14:31,809 - livekit.agents - INFO - registered worker
2025-03-18 10:14:38,775 - livekit.agents - INFO - received job request
2025-03-18 10:14:38,842 - livekit.agents - INFO - initializing job runner
2025-03-18 10:14:38,844 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:14:39,200 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:14:39,202 - livekit.agents - INFO - job runner initialized
2025-03-18 10:14:39,203 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:14:39,208 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-PnfRAQU9zXZVaNx5HJYUd5
2025-03-18 10:14:39,209 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:14:39,211 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:14:39,237 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:14:39,239 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:14:39,290 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:14:39,380 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:14:39,381 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:14:39,383 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:14:39,385 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:14:39,476 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:14:39,480 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:14:39,483 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:14:39,486 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:14:39,647 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:14:40,040 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:14:40,044 - portuguese-restaurant-assistant - INFO - Participant joined: cyber-workspace
2025-03-18 10:14:40,045 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:14:40,047 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:14:41,392 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:14:41,514 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:14:41,519 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:14:41,550 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:14:42,156 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:14:53,568 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:14:53,855 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:14:54,790 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:14:54,883 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:14:55,019 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:14:55,039 - livekit.agents - WARNING - failed to synthesize speech, retrying in 5.0s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:15:00,047 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:15:00,050 - portuguese-restaurant-assistant - INFO - User stopped speaking: ChatMessage(role='user', id='item_111fc74b8db1', name=None, content='Olá, boa tarde.', tool_calls=None, tool_call_id=None, tool_exception=None)
2025-03-18 10:15:23,761 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:15:23,764 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:15:23,771 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:15:23,773 - livekit.agents - DEBUG - job exiting
2025-03-18 10:15:23,779 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=0.0)
2025-03-18 10:15:23,786 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:15:23,787 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:16:24,815 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:16:24,828 - livekit.agents - INFO - starting worker
2025-03-18 10:16:24,831 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 10:16:25,179 - livekit.agents - INFO - registered worker
2025-03-18 10:16:26,094 - livekit.agents - INFO - shutting down worker
2025-03-18 10:16:30,391 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:16:30,396 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:16:33,637 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:16:33,657 - livekit.agents - INFO - starting worker
2025-03-18 10:16:33,973 - livekit.agents - INFO - registered worker
2025-03-18 10:16:37,393 - livekit.agents - INFO - received job request
2025-03-18 10:16:37,460 - livekit.agents - INFO - initializing job runner
2025-03-18 10:16:37,463 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:16:37,728 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:16:37,730 - livekit.agents - INFO - job runner initialized
2025-03-18 10:16:37,731 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:16:37,733 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-ixn56PAD5SCRZ6UBgYcCXA
2025-03-18 10:16:37,734 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:16:37,735 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:16:37,737 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:16:37,739 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:16:37,742 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:16:37,841 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:16:37,844 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:16:37,846 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:16:37,848 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:16:37,936 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:16:37,938 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:16:37,940 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:16:37,941 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:16:38,101 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:16:39,508 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:16:39,512 - portuguese-restaurant-assistant - INFO - Participant joined: contextual-bot
2025-03-18 10:16:39,515 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:16:39,518 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:16:40,648 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:16:40,717 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:16:40,718 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:16:40,730 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:16:41,511 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:17:16,874 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:17:16,874 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:17:16,877 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:17:16,878 - livekit.agents - DEBUG - job exiting
2025-03-18 10:17:16,883 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=0.0)
2025-03-18 10:17:16,884 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:17:16,886 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:28:59,417 - livekit.agents - INFO - shutting down worker
2025-03-18 10:28:59,767 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.send_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:28:59,771 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<SpeechStream._run.<locals>.recv_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:28:59,773 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<SpeechStream._run.<locals>.keepalive_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:434> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:28:59,774 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<Event.wait() done, defined at C:\Python312\Lib\asyncio\locks.py:199> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 10:28:59,776 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:28:59,778 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 10:28:59,780 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-41' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 10:28:59,782 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 10:28:59,804 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:28:59,807 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-46' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:28:59,808 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-43' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 10:28:59,810 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:28:59,815 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:28:59,817 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:28:59,819 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 10:35:26,286 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:35:26,292 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:35:29,028 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:35:29,036 - livekit.agents - INFO - starting worker
2025-03-18 10:35:29,401 - livekit.agents - INFO - registered worker
2025-03-18 10:35:40,061 - livekit.agents - INFO - received job request
2025-03-18 10:35:40,130 - livekit.agents - INFO - initializing job runner
2025-03-18 10:35:40,131 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:35:40,493 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:35:40,494 - livekit.agents - INFO - job runner initialized
2025-03-18 10:35:40,496 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:35:40,498 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-c6mQvByC5eRshRi9UzhW9B
2025-03-18 10:35:40,499 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:35:40,502 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:35:40,522 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:35:40,523 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:35:40,561 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:35:41,379 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:35:41,381 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:35:41,382 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:35:41,382 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:35:41,463 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:35:41,465 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:35:41,466 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:35:41,467 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:35:41,789 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:35:42,209 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:35:42,211 - portuguese-restaurant-assistant - INFO - Participant joined: ultra-pipeline
2025-03-18 10:35:42,212 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:35:42,214 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:35:43,481 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:35:43,565 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:35:43,576 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:35:43,647 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:35:44,326 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:35:49,450 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:35:49,814 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:35:50,884 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:35:50,899 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:35:51,014 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:35:51,026 - livekit.agents - WARNING - failed to synthesize speech, retrying in 5.0s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:35:56,058 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:35:56,059 - portuguese-restaurant-assistant - INFO - User stopped speaking: ChatMessage(role='user', id='item_f5b11e85820c', name=None, content='Boa tarde.', tool_calls=None, tool_call_id=None, tool_exception=None)
2025-03-18 10:35:58,004 - livekit.agents - INFO - shutting down worker
2025-03-18 10:35:58,006 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:35:58,009 - livekit.agents - DEBUG - job exiting
2025-03-18 10:35:58,072 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:35:58,083 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=0.0)
2025-03-18 10:35:58,085 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:35:58,148 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:200> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 10:35:58,151 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,152 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,152 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 10:35:58,161 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:35:58,162 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-46' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:35:58,163 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-43' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 10:35:58,166 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,166 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,167 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,168 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-41' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 10:35:58,169 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 10:35:58,175 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,176 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:35:58,177 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:35:58,178 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:37:45,456 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:37:45,461 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:37:48,156 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:37:48,165 - livekit.agents - INFO - starting worker
2025-03-18 10:37:48,523 - livekit.agents - INFO - registered worker
2025-03-18 10:37:53,657 - livekit.agents - INFO - received job request
2025-03-18 10:37:53,718 - livekit.agents - INFO - initializing job runner
2025-03-18 10:37:53,720 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:37:53,989 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:37:53,991 - livekit.agents - INFO - job runner initialized
2025-03-18 10:37:53,994 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:37:53,996 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-dmuyBFAaqQkDW9o6BAezxh
2025-03-18 10:37:53,997 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:37:53,997 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:37:54,019 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:37:54,021 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:37:54,061 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:37:54,140 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:37:54,142 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:37:54,143 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:37:54,145 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:37:54,230 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:37:54,231 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:37:54,232 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:37:54,233 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:37:54,397 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:37:54,800 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:37:54,801 - portuguese-restaurant-assistant - INFO - Participant joined: programmable-token
2025-03-18 10:37:54,802 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:37:54,803 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:37:54,805 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: TTS.__init__() got an unexpected keyword argument 'key'
2025-03-18 10:37:54,807 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 86, in entrypoint
    tts = elevenlabs.TTS(
          ^^^^^^^^^^^^^^^
TypeError: TTS.__init__() got an unexpected keyword argument 'key'

2025-03-18 10:38:27,929 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:38:27,940 - livekit.agents - INFO - starting worker
2025-03-18 10:38:27,943 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 10:38:28,535 - livekit.agents - INFO - registered worker
2025-03-18 10:38:43,669 - livekit.agents - INFO - received job request
2025-03-18 10:38:43,739 - livekit.agents - INFO - initializing job runner
2025-03-18 10:38:43,740 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:38:44,013 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:38:44,014 - livekit.agents - INFO - job runner initialized
2025-03-18 10:38:44,016 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:38:44,018 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-dmuyBFAaqQkDW9o6BAezxh
2025-03-18 10:38:44,019 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:38:44,020 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:38:44,042 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:38:44,042 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:38:44,083 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:38:44,197 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:38:44,199 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:38:44,200 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:38:44,200 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:38:44,285 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:38:44,285 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:38:44,286 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:38:44,287 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:38:44,458 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:38:44,852 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:38:44,854 - portuguese-restaurant-assistant - INFO - Participant joined: programmable-token
2025-03-18 10:38:44,855 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:38:44,857 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:38:48,452 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:38:48,474 - livekit.agents - INFO - starting worker
2025-03-18 10:38:48,904 - livekit.agents - INFO - registered worker
2025-03-18 10:39:06,698 - livekit.agents - INFO - received job request
2025-03-18 10:39:06,761 - livekit.agents - INFO - initializing job runner
2025-03-18 10:39:06,762 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:39:07,034 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:39:07,035 - livekit.agents - INFO - job runner initialized
2025-03-18 10:39:07,038 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:39:07,040 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-dmuyBFAaqQkDW9o6BAezxh
2025-03-18 10:39:07,041 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:39:07,042 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:39:07,064 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:39:07,065 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:39:07,111 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:39:07,228 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:39:07,229 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:39:07,230 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:39:07,231 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:39:07,314 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:39:07,314 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:39:07,315 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:39:07,316 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:39:07,494 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:39:07,739 - livekit.agents - INFO - received job request
2025-03-18 10:39:07,807 - livekit.agents - INFO - initializing job runner
2025-03-18 10:39:07,808 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:39:08,095 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:39:08,096 - livekit.agents - INFO - job runner initialized
2025-03-18 10:39:08,097 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:39:08,099 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-iqD5QZBNCQFJCwWsjomK8S
2025-03-18 10:39:08,099 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:39:08,100 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:39:08,101 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:39:08,173 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:39:08,175 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:39:08,176 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:39:08,178 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:39:08,258 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:39:08,260 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:39:08,262 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:39:08,263 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:39:08,430 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:39:08,929 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:39:09,779 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:39:09,780 - portuguese-restaurant-assistant - INFO - Participant joined: resilient-data
2025-03-18 10:39:09,781 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:39:09,782 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:39:10,619 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:39:10,694 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:39:10,696 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:39:10,720 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:39:11,346 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:39:15,791 - livekit.agents - INFO - Pipeline STT metrics: duration=5.05, audio_duration=5.05
2025-03-18 10:39:20,793 - livekit.agents - INFO - Pipeline STT metrics: duration=10.05, audio_duration=5.00
2025-03-18 10:39:25,792 - livekit.agents - INFO - Pipeline STT metrics: duration=15.05, audio_duration=5.00
2025-03-18 10:39:27,274 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:39:27,275 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:39:27,275 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:39:27,277 - livekit.agents - DEBUG - job exiting
2025-03-18 10:39:27,279 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:39:27,279 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:39:27,279 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:39:27,280 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:39:30,793 - livekit.agents - INFO - Pipeline STT metrics: duration=20.05, audio_duration=5.00
2025-03-18 10:39:35,792 - livekit.agents - INFO - Pipeline STT metrics: duration=25.05, audio_duration=5.00
2025-03-18 10:39:40,792 - livekit.agents - INFO - Pipeline STT metrics: duration=30.05, audio_duration=5.00
2025-03-18 10:39:45,791 - livekit.agents - INFO - Pipeline STT metrics: duration=35.05, audio_duration=5.00
2025-03-18 10:40:07,265 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:40:07,266 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:40:07,266 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:40:07,269 - livekit.agents - DEBUG - job exiting
2025-03-18 10:40:07,269 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:40:07,270 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=35.049999999999926)
2025-03-18 10:40:07,272 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:40:20,948 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:40:20,970 - livekit.agents - INFO - starting worker
2025-03-18 10:40:21,330 - livekit.agents - INFO - registered worker
2025-03-18 10:40:39,497 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:40:39,511 - livekit.agents - INFO - starting worker
2025-03-18 10:40:39,865 - livekit.agents - INFO - registered worker
2025-03-18 10:41:19,726 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:41:19,743 - livekit.agents - INFO - starting worker
2025-03-18 10:41:20,096 - livekit.agents - INFO - registered worker
2025-03-18 10:41:25,620 - livekit.agents - INFO - received job request
2025-03-18 10:41:25,683 - livekit.agents - INFO - initializing job runner
2025-03-18 10:41:25,683 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:41:25,896 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:41:25,897 - livekit.agents - INFO - job runner initialized
2025-03-18 10:41:25,898 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:41:25,900 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-mQ5TMhUC9FAXJDbGFtzmYF
2025-03-18 10:41:25,900 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:41:25,901 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:41:25,902 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:41:25,903 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:41:25,906 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:41:26,021 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:41:26,022 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:41:26,023 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:41:26,025 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:41:26,148 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:41:26,149 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:41:26,150 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:41:26,151 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:41:26,409 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:41:27,779 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:41:27,780 - portuguese-restaurant-assistant - INFO - Participant joined: synthetic-vault
2025-03-18 10:41:27,781 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:41:27,782 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:41:27,782 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Voice.__init__() got an unexpected keyword argument 'voice_id'
2025-03-18 10:41:27,783 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 88, in entrypoint
    voice=Voice(voice_id="pNInz6obpgDQGcFmaJgB"),  # Antonio voice ID
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Voice.__init__() got an unexpected keyword argument 'voice_id'

2025-03-18 10:41:59,143 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:41:59,158 - livekit.agents - INFO - starting worker
2025-03-18 10:41:59,695 - livekit.agents - INFO - registered worker
2025-03-18 10:42:14,659 - livekit.agents - INFO - received job request
2025-03-18 10:42:14,724 - livekit.agents - INFO - initializing job runner
2025-03-18 10:42:14,726 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:42:15,004 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:42:15,007 - livekit.agents - INFO - job runner initialized
2025-03-18 10:42:15,008 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:42:15,010 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-mQ5TMhUC9FAXJDbGFtzmYF
2025-03-18 10:42:15,011 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:42:15,012 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:42:15,015 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:42:15,015 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:42:15,018 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:42:15,144 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:42:15,146 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:42:15,147 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:42:15,148 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:42:15,233 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:42:15,234 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:42:15,235 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:42:15,235 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:42:15,398 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:42:16,972 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:42:25,120 - livekit.agents - INFO - received job request
2025-03-18 10:42:25,182 - livekit.agents - INFO - initializing job runner
2025-03-18 10:42:25,184 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:42:25,420 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:42:25,422 - livekit.agents - INFO - job runner initialized
2025-03-18 10:42:25,424 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:42:25,427 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-dGBKRLMEtcedZoPktftwB5
2025-03-18 10:42:25,428 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:42:25,429 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:42:25,430 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:42:25,521 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:42:25,523 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:42:25,524 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:42:25,525 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:42:25,620 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:42:25,621 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:42:25,623 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:42:25,623 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:42:25,787 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:42:26,104 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:42:26,105 - portuguese-restaurant-assistant - INFO - Participant joined: cloudy-websocket
2025-03-18 10:42:26,106 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:42:26,107 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:42:26,108 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Voice.__init__() missing 2 required positional arguments: 'name' and 'category'
2025-03-18 10:42:26,110 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 88, in entrypoint
    voice=Voice(id="pNInz6obpgDQGcFmaJgB"),  # Antonio voice ID
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Voice.__init__() missing 2 required positional arguments: 'name' and 'category'

2025-03-18 10:42:38,740 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:42:38,741 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:42:38,743 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:42:38,744 - livekit.agents - DEBUG - job exiting
2025-03-18 10:42:38,746 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:42:38,747 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:42:38,748 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:43:02,270 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:43:02,276 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:43:02,282 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:43:02,283 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:43:02,286 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:43:02,291 - livekit.agents - DEBUG - job exiting
2025-03-18 10:44:02,331 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:44:02,341 - livekit.agents - INFO - starting worker
2025-03-18 10:44:02,664 - livekit.agents - INFO - registered worker
2025-03-18 10:44:12,590 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:44:12,600 - livekit.agents - INFO - starting worker
2025-03-18 10:44:12,947 - livekit.agents - INFO - registered worker
2025-03-18 10:44:21,685 - livekit.agents - INFO - received job request
2025-03-18 10:44:21,755 - livekit.agents - INFO - initializing job runner
2025-03-18 10:44:21,756 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:44:22,013 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:44:22,015 - livekit.agents - INFO - job runner initialized
2025-03-18 10:44:22,016 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:44:22,018 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-KQwtU7Gd5nxnauKiZymWrv
2025-03-18 10:44:22,019 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:44:22,019 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:44:22,021 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:44:22,023 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:44:22,026 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:44:22,111 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:44:22,112 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:44:22,114 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:44:22,115 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:44:22,194 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:44:22,196 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:44:22,197 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:44:22,198 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:44:22,363 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:44:22,735 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:44:22,736 - portuguese-restaurant-assistant - INFO - Participant joined: cloudy-script
2025-03-18 10:44:22,737 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:44:22,738 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 10:44:23,466 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:44:23,539 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:44:24,616 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=0ba2e0bd2f04, ttfb=0.7130445000366308, audio_duration=4.05
2025-03-18 10:44:24,625 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:44:28,670 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:44:28,671 - portuguese-restaurant-assistant - INFO - Agent speech committed: Olá! Bem-vindo ao Restaurante Português. Como posso ajudar você hoje?
2025-03-18 10:44:28,671 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:44:29,026 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-18 10:44:31,355 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:44:32,578 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:44:32,579 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c62005bebe8f, end_of_utterance_delay=0.55, transcription_delay=0.00
2025-03-18 10:44:32,598 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:44:32,600 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 10:44:32,601 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:44:32,602 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=8ebff2370268, end_of_utterance_delay=0.58, transcription_delay=0.57
2025-03-18 10:44:32,614 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:44:32,616 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c62005bebe8f, ttft=-1.00, input_tokens=0, output_tokens=0, tokens_per_second=0.00
2025-03-18 10:44:34,025 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-18 10:44:34,212 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=8ebff2370268, ttft=1.19, input_tokens=114, output_tokens=21, tokens_per_second=13.06
2025-03-18 10:44:34,766 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:44:34,813 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=8ebff2370268, ttfb=0.9200243999948725, audio_duration=4.49
2025-03-18 10:44:36,356 - portuguese-restaurant-assistant - INFO - User speech committed: Preciso de encomendar.
2025-03-18 10:44:39,026 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-18 10:44:39,247 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:44:39,249 - portuguese-restaurant-assistant - INFO - Agent speech committed: Claro, como posso ajudar com seu pedido? Gostaria de saber o que temos no menu hoje?
2025-03-18 10:44:39,250 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:44:42,053 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:44:42,424 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:44:42,425 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c9724c9a0029, end_of_utterance_delay=0.76, transcription_delay=0.38
2025-03-18 10:44:43,551 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c9724c9a0029, ttft=0.71, input_tokens=146, output_tokens=44, tokens_per_second=39.17
2025-03-18 10:44:44,077 - livekit.agents - INFO - Pipeline STT metrics: duration=20.04, audio_duration=5.05
2025-03-18 10:44:44,546 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:44:44,645 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c9724c9a0029, ttfb=1.365153300052043, audio_duration=10.87
2025-03-18 10:44:46,186 - portuguese-restaurant-assistant - INFO - User speech committed: Ser por favor.
2025-03-18 10:44:49,188 - livekit.agents - INFO - Pipeline STT metrics: duration=25.15, audio_duration=5.00
2025-03-18 10:44:55,430 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:44:55,435 - portuguese-restaurant-assistant - INFO - Agent speech committed: Claro! Hoje temos bacalhau à Brás, francesinha, arroz de polvo e bife à portuguesa. De sobremesa, há pastel de nata e pudim de ovos. O que gostaria de pedir?
2025-03-18 10:44:55,437 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:45:11,853 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:45:11,857 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:45:11,858 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:45:11,867 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:45:11,867 - livekit.agents - DEBUG - job exiting
2025-03-18 10:45:11,875 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=260, llm_completion_tokens=65, tts_characters_count=310, stt_audio_duration=25.04999999999995)
2025-03-18 10:45:11,878 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:45:56,948 - livekit.agents - INFO - received job request
2025-03-18 10:45:57,016 - livekit.agents - INFO - initializing job runner
2025-03-18 10:45:57,018 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:45:57,263 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:45:57,264 - livekit.agents - INFO - job runner initialized
2025-03-18 10:45:57,264 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:45:57,266 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-d3kKAMSrae39bHBCzLnwfc
2025-03-18 10:45:57,267 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:45:57,267 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:45:57,269 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:45:57,376 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:45:57,377 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:45:57,378 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:45:57,378 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:45:57,457 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:45:57,458 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:45:57,458 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:45:57,459 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:45:57,622 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:45:58,040 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:45:58,042 - portuguese-restaurant-assistant - INFO - Participant joined: wireless-virtualenv
2025-03-18 10:45:58,043 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:45:58,044 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 10:45:58,535 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:45:58,539 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:45:59,751 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=d953597fc211, ttfb=0.5447333000483923, audio_duration=4.55
2025-03-18 10:46:00,532 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:46:03,536 - livekit.agents - INFO - Pipeline STT metrics: duration=5.00, audio_duration=5.00
2025-03-18 10:46:05,068 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:05,069 - portuguese-restaurant-assistant - INFO - Agent speech committed: Olá! Bem-vindo ao Restaurante Português. Como posso ajudar você hoje?
2025-03-18 10:46:05,074 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:46:08,535 - livekit.agents - INFO - Pipeline STT metrics: duration=10.00, audio_duration=5.00
2025-03-18 10:46:09,583 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:46:10,256 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:46:10,257 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=904aaa2d4f23, end_of_utterance_delay=0.55, transcription_delay=0.00
2025-03-18 10:46:10,409 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:46:10,411 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 10:46:10,412 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:46:10,412 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=0b7c310100be, end_of_utterance_delay=0.70, transcription_delay=0.70
2025-03-18 10:46:10,425 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:10,428 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=904aaa2d4f23, ttft=-1.00, input_tokens=0, output_tokens=0, tokens_per_second=0.00
2025-03-18 10:46:11,593 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=0b7c310100be, ttft=0.75, input_tokens=117, output_tokens=28, tokens_per_second=23.75
2025-03-18 10:46:11,696 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 10:46:11,697 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:13,536 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-18 10:46:14,169 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:46:14,525 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:46:14,527 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=bf9b5c77cb8b, end_of_utterance_delay=0.82, transcription_delay=0.46
2025-03-18 10:46:16,262 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:46:16,670 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=bf9b5c77cb8b, ttft=0.82, input_tokens=134, output_tokens=44, tokens_per_second=20.54
2025-03-18 10:46:17,904 - portuguese-restaurant-assistant - INFO - User speech committed: Precisava de 1 frango e, 1 costelinha em Guimarães. Onde é que eu posso encontrar?
2025-03-18 10:46:18,182 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=bf9b5c77cb8b, ttfb=0.7195894999895245, audio_duration=12.67
2025-03-18 10:46:18,535 - livekit.agents - INFO - Pipeline STT metrics: duration=19.99, audio_duration=5.00
2025-03-18 10:46:23,535 - livekit.agents - INFO - Pipeline STT metrics: duration=24.99, audio_duration=5.00
2025-03-18 10:46:28,535 - livekit.agents - INFO - Pipeline STT metrics: duration=30.00, audio_duration=5.00
2025-03-18 10:46:28,920 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:28,922 - portuguese-restaurant-assistant - INFO - Agent speech committed: No nosso restaurante em Guimarães temos pratos deliciosos! Você pode saborear nosso famoso Frango à Portuguesa e suculentas Costelinhas Assadas. Está interessado em fazer uma reserva ou alguma outra questão?
2025-03-18 10:46:28,924 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:46:32,771 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:46:33,125 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:46:33,127 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=3f8d7c0ce0b5, end_of_utterance_delay=0.70, transcription_delay=0.34
2025-03-18 10:46:33,536 - livekit.agents - INFO - Pipeline STT metrics: duration=35.00, audio_duration=5.00
2025-03-18 10:46:34,037 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=3f8d7c0ce0b5, ttft=0.46, input_tokens=195, output_tokens=41, tokens_per_second=45.16
2025-03-18 10:46:35,177 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:46:35,296 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=3f8d7c0ce0b5, ttfb=1.5298622000264004, audio_duration=13.48
2025-03-18 10:46:36,697 - portuguese-restaurant-assistant - INFO - User speech committed: Venha, na churrascaria quitanda.
2025-03-18 10:46:38,537 - livekit.agents - INFO - Pipeline STT metrics: duration=40.00, audio_duration=5.00
2025-03-18 10:46:43,536 - livekit.agents - INFO - Pipeline STT metrics: duration=45.00, audio_duration=5.00
2025-03-18 10:46:48,536 - livekit.agents - INFO - Pipeline STT metrics: duration=50.00, audio_duration=5.00
2025-03-18 10:46:48,643 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:48,645 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ah, entendi! Parece que você está pensando em visitar a Churrascaria Quitanda. Se precisar de mais informações sobre o nosso restaurante ou em fazer uma reserva, estou aqui para ajudar!
2025-03-18 10:46:48,646 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:46:52,221 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:46:52,595 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:46:52,597 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=44006ebe1a89, end_of_utterance_delay=0.81, transcription_delay=0.44
2025-03-18 10:46:53,466 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=44006ebe1a89, ttft=0.54, input_tokens=250, output_tokens=21, tokens_per_second=24.21
2025-03-18 10:46:53,535 - livekit.agents - INFO - Pipeline STT metrics: duration=55.00, audio_duration=5.00
2025-03-18 10:46:54,039 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:46:54,096 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=44006ebe1a89, ttfb=0.7599906999967061, audio_duration=5.04
2025-03-18 10:46:55,626 - portuguese-restaurant-assistant - INFO - User speech committed: Quero fazer 1 reserva.
2025-03-18 10:46:58,536 - livekit.agents - INFO - Pipeline STT metrics: duration=59.99, audio_duration=5.00
2025-03-18 10:46:59,046 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:59,048 - portuguese-restaurant-assistant - INFO - Agent speech committed: Claro! Para qual data e hora você gostaria de fazer a reserva? E para quantas pessoas?
2025-03-18 10:46:59,049 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:47:02,868 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:47:03,235 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:47:03,236 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=58c5e1b91b6a, end_of_utterance_delay=0.89, transcription_delay=0.52
2025-03-18 10:47:03,536 - livekit.agents - INFO - Pipeline STT metrics: duration=64.99, audio_duration=5.00
2025-03-18 10:47:04,084 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=58c5e1b91b6a, ttft=0.44, input_tokens=282, output_tokens=19, tokens_per_second=22.46
2025-03-18 10:47:05,956 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:47:06,014 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=58c5e1b91b6a, ttfb=2.2305778000154532, audio_duration=4.39
2025-03-18 10:47:07,179 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 10:47:07,181 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:47:08,539 - livekit.agents - INFO - Pipeline STT metrics: duration=70.00, audio_duration=5.00
2025-03-18 10:47:10,516 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:47:10,716 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:47:10,717 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c7baccaa76b2, end_of_utterance_delay=0.91, transcription_delay=0.71
2025-03-18 10:47:11,543 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c7baccaa76b2, ttft=0.61, input_tokens=287, output_tokens=20, tokens_per_second=24.26
2025-03-18 10:47:12,207 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:47:12,263 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c7baccaa76b2, ttfb=0.8182243999908678, audio_duration=4.41
2025-03-18 10:47:13,536 - livekit.agents - INFO - Pipeline STT metrics: duration=74.99, audio_duration=5.00
2025-03-18 10:47:13,735 - portuguese-restaurant-assistant - INFO - User speech committed: Para para hoje. A 2 pessoas.
2025-03-18 10:47:16,612 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:47:16,614 - portuguese-restaurant-assistant - INFO - Agent speech committed: Perfeito! Então, uma reserva para hoje para 2 pessoas. Qual horário você prefere?
2025-03-18 10:47:16,620 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:47:18,535 - livekit.agents - INFO - Pipeline STT metrics: duration=80.00, audio_duration=5.00
2025-03-18 10:47:19,908 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:47:20,126 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:47:20,128 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=abf504ef024a, end_of_utterance_delay=0.91, transcription_delay=0.69
2025-03-18 10:47:21,147 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=abf504ef024a, ttft=0.47, input_tokens=320, output_tokens=44, tokens_per_second=43.24
2025-03-18 10:47:22,379 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:47:22,466 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=abf504ef024a, ttfb=1.684486599988304, audio_duration=10.34
2025-03-18 10:47:23,537 - livekit.agents - INFO - Pipeline STT metrics: duration=85.00, audio_duration=5.00
2025-03-18 10:47:23,905 - portuguese-restaurant-assistant - INFO - User speech committed: Era o meiodia.
2025-03-18 10:47:28,536 - livekit.agents - INFO - Pipeline STT metrics: duration=90.00, audio_duration=5.00
2025-03-18 10:47:32,724 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:47:32,727 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ótimo, então uma reserva para hoje ao meio-dia para 2 pessoas. Está tudo certo! Aguardamos a sua visita. Se precisar de mais alguma coisa, é só avisar. Até logo!
2025-03-18 10:47:32,731 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:47:33,536 - livekit.agents - INFO - Pipeline STT metrics: duration=95.00, audio_duration=5.00
2025-03-18 10:47:56,864 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:47:56,868 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:47:56,877 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-18 10:47:56,882 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:47:56,883 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:47:56,895 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:47:56,897 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=1585, llm_completion_tokens=217, tts_characters_count=862, stt_audio_duration=94.9999999999998)
2025-03-18 10:47:56,898 - livekit.agents - DEBUG - job exiting
2025-03-18 10:47:56,904 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 11:03:01,531 - livekit.agents - INFO - shutting down worker
2025-03-18 11:03:01,558 - asyncio - ERROR - Exception in callback _ProactorBasePipeTransport._call_connection_lost(None)
handle: <Handle _ProactorBasePipeTransport._call_connection_lost(None)>
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Python312\Lib\asyncio\proactor_events.py", line 165, in _call_connection_lost
    self._sock.shutdown(socket.SHUT_RDWR)
ConnectionResetError: [WinError 10054] Uma ligação existente foi forçada a fechar pelo anfitrião remoto
2025-03-18 11:03:01,838 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:209> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 11:03:01,843 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 11:03:01,844 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-43' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 11:03:01,845 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 11:03:01,852 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-51' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 11:03:01,853 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-50' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 11:03:01,853 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 11:03:01,854 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 11:03:01,855 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 11:03:01,856 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-45' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 11:03:01,858 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 11:03:01,873 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 11:03:01,876 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-63' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 11:03:01,877 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-62' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 11:03:01,878 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-61' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 11:03:01,879 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-60' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 12:37:08,596 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:37:08,602 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 12:37:42,363 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:37:42,371 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 12:37:45,013 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:37:45,022 - livekit.agents - INFO - starting worker
2025-03-18 12:37:46,162 - livekit.agents - INFO - registered worker
2025-03-18 12:38:01,202 - livekit.agents - INFO - received job request
2025-03-18 12:38:01,275 - livekit.agents - INFO - initializing job runner
2025-03-18 12:38:01,276 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 12:38:01,638 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 12:38:01,640 - livekit.agents - INFO - job runner initialized
2025-03-18 12:38:01,641 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:38:01,644 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-QWJ3DZcsZxraLFFs5U8pUJ
2025-03-18 12:38:01,644 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 12:38:01,645 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 12:38:01,669 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 12:38:01,670 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 12:38:01,716 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 12:38:01,818 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 12:38:01,819 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 12:38:01,821 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 12:38:01,823 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 12:38:01,917 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 12:38:01,917 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 12:38:01,918 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 12:38:01,919 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 12:38:02,110 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 12:38:03,545 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 12:38:03,547 - portuguese-restaurant-assistant - INFO - Participant joined: holographic-token
2025-03-18 12:38:03,548 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 12:38:03,549 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 12:38:04,309 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.
2025-03-18 12:38:04,315 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 230, in entrypoint
    @assistant.on("user_speech_committed")
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 172, in decorator
    self.on(event, callback)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\pipeline_agent.py", line 431, in on
    return super().on(event, callback)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 161, in on
    raise ValueError(
ValueError: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.

2025-03-18 12:38:44,385 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 12:38:44,387 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 12:38:44,390 - livekit.agents - DEBUG - shutting down job task
2025-03-18 12:38:44,390 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 12:38:44,391 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 12:38:44,394 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 12:38:44,395 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 12:38:44,397 - livekit.agents - DEBUG - job exiting
2025-03-18 12:39:00,261 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:39:00,282 - livekit.agents - INFO - starting worker
2025-03-18 12:39:00,286 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 12:39:01,125 - livekit.agents - INFO - registered worker
2025-03-18 12:39:18,124 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:39:18,132 - livekit.agents - INFO - starting worker
2025-03-18 12:39:18,469 - livekit.agents - INFO - registered worker
2025-03-18 12:39:37,875 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:39:37,886 - livekit.agents - INFO - starting worker
2025-03-18 12:39:38,596 - livekit.agents - INFO - registered worker
2025-03-18 12:39:58,779 - livekit.agents - INFO - received job request
2025-03-18 12:39:58,851 - livekit.agents - INFO - initializing job runner
2025-03-18 12:39:58,852 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 12:39:59,610 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 12:39:59,671 - livekit.agents - INFO - job runner initialized
2025-03-18 12:39:59,767 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:39:59,777 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-nks4idLUBAf4bWLZ7uTnvH
2025-03-18 12:39:59,779 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 12:39:59,781 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 12:39:59,836 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 12:39:59,841 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 12:39:59,911 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 12:40:00,011 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 12:40:00,013 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 12:40:00,016 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 12:40:00,018 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 12:40:00,351 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 12:40:00,354 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 12:40:00,356 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 12:40:00,358 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 12:40:00,577 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 12:40:01,057 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 12:40:01,060 - portuguese-restaurant-assistant - INFO - Participant joined: dynamic-container
2025-03-18 12:40:01,061 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 12:40:01,063 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 12:40:01,926 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.
2025-03-18 12:40:01,930 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 230, in entrypoint
    @assistant.on("user_speech_committed")
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 172, in decorator
    self.on(event, callback)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\pipeline_agent.py", line 431, in on
    return super().on(event, callback)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 161, in on
    raise ValueError(
ValueError: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.

2025-03-18 12:40:12,510 - livekit.agents - INFO - shutting down worker
2025-03-18 12:40:12,511 - livekit.agents - DEBUG - shutting down job task
2025-03-18 12:40:12,514 - livekit.agents - DEBUG - job exiting
2025-03-18 12:40:12,576 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 12:40:12,580 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 12:40:12,581 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 12:41:25,939 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:41:25,944 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 12:41:29,276 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:41:29,291 - livekit.agents - INFO - starting worker
2025-03-18 12:41:29,627 - livekit.agents - INFO - registered worker
2025-03-18 12:41:33,171 - livekit.agents - INFO - received job request
2025-03-18 12:41:33,244 - livekit.agents - INFO - initializing job runner
2025-03-18 12:41:33,245 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 12:41:33,590 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 12:41:33,591 - livekit.agents - INFO - job runner initialized
2025-03-18 12:41:33,592 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:41:33,595 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-VNBEtdDBNLZdFFMpFcG39n
2025-03-18 12:41:33,595 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 12:41:33,597 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 12:41:33,601 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 12:41:33,603 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 12:41:33,607 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 12:41:33,690 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 12:41:33,691 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 12:41:33,692 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 12:41:33,693 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 12:41:33,781 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 12:41:33,782 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 12:41:33,783 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 12:41:33,784 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 12:41:33,944 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 12:41:34,327 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 12:41:34,329 - portuguese-restaurant-assistant - INFO - Participant joined: autonomous-interface
2025-03-18 12:41:34,330 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 12:41:34,331 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 12:41:35,107 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 12:41:35,120 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 12:41:35,919 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 12:41:36,020 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=385d17fe2c9e, ttfb=0.4650324000394903, audio_duration=3.76
2025-03-18 12:41:39,678 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:41:39,679 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Bem-vindo ao Restaurante Português. Em que posso ser útil hoje?
2025-03-18 12:41:39,680 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 12:41:40,157 - livekit.agents - INFO - Pipeline STT metrics: duration=5.03, audio_duration=5.05
2025-03-18 12:41:44,544 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 12:41:44,916 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 12:41:44,917 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=69e994f67fe7, end_of_utterance_delay=0.72, transcription_delay=0.34
2025-03-18 12:41:45,157 - livekit.agents - INFO - Pipeline STT metrics: duration=10.03, audio_duration=5.00
2025-03-18 12:41:46,668 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=69e994f67fe7, ttft=1.19, input_tokens=539, output_tokens=29, tokens_per_second=16.58
2025-03-18 12:41:47,857 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 12:41:47,984 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=69e994f67fe7, ttfb=1.7312861999962479, audio_duration=8.83
2025-03-18 12:41:49,417 - portuguese-restaurant-assistant - INFO - User speech committed: quero que fales em português de portugal, por favor.
2025-03-18 12:41:50,157 - livekit.agents - INFO - Pipeline STT metrics: duration=15.03, audio_duration=5.00
2025-03-18 12:41:55,156 - livekit.agents - INFO - Pipeline STT metrics: duration=20.03, audio_duration=5.00
2025-03-18 12:41:56,686 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:41:56,687 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ora bem, é exatamente isso que estou a fazer! Estou aqui para ajudar o senhor da melhor maneira possível. Como posso ser útil hoje?
2025-03-18 12:41:56,688 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 12:41:59,252 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 12:41:59,607 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 12:41:59,608 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=7d4795de6183, end_of_utterance_delay=0.75, transcription_delay=0.39
2025-03-18 12:42:00,155 - livekit.agents - INFO - Pipeline STT metrics: duration=25.03, audio_duration=5.00
2025-03-18 12:42:00,986 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=7d4795de6183, ttft=0.48, input_tokens=584, output_tokens=61, tokens_per_second=44.37
2025-03-18 12:42:01,830 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 12:42:03,376 - portuguese-restaurant-assistant - INFO - User speech committed: o que é que fez no teu manual?
2025-03-18 12:42:05,158 - livekit.agents - INFO - Pipeline STT metrics: duration=30.03, audio_duration=5.00
2025-03-18 12:42:10,156 - livekit.agents - INFO - Pipeline STT metrics: duration=35.03, audio_duration=5.00
2025-03-18 12:42:12,587 - livekit.agents - INFO - shutting down worker
2025-03-18 12:42:12,591 - livekit.agents - DEBUG - shutting down job task
2025-03-18 12:42:12,594 - livekit.agents - DEBUG - job exiting
2025-03-18 12:42:12,655 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 12:42:12,660 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 12:42:12,661 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=1123, llm_completion_tokens=90, tts_characters_count=205, stt_audio_duration=35.049999999999926)
2025-03-18 12:42:12,664 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 12:45:16,786 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:45:16,793 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 12:45:19,197 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:45:19,207 - livekit.agents - INFO - starting worker
2025-03-18 12:45:19,532 - livekit.agents - INFO - registered worker
2025-03-18 12:45:35,686 - livekit.agents - INFO - received job request
2025-03-18 12:45:35,751 - livekit.agents - INFO - initializing job runner
2025-03-18 12:45:35,752 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 12:45:36,022 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 12:45:36,025 - livekit.agents - INFO - job runner initialized
2025-03-18 12:45:36,025 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:45:36,028 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-F7DeMDsg3LupA8FLPF6yof
2025-03-18 12:45:36,029 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 12:45:36,030 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 12:45:36,033 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 12:45:36,034 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 12:45:36,037 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 12:45:36,109 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 12:45:36,111 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 12:45:36,112 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 12:45:36,113 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 12:45:36,322 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 12:45:36,323 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 12:45:36,325 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 12:45:36,326 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 12:45:36,487 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 12:45:37,860 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 12:45:37,860 - portuguese-restaurant-assistant - INFO - Participant joined: synthetic-registry
2025-03-18 12:45:37,862 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 12:45:37,863 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 12:45:38,513 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 12:45:38,582 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 12:45:38,881 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=081a94e6168c, body=None)
2025-03-18 12:45:38,893 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=081a94e6168c, body=None)
2025-03-18 12:45:38,906 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=081a94e6168c, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 12:45:39,259 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:45:43,656 - livekit.agents - INFO - Pipeline STT metrics: duration=5.00, audio_duration=5.00
2025-03-18 12:45:48,656 - livekit.agents - INFO - Pipeline STT metrics: duration=10.00, audio_duration=5.00
2025-03-18 12:45:53,658 - livekit.agents - INFO - Pipeline STT metrics: duration=15.00, audio_duration=5.00
2025-03-18 12:45:56,631 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 12:45:57,127 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 12:45:57,128 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=8cf635858502, end_of_utterance_delay=1.06, transcription_delay=0.57
2025-03-18 12:45:58,234 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=9800d68e5403, body=None)
2025-03-18 12:45:58,238 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=9800d68e5403, body=None)
2025-03-18 12:45:58,244 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=9800d68e5403, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 12:45:58,414 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=8cf635858502, ttft=0.87, input_tokens=507, output_tokens=32, tokens_per_second=24.94
2025-03-18 12:45:58,656 - livekit.agents - INFO - Pipeline STT metrics: duration=20.00, audio_duration=5.00
2025-03-18 12:45:58,690 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=a2c3abff32f7, body=None)
2025-03-18 12:45:58,695 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=a2c3abff32f7, body=None)
2025-03-18 12:45:58,701 - livekit.agents - WARNING - failed to synthesize speech, retrying in 5.0s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=a2c3abff32f7, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 12:46:03,658 - livekit.agents - INFO - Pipeline STT metrics: duration=25.00, audio_duration=5.00
2025-03-18 12:46:03,719 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:46:03,720 - portuguese-restaurant-assistant - INFO - User speech committed: olá,
2025-03-18 12:46:29,291 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 12:46:29,293 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 12:46:29,298 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 12:46:29,300 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-18 12:46:29,303 - livekit.agents - DEBUG - shutting down job task
2025-03-18 12:46:29,308 - livekit.agents - DEBUG - job exiting
2025-03-18 12:46:29,308 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=507, llm_completion_tokens=32, tts_characters_count=0, stt_audio_duration=24.99999999999995)
2025-03-18 12:46:29,309 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 12:46:29,312 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 12:49:28,421 - livekit.agents - INFO - shutting down worker
2025-03-18 12:49:34,763 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:49:34,769 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 12:49:37,969 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:49:37,980 - livekit.agents - INFO - starting worker
2025-03-18 12:49:38,310 - livekit.agents - INFO - registered worker
2025-03-18 12:49:42,701 - livekit.agents - INFO - received job request
2025-03-18 12:49:42,763 - livekit.agents - INFO - initializing job runner
2025-03-18 12:49:42,764 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 12:49:42,998 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 12:49:42,999 - livekit.agents - INFO - job runner initialized
2025-03-18 12:49:42,999 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:49:43,002 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-CRSGENRxuHpx6q2tfWDz5a
2025-03-18 12:49:43,003 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 12:49:43,004 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 12:49:43,007 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 12:49:43,008 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 12:49:43,010 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 12:49:43,124 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 12:49:43,125 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 12:49:43,127 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 12:49:43,128 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 12:49:43,208 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 12:49:43,209 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 12:49:43,209 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 12:49:43,211 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 12:49:43,375 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 12:49:43,724 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 12:49:43,725 - portuguese-restaurant-assistant - INFO - Participant joined: seamless-network
2025-03-18 12:49:43,726 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 12:49:43,726 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 12:49:44,388 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 12:49:44,457 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 12:49:45,223 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 12:49:45,299 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=3541f814a741, ttfb=0.5450915999826975, audio_duration=4.31
2025-03-18 12:49:49,515 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:49:49,516 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Bem-vindo ao Restaurante Português. Em que posso ser útil hoje?
2025-03-18 12:49:49,517 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 12:49:49,530 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-18 12:49:52,727 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 12:49:53,030 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 12:49:53,032 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=b99b042c5baa, end_of_utterance_delay=0.91, transcription_delay=0.61
2025-03-18 12:49:54,421 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=b99b042c5baa, ttft=0.63, input_tokens=534, output_tokens=45, tokens_per_second=32.47
2025-03-18 12:49:54,529 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-18 12:49:55,310 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 12:49:55,436 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=b99b042c5baa, ttfb=1.5890911999740638, audio_duration=11.52
2025-03-18 12:49:56,972 - portuguese-restaurant-assistant - INFO - User speech committed: quero fazer 1 encomenda.
2025-03-18 12:49:59,530 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-18 12:50:04,532 - livekit.agents - INFO - Pipeline STT metrics: duration=19.99, audio_duration=5.00
2025-03-18 12:50:06,831 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:50:06,832 - portuguese-restaurant-assistant - INFO - Agent speech committed: Pronto, não fazemos encomendas directamente por aqui, mas posso ajudar a selecionar pratos do nosso menu ou informar sobre as especialidades da casa. Está à procura de alguma sugestão ou detalhes sobre algum prato em particular?
2025-03-18 12:50:06,834 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 12:50:09,188 - livekit.agents - INFO - shutting down worker
2025-03-18 12:50:09,190 - livekit.agents - DEBUG - shutting down job task
2025-03-18 12:50:09,191 - livekit.agents - DEBUG - job exiting
2025-03-18 12:50:09,256 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 12:50:09,261 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=534, llm_completion_tokens=45, tts_characters_count=302, stt_audio_duration=19.99999999999996)
2025-03-18 12:50:09,262 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 12:50:09,320 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:360> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 12:50:09,325 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 12:50:09,326 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-40' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 12:50:09,327 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 12:50:09,336 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 12:50:09,338 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 12:50:09,339 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 12:50:09,341 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-45' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 12:50:09,342 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 12:50:09,343 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 12:50:09,381 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 12:50:09,382 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 12:50:09,384 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 12:50:09,385 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 12:50:09,386 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 12:50:09,396 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:11:15,847 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 13:11:15,868 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 13:11:21,085 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 13:11:21,127 - livekit.agents - INFO - starting worker
2025-03-18 13:11:21,649 - livekit.agents - INFO - registered worker
2025-03-18 13:11:26,604 - livekit.agents - INFO - received job request
2025-03-18 13:11:26,669 - livekit.agents - INFO - initializing job runner
2025-03-18 13:11:26,672 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 13:11:27,016 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 13:11:27,017 - livekit.agents - INFO - job runner initialized
2025-03-18 13:11:27,017 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 13:11:27,020 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-DJneR3ZvdhjZ8LugeDwUne
2025-03-18 13:11:27,020 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 13:11:27,021 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 13:11:27,037 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 13:11:27,038 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 13:11:27,085 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 13:11:27,167 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 13:11:27,169 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 13:11:27,171 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 13:11:27,171 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 13:11:27,281 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 13:11:27,282 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 13:11:27,283 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 13:11:27,285 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 13:11:27,450 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 13:11:28,896 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 13:11:28,898 - portuguese-restaurant-assistant - INFO - Participant joined: micro-widget
2025-03-18 13:11:28,899 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 13:11:28,900 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 13:11:29,552 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 13:11:29,623 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 13:11:30,308 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 13:11:30,916 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=1179a0091514, ttfb=0.4398312999983318, audio_duration=6.40
2025-03-18 13:11:34,703 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-18 13:11:36,712 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 13:11:36,715 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Bem-vindo ao Restaurante Português. O que gostaria de encomendar hoje?
2025-03-18 13:11:36,717 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 13:11:39,703 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-18 13:11:41,043 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 13:11:41,423 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 13:11:41,426 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=3ab745264c49, end_of_utterance_delay=0.87, transcription_delay=0.49
2025-03-18 13:11:44,703 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-18 13:11:45,298 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=3ab745264c49, ttft=3.30, input_tokens=435, output_tokens=26, tokens_per_second=6.72
2025-03-18 13:11:45,882 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 13:11:45,965 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=3ab745264c49, ttfb=0.8287425999878906, audio_duration=5.22
2025-03-18 13:11:47,417 - portuguese-restaurant-assistant - INFO - User speech committed: quero 1 frango e 1 batata, por favor.
2025-03-18 13:11:49,701 - livekit.agents - INFO - Pipeline STT metrics: duration=19.99, audio_duration=5.00
2025-03-18 13:11:51,116 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 13:11:51,117 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ora bem, tomou uma boa escolha com o frango e a batata! A que hora deseja levantar o seu pedido?
2025-03-18 13:11:51,117 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 13:11:54,702 - livekit.agents - INFO - Pipeline STT metrics: duration=24.99, audio_duration=5.00
2025-03-18 13:11:55,286 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 13:11:55,642 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 13:11:55,643 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=de09c9d5e527, end_of_utterance_delay=0.88, transcription_delay=0.52
2025-03-18 13:11:56,867 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=de09c9d5e527, ttft=0.64, input_tokens=473, output_tokens=21, tokens_per_second=17.20
2025-03-18 13:11:57,543 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 13:11:57,598 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=de09c9d5e527, ttfb=1.1976276999921538, audio_duration=4.60
2025-03-18 13:11:59,231 - portuguese-restaurant-assistant - INFO - User speech committed: que horas tem disponível?
2025-03-18 13:11:59,703 - livekit.agents - INFO - Pipeline STT metrics: duration=29.99, audio_duration=5.00
2025-03-18 13:12:02,150 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 13:12:02,154 - portuguese-restaurant-assistant - INFO - Agent speech committed: Temos disponibilidade a partir das 12h. Qual seria a hora mais conveniente para o senhor?
2025-03-18 13:12:02,156 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 13:12:04,702 - livekit.agents - INFO - Pipeline STT metrics: duration=34.99, audio_duration=5.00
2025-03-18 13:12:04,987 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 13:12:05,363 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 13:12:05,363 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=5cc77339f0d7, end_of_utterance_delay=0.84, transcription_delay=0.47
2025-03-18 13:12:08,531 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=5cc77339f0d7, ttft=2.31, input_tokens=508, output_tokens=31, tokens_per_second=9.79
2025-03-18 13:12:09,152 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 13:12:09,201 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=5cc77339f0d7, ttfb=1.3221057000337169, audio_duration=5.56
2025-03-18 13:12:09,702 - livekit.agents - INFO - Pipeline STT metrics: duration=39.99, audio_duration=5.00
2025-03-18 13:12:10,810 - portuguese-restaurant-assistant - INFO - User speech committed: prometer e meia por favor.
2025-03-18 13:12:14,700 - livekit.agents - INFO - Pipeline STT metrics: duration=44.99, audio_duration=5.00
2025-03-18 13:12:14,726 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 13:12:14,727 - portuguese-restaurant-assistant - INFO - Agent speech committed: Perfeito, então fica marcado para as 12h30. E como se chama a senhora, por favor, para associar à encomenda?
2025-03-18 13:12:14,728 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 13:12:17,189 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 13:12:17,691 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 13:12:17,692 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=b40be52e93d4, end_of_utterance_delay=1.01, transcription_delay=0.51
2025-03-18 13:12:19,028 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=b40be52e93d4, ttft=0.67, input_tokens=549, output_tokens=42, tokens_per_second=31.48
2025-03-18 13:12:19,702 - livekit.agents - INFO - Pipeline STT metrics: duration=49.99, audio_duration=5.00
2025-03-18 13:12:19,831 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 13:12:19,899 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=b40be52e93d4, ttfb=1.3842381000285968, audio_duration=7.94
2025-03-18 13:12:21,451 - portuguese-restaurant-assistant - INFO - User speech committed: nuno,
2025-03-18 13:12:24,702 - livekit.agents - INFO - Pipeline STT metrics: duration=54.99, audio_duration=5.00
2025-03-18 13:12:27,762 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 13:12:27,763 - portuguese-restaurant-assistant - INFO - Agent speech committed: Muito bem, o senhor Nuno. Então, só para confirmar: 1 frango e 1 batata para levantar às 12h30. Correcto? Muito obrigado, e até logo!
2025-03-18 13:12:27,765 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 13:12:29,702 - livekit.agents - INFO - Pipeline STT metrics: duration=59.99, audio_duration=5.00
2025-03-18 13:12:31,714 - livekit.agents - INFO - shutting down worker
2025-03-18 13:12:31,718 - livekit.agents - DEBUG - shutting down job task
2025-03-18 13:12:31,722 - livekit.agents - DEBUG - job exiting
2025-03-18 13:12:31,784 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 13:12:31,789 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=1965, llm_completion_tokens=120, tts_characters_count=507, stt_audio_duration=59.99999999999989)
2025-03-18 13:12:31,790 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 13:12:31,847 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:353> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 13:12:31,850 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 13:12:31,851 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-40' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 13:12:31,852 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 13:12:31,862 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:12:31,864 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:12:31,865 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 13:12:31,866 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-45' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 13:12:31,867 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 13:12:31,868 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 13:12:31,875 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 13:12:31,879 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 13:12:31,881 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 13:12:31,883 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:12:31,885 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:12:31,896 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:12:31,897 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-163' coro=<_DeferredReplyValidation._run.<locals>._run_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]>>
