2025-03-17 22:52:27,737 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for sandbox contextual-node-16jzjr
2025-03-17 22:52:27,833 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 22:52:27,839 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-17 22:52:29,116 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 22:52:29,242 - livekit.agents - INFO - starting worker
2025-03-17 22:52:29,577 - livekit.agents - INFO - registered worker
2025-03-17 22:52:29,578 - livekit.agents - INFO - connecting to room contextual-node-16jzjr
2025-03-17 22:52:30,245 - livekit.agents - INFO - received job request
2025-03-17 22:52:30,303 - livekit.agents - INFO - received job request
2025-03-17 22:52:30,316 - livekit.agents - INFO - initializing job runner
2025-03-17 22:52:30,317 - livekit.agents - INFO - job runner initialized
2025-03-17 22:52:30,320 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 22:52:30,324 - portuguese-restaurant-assistant - INFO - Starting restaurant voice assistant...
2025-03-17 22:52:30,326 - portuguese-restaurant-assistant - INFO - Testing API connections...
2025-03-17 22:52:30,356 - portuguese-restaurant-assistant - INFO - Fixed: Copied ELEVEN_API_KEY to ELEVENLABS_API_KEY
2025-03-17 22:52:30,383 - livekit.agents - INFO - initializing job runner
2025-03-17 22:52:30,385 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-17 22:52:30,386 - livekit.agents - INFO - job runner initialized
2025-03-17 22:52:30,388 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 22:52:30,390 - portuguese-restaurant-assistant - INFO - Starting restaurant voice assistant...
2025-03-17 22:52:30,391 - portuguese-restaurant-assistant - INFO - Testing API connections...
2025-03-17 22:52:30,405 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-17 22:52:30,413 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-17 22:52:30,431 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-17 22:52:30,451 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-17 22:52:30,452 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-17 22:52:30,524 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-17 22:52:30,525 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-17 22:52:30,526 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-17 22:52:30,527 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-17 22:52:30,535 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-17 22:52:30,536 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-17 22:52:30,537 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-17 22:52:30,538 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-17 22:52:30,605 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-17 22:52:30,607 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-17 22:52:30,607 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-17 22:52:30,609 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-17 22:52:30,628 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-17 22:52:30,629 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-17 22:52:30,630 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-17 22:52:30,631 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-17 22:52:30,767 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-17 22:52:30,795 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-17 22:52:31,114 - portuguese-restaurant-assistant - INFO - Connected to LiveKit room
2025-03-17 22:52:31,115 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-17 22:52:32,194 - portuguese-restaurant-assistant - INFO - Connected to LiveKit room
2025-03-17 22:52:32,195 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-17 23:02:41,293 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:02:41,300 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-17 23:02:43,932 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:02:43,943 - livekit.agents - INFO - starting worker
2025-03-17 23:02:44,341 - livekit.agents - INFO - registered worker
2025-03-17 23:03:01,919 - livekit.agents - INFO - received job request
2025-03-17 23:03:01,981 - livekit.agents - INFO - initializing job runner
2025-03-17 23:03:02,360 - livekit.agents - INFO - job runner initialized
2025-03-17 23:03:02,363 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:03:02,366 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-haxrrEEGWo7jvcjmp3b7if
2025-03-17 23:03:02,367 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-17 23:03:02,386 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-17 23:03:02,388 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-17 23:03:02,427 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-17 23:03:02,511 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-17 23:03:02,514 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-17 23:03:02,515 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-17 23:03:02,517 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-17 23:03:02,601 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-17 23:03:02,602 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-17 23:03:02,603 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-17 23:03:02,604 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-17 23:03:02,761 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-17 23:03:04,226 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-17 23:03:04,227 - portuguese-restaurant-assistant - INFO - Participant joined: futuristic-container
2025-03-17 23:03:04,228 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-17 23:03:04,228 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: VoicePipelineAgent.__init__() got an unexpected keyword argument 'stt_options'
2025-03-17 23:03:04,231 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 97, in entrypoint
    assistant = VoicePipelineAgent(
                ^^^^^^^^^^^^^^^^^^^
TypeError: VoicePipelineAgent.__init__() got an unexpected keyword argument 'stt_options'

2025-03-17 23:03:52,790 - livekit.agents - INFO - shutting down worker
2025-03-17 23:03:52,791 - livekit.agents - DEBUG - shutting down job task
2025-03-17 23:03:52,794 - livekit.agents - DEBUG - job exiting
2025-03-17 23:03:52,923 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: None
2025-03-17 23:03:52,926 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-17 23:03:52,927 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-17 23:04:31,750 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:04:31,756 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-17 23:04:34,932 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:04:34,941 - livekit.agents - INFO - starting worker
2025-03-17 23:04:35,280 - livekit.agents - INFO - registered worker
2025-03-17 23:04:47,597 - livekit.agents - INFO - received job request
2025-03-17 23:04:47,661 - livekit.agents - INFO - initializing job runner
2025-03-17 23:04:47,930 - livekit.agents - INFO - job runner initialized
2025-03-17 23:04:47,931 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:04:47,933 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-kLaAiKbKe5c24RM5nqYQRR
2025-03-17 23:04:47,933 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-17 23:04:47,953 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-17 23:04:47,954 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-17 23:04:47,995 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-17 23:04:48,068 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-17 23:04:48,069 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-17 23:04:48,070 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-17 23:04:48,071 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-17 23:04:48,168 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-17 23:04:48,169 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-17 23:04:48,170 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-17 23:04:48,171 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-17 23:04:48,348 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-17 23:04:49,779 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-17 23:04:49,781 - portuguese-restaurant-assistant - INFO - Participant joined: connected-stream
2025-03-17 23:04:49,782 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-17 23:04:50,577 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-17 23:04:50,578 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: STT.__init__() got an unexpected keyword argument 'key'
2025-03-17 23:04:50,585 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 107, in entrypoint
    stt=deepgram.STT(
        ^^^^^^^^^^^^^
TypeError: STT.__init__() got an unexpected keyword argument 'key'

2025-03-17 23:06:34,671 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:06:34,675 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-17 23:06:36,802 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:06:36,810 - livekit.agents - INFO - starting worker
2025-03-17 23:06:37,133 - livekit.agents - INFO - registered worker
2025-03-17 23:06:47,994 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:06:48,000 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-17 23:06:49,777 - livekit.agents - INFO - received job request
2025-03-17 23:06:49,840 - livekit.agents - INFO - initializing job runner
2025-03-17 23:06:50,569 - livekit.agents - INFO - job runner initialized
2025-03-17 23:06:50,570 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:06:50,574 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-6ZTBNv3pJ8tp556ZH8GC9R
2025-03-17 23:06:50,576 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-17 23:06:50,602 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-17 23:06:50,604 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-17 23:06:50,654 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-17 23:06:50,735 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-17 23:06:50,737 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-17 23:06:50,739 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-17 23:06:50,740 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-17 23:06:50,830 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-17 23:06:50,832 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-17 23:06:50,835 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-17 23:06:50,836 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-17 23:06:50,996 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-17 23:06:51,424 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-17 23:06:51,426 - portuguese-restaurant-assistant - INFO - Participant joined: synchronized-semaphore
2025-03-17 23:06:51,427 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-17 23:06:51,665 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-17 23:06:51,682 - livekit.agents - INFO - starting worker
2025-03-17 23:06:51,968 - livekit.agents - INFO - registered worker
2025-03-17 23:06:52,235 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-17 23:06:53,482 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.
2025-03-17 23:06:53,489 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 119, in entrypoint
    @assistant.on("error")
     ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 172, in decorator
    self.on(event, callback)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\pipeline_agent.py", line 431, in on
    return super().on(event, callback)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 161, in on
    raise ValueError(
ValueError: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.

2025-03-17 23:06:53,494 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:47> result=None> took too long: 2.06 seconds
2025-03-17 23:06:53,496 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:47> result=None> took too long: 2.08 seconds
2025-03-18 02:08:36,156 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"ping timeout\"" UnknownReason Resume
2025-03-18 02:08:36,159 - livekit - ERROR - livekit::rtc_engine::rtc_session:735:livekit::rtc_engine::rtc_session - Subscriber pc state failed
2025-03-18 02:08:36,161 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 0
2025-03-18 02:08:36,162 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "pc_state failed" UnknownReason Resume
2025-03-18 02:08:36,956 - livekit.agents - WARNING - failed to connect to livekit, retrying in 0s: worker connection closed unexpectedly
2025-03-18 02:08:36,960 - livekit.agents - WARNING - failed to connect to livekit, retrying in 2s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 02:08:36,985 - livekit - ERROR - livekit_api::signal_client::signal_stream:192:livekit_api::signal_client::signal_stream - unhandled websocket message Err(Io(Os { code: 10054, kind: ConnectionReset, message: "Uma ligação existente foi forçada a fechar pelo anfitrião remoto." }))
2025-03-18 02:08:36,985 - livekit.agents - WARNING - failed to connect to livekit, retrying in 0s: worker connection closed unexpectedly
2025-03-18 02:08:36,990 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,042 - livekit.agents - WARNING - failed to connect to livekit, retrying in 2s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 02:08:37,050 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,051 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 1
2025-03-18 02:08:37,052 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,054 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,056 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 2
2025-03-18 02:08:37,057 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,058 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,060 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 3
2025-03-18 02:08:37,061 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,062 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,063 - livekit.agents - DEBUG - shutting down job task
2025-03-18 02:08:37,064 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 4
2025-03-18 02:08:37,065 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 02:08:37,066 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,066 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 02:08:37,068 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,069 - livekit.agents - DEBUG - job exiting
2025-03-18 02:08:37,070 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 5
2025-03-18 02:08:37,088 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,091 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,092 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 6
2025-03-18 02:08:37,094 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,095 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,096 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 7
2025-03-18 02:08:37,097 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,099 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,100 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 8
2025-03-18 02:08:37,101 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,102 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,103 - livekit - ERROR - livekit::rtc_engine:716:livekit::rtc_engine - resuming connection... attempt: 9
2025-03-18 02:08:37,104 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&reconnect=1&sid=PA_7VPyof69mwH4&access_token=...
2025-03-18 02:08:37,105 - livekit - ERROR - livekit::rtc_engine:718:livekit::rtc_engine - resuming connection failed: signal failure: ws failure: IO error: Este anfitrião não é conhecido. (os error 11001)
2025-03-18 02:08:37,106 - livekit - ERROR - livekit::rtc_engine:650:livekit::rtc_engine - failed to reconnect to the livekit room
2025-03-18 02:08:37,108 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: UnknownReason
2025-03-18 02:08:38,976 - livekit.agents - WARNING - failed to connect to livekit, retrying in 4s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 02:08:39,056 - livekit.agents - WARNING - failed to connect to livekit, retrying in 4s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:37,860 - livekit.agents - WARNING - failed to connect to livekit, retrying in 6s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:37,938 - livekit.agents - WARNING - failed to connect to livekit, retrying in 6s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:43,870 - livekit.agents - WARNING - failed to connect to livekit, retrying in 8s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:43,949 - livekit.agents - WARNING - failed to connect to livekit, retrying in 8s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:51,889 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:56:51,965 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:57:01,904 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:57:01,981 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:57:11,917 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:57:11,995 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-18 07:57:22,387 - livekit.agents - INFO - registered worker
2025-03-18 07:57:22,458 - livekit.agents - INFO - registered worker
2025-03-18 09:29:08,288 - livekit.agents - INFO - shutting down worker
2025-03-18 09:32:08,192 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:32:08,204 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:32:10,679 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:32:10,690 - livekit.agents - INFO - starting worker
2025-03-18 09:32:11,096 - livekit.agents - INFO - registered worker
2025-03-18 09:32:27,100 - livekit.agents - INFO - received job request
2025-03-18 09:32:27,168 - livekit.agents - INFO - initializing job runner
2025-03-18 09:32:27,678 - livekit.agents - INFO - job runner initialized
2025-03-18 09:32:27,680 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:32:27,682 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-WRo4x4NyKaRko6ZCdChJHE
2025-03-18 09:32:27,683 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:32:27,707 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:32:27,710 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:32:27,770 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:32:27,853 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:32:27,854 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:32:27,855 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:32:27,855 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:32:27,949 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:32:27,952 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:32:27,952 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:32:27,953 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:32:28,134 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:32:31,405 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:32:31,407 - portuguese-restaurant-assistant - INFO - Participant joined: ultra-firewall
2025-03-18 09:32:31,407 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:32:32,615 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-18 09:32:33,460 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.
2025-03-18 09:32:33,466 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 119, in entrypoint
    @assistant.on("error")
     ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 172, in decorator
    self.on(event, callback)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\pipeline_agent.py", line 431, in on
    return super().on(event, callback)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 161, in on
    raise ValueError(
ValueError: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.

2025-03-18 09:32:33,474 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:47> result=None> took too long: 2.06 seconds
2025-03-18 09:32:33,476 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:47> result=None> took too long: 2.06 seconds
2025-03-18 09:32:42,765 - livekit.agents - INFO - shutting down worker
2025-03-18 09:32:42,775 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:32:42,784 - livekit.agents - DEBUG - job exiting
2025-03-18 09:32:42,855 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:32:42,867 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 09:32:42,872 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:32:42,875 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:33:33,071 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:33:33,077 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:33:36,999 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:33:37,012 - livekit.agents - INFO - starting worker
2025-03-18 09:33:37,409 - livekit.agents - INFO - registered worker
2025-03-18 09:35:55,404 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:35:55,427 - livekit.agents - INFO - starting worker
2025-03-18 09:35:55,436 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 09:35:55,809 - livekit.agents - INFO - registered worker
2025-03-18 09:36:47,497 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:36:47,511 - livekit.agents - INFO - starting worker
2025-03-18 09:36:47,860 - livekit.agents - INFO - registered worker
2025-03-18 09:36:49,223 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:36:49,229 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:36:52,465 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:36:52,476 - livekit.agents - INFO - starting worker
2025-03-18 09:36:52,779 - livekit.agents - INFO - registered worker
2025-03-18 09:36:56,864 - livekit.agents - INFO - received job request
2025-03-18 09:36:56,959 - livekit.agents - INFO - initializing job runner
2025-03-18 09:36:56,965 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:36:57,327 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:36:57,328 - livekit.agents - INFO - job runner initialized
2025-03-18 09:36:57,329 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:36:57,334 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-NrGSSvVb5zk3xK5tCEa7u5
2025-03-18 09:36:57,335 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:36:57,336 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:36:57,359 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:36:57,360 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:36:57,405 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:36:57,487 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:36:57,489 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:36:57,490 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:36:57,490 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:36:57,572 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:36:57,574 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:36:57,574 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:36:57,575 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:36:57,747 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:36:59,189 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:36:59,190 - portuguese-restaurant-assistant - INFO - Participant joined: binary-microservice
2025-03-18 09:36:59,192 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:36:59,194 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-18 09:37:01,291 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 09:37:01,292 - livekit.agents - WARNING - Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:193> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]> took too long: 2.11 seconds
2025-03-18 09:37:01,295 - livekit.agents - WARNING - Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:193> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]> took too long: 2.11 seconds
2025-03-18 09:37:01,303 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:37:01,419 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: 'Room' object has no attribute 'connected'
2025-03-18 09:37:01,423 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 199, in entrypoint
    while ctx.room.connected:
          ^^^^^^^^^^^^^^^^^^
AttributeError: 'Room' object has no attribute 'connected'. Did you mean: 'connect'?

2025-03-18 09:37:01,826 - livekit.plugins.openai - ERROR - Error in _decode_loop
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\openai\tts.py", line 191, in _decode_loop
    async with oai_stream as stream:
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_response.py", line 650, in __aenter__
    self.__response = await self._api_request
                      ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\resources\audio\speech.py", line 180, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1767, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1461, in request
    return await self._request(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1562, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-****************************************************************************************************************************************************************************************************************************************************************************************************************************HlgA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-18 09:37:06,299 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-18 09:37:11,296 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-18 09:37:20,596 - livekit.agents - INFO - shutting down worker
2025-03-18 09:37:32,541 - livekit.agents - INFO - shutting down worker
2025-03-18 09:37:32,549 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:37:32,559 - livekit.agents - DEBUG - job exiting
2025-03-18 09:37:32,623 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:37:32,663 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=9.99999999999998)
2025-03-18 09:37:32,664 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:37:32,782 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:32,789 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:32,799 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:434> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:32,808 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() done, defined at C:\Python312\Lib\asyncio\locks.py:199> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 09:37:32,816 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<VoicePipelineAgent._play_speech.<locals>._play_nested_speech() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\pipeline_agent.py:794> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,821 - livekit.agents.pipeline - ERROR - Error in _playout_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_playout.py", line 155, in _playout_task
    await asyncio.wait(
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_playout.py", line 160, in _playout_task
    await utils.aio.gracefully_cancel(capture_task)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:37:32,858 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<AgentPlayout._playout_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,860 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-59' coro=<Event.wait() done, defined at C:\Python312\Lib\asyncio\locks.py:199> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,864 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-60' coro=<AgentPlayout._playout_task.<locals>._capture_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,868 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,871 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-31' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,876 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-35' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 09:37:32,880 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:37:32,914 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-36' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,917 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-38' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:32,923 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:32,926 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,929 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 09:37:32,983 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:32,987 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-33' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 09:37:32,991 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-41' coro=<AgentOutput._synthesize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[set.remove()]>
2025-03-18 09:37:32,994 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<AgentOutput._stream_synthesis_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Task pending name='Task-44' coro=<AgentOutput._stream_synthesis_task.<locals>._read_generated_audio_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[Task.task_wakeup()]> cb=[AgentOutput._synthesize_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py:188, _wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 09:37:32,999 - livekit.agents.pipeline - ERROR - Error in _synthesize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 190, in _synthesize_task
    _ = await asyncio.wait(
        ^^^^^^^^^^^^^^^^^^^
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 194, in _synthesize_task
    await utils.aio.gracefully_cancel(synth)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:37:33,025 - livekit.agents.pipeline - ERROR - Error in _stream_synthesis_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 259, in _stream_synthesis_task
    await read_tts_atask
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 265, in _stream_synthesis_task
    await utils.aio.gracefully_cancel(read_tts_atask, read_transcript_atask)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:37:33,048 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._main_task' coro=<SynthesizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py:285> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]> cb=[SynthesizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py:271]>
2025-03-18 09:37:33,053 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<AgentOutput._stream_synthesis_task.<locals>._read_generated_audio_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[Task.task_wakeup()]>
2025-03-18 09:37:33,056 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-51' coro=<ChunkedStream._run.<locals>._decode_loop() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> exception=AuthenticationError("Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-****************************************************************************************************************************************************************************************************************************************************************************************************************************HlgA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}")>
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\openai\tts.py", line 191, in _decode_loop
    async with oai_stream as stream:
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_response.py", line 650, in __aenter__
    self.__response = await self._api_request
                      ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\resources\audio\speech.py", line 180, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1767, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1461, in request
    return await self._request(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\openai\_base_client.py", line 1562, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-****************************************************************************************************************************************************************************************************************************************************************************************************************************HlgA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-18 09:37:33,091 - livekit.agents.pipeline - ERROR - Error in _read_generated_audio_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 228, in _read_generated_audio_task
    async for audio in tts_stream:
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\agent_output.py", line 237, in _read_generated_audio_task
    await tts_stream.aclose()
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 398, in aclose
    await aio.gracefully_cancel(self._task)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:37:33,116 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<StreamAdapterWrapper._run.<locals>._synthesize() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\stream_adapter.py:94> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:37:33,119 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<ChunkedStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py:165> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:37:33,122 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._synthesize_task' coro=<ChunkedStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py:201> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[ChunkedStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py:141]>
2025-03-18 09:44:59,045 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:44:59,046 - __main__ - INFO - Testing API connections...
2025-03-18 09:44:59,046 - __main__ - ERROR - OpenAI API key not found. Please set the OPENAI_API_KEY environment variable.
2025-03-18 09:44:59,047 - __main__ - ERROR - Deepgram API key not found. Please set the DEEPGRAM_API_KEY environment variable.
2025-03-18 09:44:59,048 - __main__ - ERROR - ElevenLabs API key not found. Please set the ELEVEN_API_KEY environment variable.
2025-03-18 09:44:59,048 - __main__ - ERROR - LiveKit API key not found. Please set the LIVEKIT_API_KEY environment variable.
2025-03-18 09:44:59,049 - __main__ - ERROR - LiveKit Secret API key not found. Please set the LIVEKIT_API_SECRET environment variable.
2025-03-18 09:44:59,052 - __main__ - ERROR - LiveKit configuration incomplete
2025-03-18 09:44:59,053 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:44:59,054 - __main__ - INFO - Preloading VAD model...
2025-03-18 09:44:59,055 - __main__ - ERROR - Failed to preload VAD model: module 'livekit.agents.vad' has no attribute 'preload_model'
2025-03-18 09:44:59,056 - __main__ - ERROR - OpenAI API key not found. Please set the OPENAI_API_KEY environment variable.
2025-03-18 09:44:59,057 - __main__ - ERROR - Cannot initialize voice assistant without a valid OpenAI API key
2025-03-18 09:45:23,571 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:45:23,572 - __main__ - INFO - Testing API connections...
2025-03-18 09:45:23,572 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:45:25,938 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:45:25,988 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:45:25,989 - __main__ - INFO - Deepgram API key found
2025-03-18 09:45:25,989 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:45:25,990 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:45:25,990 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:45:25,991 - __main__ - INFO - Preloading VAD model...
2025-03-18 09:45:25,991 - __main__ - ERROR - Failed to preload VAD model: module 'livekit.agents.vad' has no attribute 'preload_model'
2025-03-18 09:45:40,395 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:45:40,396 - __main__ - INFO - Testing API connections...
2025-03-18 09:45:40,396 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:45:43,019 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:45:43,042 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:45:43,044 - __main__ - INFO - Deepgram API key found
2025-03-18 09:45:43,044 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:45:43,045 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:45:43,046 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:45:43,047 - __main__ - INFO - Preloading VAD model...
2025-03-18 09:45:43,048 - __main__ - ERROR - Failed to preload VAD model: module 'livekit.agents.vad' has no attribute 'preload_model'
2025-03-18 09:47:11,099 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:47:11,099 - __main__ - INFO - Testing API connections...
2025-03-18 09:47:11,099 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:47:12,839 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:47:12,862 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:47:12,863 - __main__ - INFO - Deepgram API key found
2025-03-18 09:47:12,864 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:47:12,865 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:47:12,867 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:47:12,869 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:47:12,871 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:47:12,872 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:47:12,873 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:47:12,875 - __main__ - ERROR - Failed to initialize voice assistant: VoicePipelineAgent.__init__() got an unexpected keyword argument 'language'
2025-03-18 09:47:33,245 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:47:33,245 - __main__ - INFO - Testing API connections...
2025-03-18 09:47:33,246 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:47:35,199 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:47:35,209 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:47:35,210 - __main__ - INFO - Deepgram API key found
2025-03-18 09:47:35,211 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:47:35,211 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:47:35,212 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:47:35,212 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:47:35,213 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:47:35,214 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:47:35,214 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:47:35,215 - __main__ - ERROR - Failed to initialize voice assistant: VoicePipelineAgent.__init__() got an unexpected keyword argument 'chat_context'
2025-03-18 09:48:05,187 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:48:05,188 - __main__ - INFO - Testing API connections...
2025-03-18 09:48:05,188 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:48:07,302 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:48:07,328 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:48:07,329 - __main__ - INFO - Deepgram API key found
2025-03-18 09:48:07,345 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:48:07,346 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:48:07,349 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:48:07,350 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:48:07,351 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:48:07,353 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:48:07,355 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:48:08,045 - __main__ - ERROR - Failed to initialize voice assistant: VoicePipelineAgent.__init__() missing 1 required keyword-only argument: 'vad'
2025-03-18 09:48:45,314 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:48:45,315 - __main__ - INFO - Testing API connections...
2025-03-18 09:48:45,315 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:48:47,161 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:48:47,185 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:48:47,185 - __main__ - INFO - Deepgram API key found
2025-03-18 09:48:47,186 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:48:47,186 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:48:47,188 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:48:47,188 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:48:47,189 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:48:47,189 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:48:47,190 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:48:47,190 - __main__ - INFO - Loading VAD model...
2025-03-18 09:48:47,564 - __main__ - INFO - VAD model loaded successfully
2025-03-18 09:48:48,391 - __main__ - ERROR - Failed to initialize voice assistant: 'VoicePipelineAgent' object has no attribute 'on_user_speech_start'
2025-03-18 09:50:37,515 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:50:37,516 - __main__ - INFO - Testing API connections...
2025-03-18 09:50:37,516 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:50:39,480 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:50:39,504 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:50:39,505 - __main__ - INFO - Deepgram API key found
2025-03-18 09:50:39,506 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:50:39,507 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:50:39,509 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:50:39,511 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:50:39,512 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:50:39,513 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:50:39,514 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:50:39,516 - __main__ - INFO - Loading VAD model...
2025-03-18 09:50:39,872 - __main__ - INFO - VAD model loaded successfully
2025-03-18 09:50:40,760 - __main__ - INFO - Creating LiveKit room connection...
2025-03-18 09:50:40,762 - __main__ - INFO - Starting voice assistant CLI...
2025-03-18 09:50:40,762 - __main__ - ERROR - Failed to connect to LiveKit room: module 'livekit.agents' has no attribute 'dev'
2025-03-18 09:51:04,968 - __main__ - INFO - Starting Portuguese Restaurant Voice Assistant...
2025-03-18 09:51:04,969 - __main__ - INFO - Testing API connections...
2025-03-18 09:51:04,970 - __main__ - INFO - Testing OpenAI API connection...
2025-03-18 09:51:06,358 - httpx - INFO - HTTP Request: GET https://api.openai.com/v1/models "HTTP/1.1 200 OK"
2025-03-18 09:51:06,381 - __main__ - INFO - OpenAI API connection successful
2025-03-18 09:51:06,382 - __main__ - INFO - Deepgram API key found
2025-03-18 09:51:06,384 - __main__ - INFO - ElevenLabs API key found
2025-03-18 09:51:06,385 - __main__ - INFO - LiveKit configuration found. URL: wss://cursorquit-304ysaxl.livekit.cloud
2025-03-18 09:51:06,387 - __main__ - INFO - Setting up assistant system prompt
2025-03-18 09:51:06,388 - __main__ - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:51:06,389 - __main__ - INFO - ElevenLabs TTS initialized successfully
2025-03-18 09:51:06,391 - __main__ - INFO - Setting up Deepgram STT
2025-03-18 09:51:06,393 - __main__ - INFO - Initializing VoicePipelineAgent...
2025-03-18 09:51:06,394 - __main__ - INFO - Loading VAD model...
2025-03-18 09:51:06,740 - __main__ - INFO - VAD model loaded successfully
2025-03-18 09:51:07,561 - __main__ - INFO - Creating LiveKit room connection...
2025-03-18 09:51:07,561 - __main__ - INFO - Starting voice assistant CLI...
2025-03-18 09:51:32,106 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:51:32,112 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:51:35,866 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:51:35,876 - livekit.agents - INFO - starting worker
2025-03-18 09:51:36,211 - livekit.agents - INFO - registered worker
2025-03-18 09:51:42,836 - livekit.agents - INFO - received job request
2025-03-18 09:51:42,912 - livekit.agents - INFO - initializing job runner
2025-03-18 09:51:42,917 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:51:43,208 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:51:43,209 - livekit.agents - INFO - job runner initialized
2025-03-18 09:51:43,211 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:51:43,214 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-mnqJstFxXfjEPJJwXpwmMW
2025-03-18 09:51:43,215 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:51:43,216 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:51:43,239 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:51:43,243 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:51:43,292 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:51:43,377 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:51:43,380 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:51:43,381 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:51:43,383 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:51:43,773 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:51:43,778 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:51:43,783 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:51:43,787 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:51:43,938 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:51:44,368 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:51:44,373 - portuguese-restaurant-assistant - INFO - Participant joined: modular-token
2025-03-18 09:51:44,378 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:51:44,381 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-18 09:51:45,938 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 09:51:45,947 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:51:46,069 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: 'Room' object has no attribute 'connected'
2025-03-18 09:51:46,076 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 199, in entrypoint
    while ctx.room.connected:
          ^^^^^^^^^^^^^^^^^^
AttributeError: 'Room' object has no attribute 'connected'. Did you mean: 'connect'?

2025-03-18 09:51:47,791 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 09:51:47,925 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=050159db9450, ttfb=1.6978136000107042, audio_duration=2.40
2025-03-18 09:51:49,377 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=050159db9450, ttfb=1.423128700000234, audio_duration=1.66
2025-03-18 09:51:51,000 - livekit.agents - INFO - Pipeline STT metrics: duration=5.05, audio_duration=5.05
2025-03-18 09:51:51,864 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 09:51:51,868 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 09:52:17,281 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:52:17,286 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:52:17,290 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 09:52:17,295 - livekit.agents - DEBUG - job exiting
2025-03-18 09:52:17,302 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=68, stt_audio_duration=5.04999999999999)
2025-03-18 09:52:17,308 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 09:52:17,310 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:54:17,370 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:17,412 - livekit.agents - INFO - starting worker
2025-03-18 09:54:17,417 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 09:54:17,775 - livekit.agents - INFO - registered worker
2025-03-18 09:54:26,636 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:26,649 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:54:30,418 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:30,447 - livekit.agents - INFO - starting worker
2025-03-18 09:54:30,887 - livekit.agents - INFO - registered worker
2025-03-18 09:54:30,889 - livekit.agents - INFO - connecting to room contextual-node-16jzjr
2025-03-18 09:54:31,774 - livekit.agents - INFO - received job request
2025-03-18 09:54:31,826 - livekit.agents - INFO - received job request
2025-03-18 09:54:31,859 - livekit.agents - INFO - initializing job runner
2025-03-18 09:54:31,861 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:54:32,437 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:54:32,441 - livekit.agents - INFO - job runner initialized
2025-03-18 09:54:32,444 - livekit.agents - INFO - initializing job runner
2025-03-18 09:54:32,448 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:32,451 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:54:32,841 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:54:32,846 - livekit.agents - INFO - job runner initialized
2025-03-18 09:54:32,850 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room contextual-node-16jzjr
2025-03-18 09:54:32,853 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:32,880 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:54:32,881 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:54:32,885 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room contextual-node-16jzjr
2025-03-18 09:54:32,886 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:54:32,889 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:54:32,890 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:54:32,891 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:54:32,901 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:54:32,904 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:54:32,982 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:54:32,984 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:54:32,987 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:54:32,988 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:54:33,003 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:54:33,006 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:54:33,008 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:54:33,010 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:54:33,091 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:54:33,094 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:54:33,097 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:54:33,099 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:54:33,110 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:54:33,113 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:54:33,116 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:54:33,119 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:54:33,260 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:54:33,295 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:54:34,697 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:54:34,712 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:54:59,100 - livekit.agents - INFO - received job request
2025-03-18 09:54:59,171 - livekit.agents - INFO - initializing job runner
2025-03-18 09:54:59,175 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:54:59,481 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:54:59,482 - livekit.agents - INFO - job runner initialized
2025-03-18 09:54:59,483 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:54:59,485 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-YdCtzGAB3r7qpz9AHZM4p2
2025-03-18 09:54:59,486 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:54:59,487 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:54:59,491 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:54:59,492 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:54:59,498 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:54:59,580 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:54:59,582 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:54:59,583 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:54:59,584 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:54:59,669 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:54:59,670 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:54:59,671 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:54:59,674 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:54:59,835 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:55:00,219 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:55:00,224 - portuguese-restaurant-assistant - INFO - Participant joined: low-latency-network
2025-03-18 09:55:00,225 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:55:00,229 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:55:00,232 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: TTS.__init__() got an unexpected keyword argument 'key'
2025-03-18 09:55:00,239 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 110, in entrypoint
    tts = elevenlabs.TTS(voice="Antonio", key=elevenlabs_key)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: TTS.__init__() got an unexpected keyword argument 'key'

2025-03-18 09:55:03,719 - livekit.agents - INFO - received job request
2025-03-18 09:55:03,794 - livekit.agents - INFO - initializing job runner
2025-03-18 09:55:03,799 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:55:04,382 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:55:04,392 - livekit.agents - INFO - job runner initialized
2025-03-18 09:55:04,396 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:55:04,406 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room contextual-node-16jzjr
2025-03-18 09:55:04,409 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:55:04,410 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:55:04,413 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:55:04,497 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:55:04,499 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:55:04,500 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:55:04,502 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:55:04,604 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:55:04,607 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:55:04,608 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:55:04,609 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:55:04,799 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:55:06,290 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:55:16,261 - livekit.agents - INFO - shutting down worker
2025-03-18 09:55:16,266 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:55:16,267 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:55:16,271 - livekit.agents - DEBUG - job exiting
2025-03-18 09:55:16,273 - livekit.agents - DEBUG - job exiting
2025-03-18 09:55:16,362 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:55:16,367 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:55:16,370 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:55:16,372 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:55:16,373 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:55:16,376 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:55:16,382 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 09:55:16,464 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:76> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 09:55:38,446 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:55:38,450 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 09:55:41,639 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:55:41,650 - livekit.agents - INFO - starting worker
2025-03-18 09:55:42,011 - livekit.agents - INFO - registered worker
2025-03-18 09:55:49,546 - livekit.agents - INFO - received job request
2025-03-18 09:55:49,617 - livekit.agents - INFO - initializing job runner
2025-03-18 09:55:49,620 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:55:49,898 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:55:49,898 - livekit.agents - INFO - job runner initialized
2025-03-18 09:55:49,901 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:55:49,902 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-27Px6VkzZNagqWbaFhpGhS
2025-03-18 09:55:49,903 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:55:49,903 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:55:49,907 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:55:49,908 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:55:49,913 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:55:49,987 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:55:49,988 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:55:49,989 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:55:49,989 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:55:50,071 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:55:50,072 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:55:50,075 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:55:50,076 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:55:50,236 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:55:51,643 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:55:51,646 - portuguese-restaurant-assistant - INFO - Participant joined: autonomous-shell
2025-03-18 09:55:51,647 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:55:51,647 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 09:55:51,648 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: TTS.__init__() got an unexpected keyword argument 'key'
2025-03-18 09:55:51,650 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 110, in entrypoint
    tts = elevenlabs.TTS(voice="Antonio", key=elevenlabs_key)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: TTS.__init__() got an unexpected keyword argument 'key'

2025-03-18 09:56:07,817 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:56:07,827 - livekit.agents - INFO - starting worker
2025-03-18 09:56:07,831 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 09:56:08,162 - livekit.agents - INFO - registered worker
2025-03-18 09:56:24,683 - livekit.agents - INFO - received job request
2025-03-18 09:56:24,757 - livekit.agents - INFO - initializing job runner
2025-03-18 09:56:24,762 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:56:25,114 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:56:25,114 - livekit.agents - INFO - received job request
2025-03-18 09:56:25,116 - livekit.agents - INFO - job runner initialized
2025-03-18 09:56:25,119 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:56:25,123 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-27Px6VkzZNagqWbaFhpGhS
2025-03-18 09:56:25,125 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:56:25,126 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:56:25,130 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 09:56:25,132 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 09:56:25,137 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:56:25,180 - livekit.agents - INFO - initializing job runner
2025-03-18 09:56:25,182 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 09:56:25,266 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:56:25,559 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 09:56:25,560 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:56:25,561 - livekit.agents - INFO - job runner initialized
2025-03-18 09:56:25,594 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:56:25,595 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 09:56:25,596 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:56:25,600 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-93t63YNdJMfkW3wECTZ5tC
2025-03-18 09:56:25,602 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 09:56:25,602 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:56:25,603 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 09:56:25,606 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:56:25,609 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:56:25,611 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:56:25,613 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 09:56:25,684 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 09:56:25,685 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 09:56:25,687 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 09:56:25,688 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 09:56:25,763 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:56:25,778 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 09:56:25,779 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 09:56:25,780 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 09:56:25,782 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 09:56:25,950 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 09:56:26,134 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:56:26,304 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 09:56:26,305 - portuguese-restaurant-assistant - INFO - Participant joined: autonomous-fork
2025-03-18 09:56:26,305 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 09:56:26,306 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-18 09:56:28,390 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 09:56:28,391 - livekit.agents - WARNING - Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:193> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]> took too long: 2.09 seconds
2025-03-18 09:56:28,395 - livekit.agents - WARNING - Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:193> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]> took too long: 2.09 seconds
2025-03-18 09:56:28,399 - livekit.agents - WARNING - Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:193> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]> took too long: 2.09 seconds
2025-03-18 09:56:28,512 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: 'Room' object has no attribute 'connected'
2025-03-18 09:56:28,523 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 199, in entrypoint
    while ctx.room.connected:
          ^^^^^^^^^^^^^^^^^^
AttributeError: 'Room' object has no attribute 'connected'. Did you mean: 'connect'?

2025-03-18 09:56:28,646 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:56:30,668 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 09:56:30,865 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=efc4268df9ac, ttfb=2.1279976000078022, audio_duration=2.44
2025-03-18 09:56:32,492 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=efc4268df9ac, ttfb=1.4657895999844186, audio_duration=1.68
2025-03-18 09:56:33,679 - livekit.agents - INFO - Pipeline STT metrics: duration=5.00, audio_duration=5.05
2025-03-18 09:56:34,794 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 09:56:34,799 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 09:56:36,208 - livekit.agents - INFO - shutting down worker
2025-03-18 09:56:36,211 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:56:36,212 - livekit.agents - DEBUG - shutting down job task
2025-03-18 09:56:36,218 - livekit.agents - DEBUG - job exiting
2025-03-18 09:56:36,220 - livekit.agents - DEBUG - job exiting
2025-03-18 09:56:36,281 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:56:36,286 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 09:56:36,297 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 09:56:36,303 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:56:36,303 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=68, stt_audio_duration=5.04999999999999)
2025-03-18 09:56:36,306 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 09:56:36,308 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 09:56:36,399 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:70> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 09:56:36,404 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-43' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,406 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,407 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 09:56:36,428 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-65' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:56:36,430 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-64' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:56:36,434 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-61' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 09:56:36,442 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-62' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,446 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,449 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,450 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-59' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 09:56:36,455 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 09:56:36,466 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-71' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 09:56:36,469 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-70' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:56:36,471 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-69' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 09:56:36,474 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-68' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:02:28,859 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:02:28,864 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:02:33,737 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:02:33,755 - livekit.agents - INFO - starting worker
2025-03-18 10:02:34,152 - livekit.agents - INFO - registered worker
2025-03-18 10:02:44,253 - livekit.agents - INFO - received job request
2025-03-18 10:02:44,327 - livekit.agents - INFO - initializing job runner
2025-03-18 10:02:44,329 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:02:44,844 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:02:44,848 - livekit.agents - INFO - job runner initialized
2025-03-18 10:02:44,850 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:02:44,854 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-e84LdPUXUhrgCT8EkZNaeE
2025-03-18 10:02:44,855 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:02:44,856 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:02:44,881 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:02:44,883 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:02:44,946 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:02:45,078 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:02:45,079 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:02:45,081 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:02:45,082 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:02:45,170 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:02:45,171 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:02:45,173 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:02:45,175 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:02:45,343 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:02:46,889 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:02:46,892 - portuguese-restaurant-assistant - INFO - Participant joined: robotic-thread
2025-03-18 10:02:46,892 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:02:46,894 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:02:46,896 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'
2025-03-18 10:02:46,901 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 87, in entrypoint
    elevenlabs_plugin = elevenlabs.ElevenLabs(api_key=elevenlabs_key)
                        ^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'

2025-03-18 10:03:21,899 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:03:21,906 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:03:21,915 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:03:21,919 - livekit.agents - DEBUG - job exiting
2025-03-18 10:03:21,931 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:03:21,935 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:03:21,938 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:05:28,256 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:05:28,269 - livekit.agents - INFO - starting worker
2025-03-18 10:05:28,272 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 10:05:28,632 - livekit.agents - INFO - registered worker
2025-03-18 10:05:42,025 - livekit.agents - INFO - received job request
2025-03-18 10:05:42,097 - livekit.agents - INFO - initializing job runner
2025-03-18 10:05:42,099 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:05:42,416 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:05:42,417 - livekit.agents - INFO - job runner initialized
2025-03-18 10:05:42,418 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:05:42,422 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-nerEzMG7fgz3RBZvHA5nkf
2025-03-18 10:05:42,422 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:05:42,423 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:05:42,427 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:05:42,428 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:05:42,432 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:05:42,519 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:05:42,521 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:05:42,524 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:05:42,526 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:05:42,610 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:05:42,613 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:05:42,615 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:05:42,618 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:05:42,810 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:05:43,194 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:05:43,196 - portuguese-restaurant-assistant - INFO - Participant joined: programmable-mesh
2025-03-18 10:05:43,197 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:05:43,198 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-18 10:05:44,928 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: module 'livekit.rtc' has no attribute 'DTMFEvent'
2025-03-18 10:05:44,932 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 143, in entrypoint
    def on_dtmf_received(event: rtc.DTMFEvent):
                                ^^^^^^^^^^^^^
AttributeError: module 'livekit.rtc' has no attribute 'DTMFEvent'

2025-03-18 10:06:46,666 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:06:46,679 - livekit.agents - INFO - starting worker
2025-03-18 10:06:47,021 - livekit.agents - INFO - registered worker
2025-03-18 10:06:58,721 - livekit.agents - INFO - received job request
2025-03-18 10:06:58,787 - livekit.agents - INFO - initializing job runner
2025-03-18 10:06:58,788 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:06:59,145 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:06:59,147 - livekit.agents - INFO - job runner initialized
2025-03-18 10:06:59,148 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:06:59,152 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-acfsuNnnFnfBbkTqhYYuMn
2025-03-18 10:06:59,153 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:06:59,154 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:06:59,159 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:06:59,161 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:06:59,180 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:06:59,257 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:06:59,259 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:06:59,260 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:06:59,262 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:06:59,349 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:06:59,352 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:06:59,353 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:06:59,353 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:06:59,512 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:07:01,053 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:07:01,057 - portuguese-restaurant-assistant - INFO - Participant joined: modular-vault
2025-03-18 10:07:01,059 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:07:01,063 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:07:01,066 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'
2025-03-18 10:07:01,074 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 87, in entrypoint
    elevenlabs_plugin = elevenlabs.ElevenLabs(api_key=elevenlabs_key)
                        ^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'

2025-03-18 10:07:02,213 - livekit.agents - INFO - received job request
2025-03-18 10:07:02,287 - livekit.agents - INFO - initializing job runner
2025-03-18 10:07:02,290 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:07:02,777 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:07:02,781 - livekit.agents - INFO - job runner initialized
2025-03-18 10:07:02,783 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:07:02,794 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-nerEzMG7fgz3RBZvHA5nkf
2025-03-18 10:07:02,797 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:07:02,799 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:07:02,805 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:07:02,898 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:07:02,903 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:07:02,906 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:07:02,907 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:07:02,995 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:07:02,998 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:07:02,999 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:07:03,002 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:07:03,159 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:07:03,535 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:07:26,878 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:07:26,882 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:07:26,890 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:07:26,892 - livekit.agents - DEBUG - job exiting
2025-03-18 10:07:26,899 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:07:26,904 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:07:26,909 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:07:42,293 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:07:42,298 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:07:42,301 - livekit.agents - DEBUG - job exiting
2025-03-18 10:07:42,305 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:07:42,305 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:07:42,312 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:07:42,320 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:07:42,330 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:07:53,099 - livekit.agents - INFO - shutting down worker
2025-03-18 10:07:53,131 - asyncio - ERROR - Exception in callback _ProactorBasePipeTransport._call_connection_lost(None)
handle: <Handle _ProactorBasePipeTransport._call_connection_lost(None)>
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Python312\Lib\asyncio\proactor_events.py", line 165, in _call_connection_lost
    self._sock.shutdown(socket.SHUT_RDWR)
ConnectionResetError: [WinError 10054] Uma ligação existente foi forçada a fechar pelo anfitrião remoto
2025-03-18 10:07:53,233 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:53> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 10:08:00,156 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:08:00,164 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:08:03,027 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:08:03,037 - livekit.agents - INFO - starting worker
2025-03-18 10:08:03,488 - livekit.agents - INFO - registered worker
2025-03-18 10:08:08,203 - livekit.agents - INFO - received job request
2025-03-18 10:08:08,271 - livekit.agents - INFO - initializing job runner
2025-03-18 10:08:08,273 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:08:08,519 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:08:08,520 - livekit.agents - INFO - job runner initialized
2025-03-18 10:08:08,521 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:08:08,524 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-XnxZ8CCZfNzjZVQZESNcct
2025-03-18 10:08:08,524 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:08:08,525 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:08:08,527 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:08:08,529 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:08:08,532 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:08:08,629 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:08:08,632 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:08:08,636 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:08:08,639 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:08:08,728 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:08:08,730 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:08:08,731 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:08:08,733 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:08:08,898 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:08:10,310 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:08:10,311 - portuguese-restaurant-assistant - INFO - Participant joined: versatile-widget
2025-03-18 10:08:10,311 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:08:10,313 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:08:10,314 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'
2025-03-18 10:08:10,317 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 87, in entrypoint
    elevenlabs_plugin = elevenlabs.ElevenLabs(api_key=elevenlabs_key)
                        ^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'livekit.plugins.elevenlabs' has no attribute 'ElevenLabs'

2025-03-18 10:08:18,187 - livekit.agents - INFO - shutting down worker
2025-03-18 10:08:18,194 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:08:18,202 - livekit.agents - DEBUG - job exiting
2025-03-18 10:08:18,296 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:08:18,303 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:08:18,306 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:09:15,982 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:09:15,987 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:09:18,446 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:09:18,455 - livekit.agents - INFO - starting worker
2025-03-18 10:09:18,813 - livekit.agents - INFO - registered worker
2025-03-18 10:09:29,765 - livekit.agents - INFO - received job request
2025-03-18 10:09:29,838 - livekit.agents - INFO - initializing job runner
2025-03-18 10:09:29,842 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:09:30,225 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:09:30,227 - livekit.agents - INFO - job runner initialized
2025-03-18 10:09:30,230 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:09:30,236 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-NLX8HCtetM5ZbseHSpY6jF
2025-03-18 10:09:30,237 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:09:30,238 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:09:30,240 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:09:30,243 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:09:30,247 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:09:30,373 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:09:30,373 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:09:30,375 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:09:30,376 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:09:30,457 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:09:30,458 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:09:30,461 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:09:30,461 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:09:30,631 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:09:32,123 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:09:32,127 - portuguese-restaurant-assistant - INFO - Participant joined: innovative-shell
2025-03-18 10:09:32,130 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:09:32,134 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:09:33,598 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:09:33,654 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:09:33,767 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:09:33,826 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:09:34,551 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:09:55,426 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:09:55,870 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:09:57,031 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:09:57,053 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:09:57,176 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:09:57,190 - livekit.agents - WARNING - failed to synthesize speech, retrying in 5.0s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:10:02,206 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:10:02,210 - portuguese-restaurant-assistant - INFO - User stopped speaking: ChatMessage(role='user', id='item_eb9fb28ae8cb', name=None, content='Olá,', tool_calls=None, tool_call_id=None, tool_exception=None)
2025-03-18 10:10:13,081 - livekit.agents - INFO - shutting down worker
2025-03-18 10:10:13,087 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:10:13,122 - livekit.agents - DEBUG - job exiting
2025-03-18 10:10:13,185 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:10:13,202 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 10:10:13,204 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=0.0)
2025-03-18 10:10:13,208 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:10:13,283 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,285 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-31' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,287 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 10:10:13,299 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:10:13,300 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-38' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:10:13,303 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,304 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-35' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 10:10:13,308 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-36' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,309 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,312 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-33' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 10:10:13,314 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 10:10:13,322 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:10:13,323 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:10:13,324 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-52' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:10:13,326 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-51' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:14:28,654 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:14:28,661 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:14:31,433 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:14:31,442 - livekit.agents - INFO - starting worker
2025-03-18 10:14:31,809 - livekit.agents - INFO - registered worker
2025-03-18 10:14:38,775 - livekit.agents - INFO - received job request
2025-03-18 10:14:38,842 - livekit.agents - INFO - initializing job runner
2025-03-18 10:14:38,844 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:14:39,200 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:14:39,202 - livekit.agents - INFO - job runner initialized
2025-03-18 10:14:39,203 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:14:39,208 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-PnfRAQU9zXZVaNx5HJYUd5
2025-03-18 10:14:39,209 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:14:39,211 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:14:39,237 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:14:39,239 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:14:39,290 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:14:39,380 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:14:39,381 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:14:39,383 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:14:39,385 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:14:39,476 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:14:39,480 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:14:39,483 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:14:39,486 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:14:39,647 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:14:40,040 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:14:40,044 - portuguese-restaurant-assistant - INFO - Participant joined: cyber-workspace
2025-03-18 10:14:40,045 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:14:40,047 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:14:41,392 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:14:41,514 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:14:41,519 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:14:41,550 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:14:42,156 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:14:53,568 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:14:53,855 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:14:54,790 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:14:54,883 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:14:55,019 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:14:55,039 - livekit.agents - WARNING - failed to synthesize speech, retrying in 5.0s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:15:00,047 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:15:00,050 - portuguese-restaurant-assistant - INFO - User stopped speaking: ChatMessage(role='user', id='item_111fc74b8db1', name=None, content='Olá, boa tarde.', tool_calls=None, tool_call_id=None, tool_exception=None)
2025-03-18 10:15:23,761 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:15:23,764 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:15:23,771 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:15:23,773 - livekit.agents - DEBUG - job exiting
2025-03-18 10:15:23,779 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=0.0)
2025-03-18 10:15:23,786 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:15:23,787 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:16:24,815 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:16:24,828 - livekit.agents - INFO - starting worker
2025-03-18 10:16:24,831 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 10:16:25,179 - livekit.agents - INFO - registered worker
2025-03-18 10:16:26,094 - livekit.agents - INFO - shutting down worker
2025-03-18 10:16:30,391 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:16:30,396 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:16:33,637 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:16:33,657 - livekit.agents - INFO - starting worker
2025-03-18 10:16:33,973 - livekit.agents - INFO - registered worker
2025-03-18 10:16:37,393 - livekit.agents - INFO - received job request
2025-03-18 10:16:37,460 - livekit.agents - INFO - initializing job runner
2025-03-18 10:16:37,463 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:16:37,728 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:16:37,730 - livekit.agents - INFO - job runner initialized
2025-03-18 10:16:37,731 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:16:37,733 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-ixn56PAD5SCRZ6UBgYcCXA
2025-03-18 10:16:37,734 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:16:37,735 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:16:37,737 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:16:37,739 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:16:37,742 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:16:37,841 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:16:37,844 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:16:37,846 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:16:37,848 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:16:37,936 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:16:37,938 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:16:37,940 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:16:37,941 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:16:38,101 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:16:39,508 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:16:39,512 - portuguese-restaurant-assistant - INFO - Participant joined: contextual-bot
2025-03-18 10:16:39,515 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:16:39,518 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:16:40,648 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:16:40,717 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:16:40,718 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:16:40,730 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:16:41,511 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:17:16,874 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:17:16,874 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:17:16,877 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:17:16,878 - livekit.agents - DEBUG - job exiting
2025-03-18 10:17:16,883 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=0.0)
2025-03-18 10:17:16,884 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:17:16,886 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:28:59,417 - livekit.agents - INFO - shutting down worker
2025-03-18 10:28:59,767 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.send_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:28:59,771 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<SpeechStream._run.<locals>.recv_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:28:59,773 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<SpeechStream._run.<locals>.keepalive_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:434> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:28:59,774 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<Event.wait() done, defined at C:\Python312\Lib\asyncio\locks.py:199> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 10:28:59,776 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:28:59,778 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 10:28:59,780 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-41' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 10:28:59,782 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 10:28:59,804 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:28:59,807 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-46' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:28:59,808 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-43' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 10:28:59,810 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:28:59,815 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:28:59,817 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:28:59,819 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 10:35:26,286 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:35:26,292 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:35:29,028 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:35:29,036 - livekit.agents - INFO - starting worker
2025-03-18 10:35:29,401 - livekit.agents - INFO - registered worker
2025-03-18 10:35:40,061 - livekit.agents - INFO - received job request
2025-03-18 10:35:40,130 - livekit.agents - INFO - initializing job runner
2025-03-18 10:35:40,131 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:35:40,493 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:35:40,494 - livekit.agents - INFO - job runner initialized
2025-03-18 10:35:40,496 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:35:40,498 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-c6mQvByC5eRshRi9UzhW9B
2025-03-18 10:35:40,499 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:35:40,502 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:35:40,522 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:35:40,523 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:35:40,561 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:35:41,379 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:35:41,381 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:35:41,382 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:35:41,382 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:35:41,463 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:35:41,465 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:35:41,466 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:35:41,467 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:35:41,789 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:35:42,209 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:35:42,211 - portuguese-restaurant-assistant - INFO - Participant joined: ultra-pipeline
2025-03-18 10:35:42,212 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:35:42,214 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:35:43,481 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:35:43,565 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:35:43,576 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:35:43,647 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:35:44,326 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:35:49,450 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:35:49,814 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:35:50,884 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:35:50,899 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:35:51,014 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:35:51,026 - livekit.agents - WARNING - failed to synthesize speech, retrying in 5.0s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:35:56,058 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:35:56,059 - portuguese-restaurant-assistant - INFO - User stopped speaking: ChatMessage(role='user', id='item_f5b11e85820c', name=None, content='Boa tarde.', tool_calls=None, tool_call_id=None, tool_exception=None)
2025-03-18 10:35:58,004 - livekit.agents - INFO - shutting down worker
2025-03-18 10:35:58,006 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:35:58,009 - livekit.agents - DEBUG - job exiting
2025-03-18 10:35:58,072 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:35:58,083 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=0.0)
2025-03-18 10:35:58,085 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:35:58,148 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:200> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 10:35:58,151 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,152 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,152 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 10:35:58,161 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:35:58,162 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-46' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:35:58,163 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-43' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 10:35:58,166 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,166 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,167 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,168 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-41' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 10:35:58,169 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 10:35:58,175 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 10:35:58,176 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:35:58,177 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:35:58,178 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 10:37:45,456 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:37:45,461 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 10:37:48,156 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:37:48,165 - livekit.agents - INFO - starting worker
2025-03-18 10:37:48,523 - livekit.agents - INFO - registered worker
2025-03-18 10:37:53,657 - livekit.agents - INFO - received job request
2025-03-18 10:37:53,718 - livekit.agents - INFO - initializing job runner
2025-03-18 10:37:53,720 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:37:53,989 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:37:53,991 - livekit.agents - INFO - job runner initialized
2025-03-18 10:37:53,994 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:37:53,996 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-dmuyBFAaqQkDW9o6BAezxh
2025-03-18 10:37:53,997 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:37:53,997 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:37:54,019 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:37:54,021 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:37:54,061 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:37:54,140 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:37:54,142 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:37:54,143 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:37:54,145 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:37:54,230 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:37:54,231 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:37:54,232 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:37:54,233 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:37:54,397 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:37:54,800 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:37:54,801 - portuguese-restaurant-assistant - INFO - Participant joined: programmable-token
2025-03-18 10:37:54,802 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:37:54,803 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:37:54,805 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: TTS.__init__() got an unexpected keyword argument 'key'
2025-03-18 10:37:54,807 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 86, in entrypoint
    tts = elevenlabs.TTS(
          ^^^^^^^^^^^^^^^
TypeError: TTS.__init__() got an unexpected keyword argument 'key'

2025-03-18 10:38:27,929 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:38:27,940 - livekit.agents - INFO - starting worker
2025-03-18 10:38:27,943 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 10:38:28,535 - livekit.agents - INFO - registered worker
2025-03-18 10:38:43,669 - livekit.agents - INFO - received job request
2025-03-18 10:38:43,739 - livekit.agents - INFO - initializing job runner
2025-03-18 10:38:43,740 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:38:44,013 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:38:44,014 - livekit.agents - INFO - job runner initialized
2025-03-18 10:38:44,016 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:38:44,018 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-dmuyBFAaqQkDW9o6BAezxh
2025-03-18 10:38:44,019 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:38:44,020 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:38:44,042 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:38:44,042 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:38:44,083 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:38:44,197 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:38:44,199 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:38:44,200 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:38:44,200 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:38:44,285 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:38:44,285 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:38:44,286 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:38:44,287 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:38:44,458 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:38:44,852 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:38:44,854 - portuguese-restaurant-assistant - INFO - Participant joined: programmable-token
2025-03-18 10:38:44,855 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:38:44,857 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:38:48,452 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:38:48,474 - livekit.agents - INFO - starting worker
2025-03-18 10:38:48,904 - livekit.agents - INFO - registered worker
2025-03-18 10:39:06,698 - livekit.agents - INFO - received job request
2025-03-18 10:39:06,761 - livekit.agents - INFO - initializing job runner
2025-03-18 10:39:06,762 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:39:07,034 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:39:07,035 - livekit.agents - INFO - job runner initialized
2025-03-18 10:39:07,038 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:39:07,040 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-dmuyBFAaqQkDW9o6BAezxh
2025-03-18 10:39:07,041 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:39:07,042 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:39:07,064 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:39:07,065 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:39:07,111 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:39:07,228 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:39:07,229 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:39:07,230 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:39:07,231 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:39:07,314 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:39:07,314 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:39:07,315 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:39:07,316 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:39:07,494 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:39:07,739 - livekit.agents - INFO - received job request
2025-03-18 10:39:07,807 - livekit.agents - INFO - initializing job runner
2025-03-18 10:39:07,808 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:39:08,095 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:39:08,096 - livekit.agents - INFO - job runner initialized
2025-03-18 10:39:08,097 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:39:08,099 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-iqD5QZBNCQFJCwWsjomK8S
2025-03-18 10:39:08,099 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:39:08,100 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:39:08,101 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:39:08,173 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:39:08,175 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:39:08,176 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:39:08,178 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:39:08,258 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:39:08,260 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:39:08,262 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:39:08,263 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:39:08,430 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:39:08,929 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:39:09,779 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:39:09,780 - portuguese-restaurant-assistant - INFO - Participant joined: resilient-data
2025-03-18 10:39:09,781 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:39:09,782 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:39:10,619 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:39:10,694 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:39:10,696 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'
2025-03-18 10:39:10,720 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 400, in _run_ws
    async with self._pool.connection() as ws_conn:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 83, in connection
    conn = await self.get()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 115, in get
    return await self._connect()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\connection_pool.py", line 66, in _connect
    connection = await self._connect_cb()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 186, in _connect_ws
    _stream_url(self._opts),
    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 570, in _stream_url
    voice_id = opts.voice.id
               ^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 10:39:11,346 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:39:15,791 - livekit.agents - INFO - Pipeline STT metrics: duration=5.05, audio_duration=5.05
2025-03-18 10:39:20,793 - livekit.agents - INFO - Pipeline STT metrics: duration=10.05, audio_duration=5.00
2025-03-18 10:39:25,792 - livekit.agents - INFO - Pipeline STT metrics: duration=15.05, audio_duration=5.00
2025-03-18 10:39:27,274 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:39:27,275 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:39:27,275 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:39:27,277 - livekit.agents - DEBUG - job exiting
2025-03-18 10:39:27,279 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:39:27,279 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:39:27,279 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:39:27,280 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:39:30,793 - livekit.agents - INFO - Pipeline STT metrics: duration=20.05, audio_duration=5.00
2025-03-18 10:39:35,792 - livekit.agents - INFO - Pipeline STT metrics: duration=25.05, audio_duration=5.00
2025-03-18 10:39:40,792 - livekit.agents - INFO - Pipeline STT metrics: duration=30.05, audio_duration=5.00
2025-03-18 10:39:45,791 - livekit.agents - INFO - Pipeline STT metrics: duration=35.05, audio_duration=5.00
2025-03-18 10:40:07,265 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:40:07,266 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:40:07,266 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:40:07,269 - livekit.agents - DEBUG - job exiting
2025-03-18 10:40:07,269 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:40:07,270 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=35.049999999999926)
2025-03-18 10:40:07,272 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:40:20,948 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:40:20,970 - livekit.agents - INFO - starting worker
2025-03-18 10:40:21,330 - livekit.agents - INFO - registered worker
2025-03-18 10:40:39,497 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:40:39,511 - livekit.agents - INFO - starting worker
2025-03-18 10:40:39,865 - livekit.agents - INFO - registered worker
2025-03-18 10:41:19,726 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:41:19,743 - livekit.agents - INFO - starting worker
2025-03-18 10:41:20,096 - livekit.agents - INFO - registered worker
2025-03-18 10:41:25,620 - livekit.agents - INFO - received job request
2025-03-18 10:41:25,683 - livekit.agents - INFO - initializing job runner
2025-03-18 10:41:25,683 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:41:25,896 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:41:25,897 - livekit.agents - INFO - job runner initialized
2025-03-18 10:41:25,898 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:41:25,900 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-mQ5TMhUC9FAXJDbGFtzmYF
2025-03-18 10:41:25,900 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:41:25,901 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:41:25,902 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:41:25,903 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:41:25,906 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:41:26,021 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:41:26,022 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:41:26,023 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:41:26,025 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:41:26,148 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:41:26,149 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:41:26,150 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:41:26,151 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:41:26,409 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:41:27,779 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:41:27,780 - portuguese-restaurant-assistant - INFO - Participant joined: synthetic-vault
2025-03-18 10:41:27,781 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:41:27,782 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:41:27,782 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Voice.__init__() got an unexpected keyword argument 'voice_id'
2025-03-18 10:41:27,783 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 88, in entrypoint
    voice=Voice(voice_id="pNInz6obpgDQGcFmaJgB"),  # Antonio voice ID
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Voice.__init__() got an unexpected keyword argument 'voice_id'

2025-03-18 10:41:59,143 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:41:59,158 - livekit.agents - INFO - starting worker
2025-03-18 10:41:59,695 - livekit.agents - INFO - registered worker
2025-03-18 10:42:14,659 - livekit.agents - INFO - received job request
2025-03-18 10:42:14,724 - livekit.agents - INFO - initializing job runner
2025-03-18 10:42:14,726 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:42:15,004 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:42:15,007 - livekit.agents - INFO - job runner initialized
2025-03-18 10:42:15,008 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:42:15,010 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-mQ5TMhUC9FAXJDbGFtzmYF
2025-03-18 10:42:15,011 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:42:15,012 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:42:15,015 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:42:15,015 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:42:15,018 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:42:15,144 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:42:15,146 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:42:15,147 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:42:15,148 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:42:15,233 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:42:15,234 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:42:15,235 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:42:15,235 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:42:15,398 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:42:16,972 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:42:25,120 - livekit.agents - INFO - received job request
2025-03-18 10:42:25,182 - livekit.agents - INFO - initializing job runner
2025-03-18 10:42:25,184 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:42:25,420 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:42:25,422 - livekit.agents - INFO - job runner initialized
2025-03-18 10:42:25,424 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:42:25,427 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-dGBKRLMEtcedZoPktftwB5
2025-03-18 10:42:25,428 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:42:25,429 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:42:25,430 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:42:25,521 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:42:25,523 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:42:25,524 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:42:25,525 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:42:25,620 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:42:25,621 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:42:25,623 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:42:25,623 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:42:25,787 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:42:26,104 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:42:26,105 - portuguese-restaurant-assistant - INFO - Participant joined: cloudy-websocket
2025-03-18 10:42:26,106 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:42:26,107 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Antonio'
2025-03-18 10:42:26,108 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Voice.__init__() missing 2 required positional arguments: 'name' and 'category'
2025-03-18 10:42:26,110 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 88, in entrypoint
    voice=Voice(id="pNInz6obpgDQGcFmaJgB"),  # Antonio voice ID
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Voice.__init__() missing 2 required positional arguments: 'name' and 'category'

2025-03-18 10:42:38,740 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:42:38,741 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:42:38,743 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:42:38,744 - livekit.agents - DEBUG - job exiting
2025-03-18 10:42:38,746 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:42:38,747 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:42:38,748 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:43:02,270 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:43:02,276 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:43:02,282 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:43:02,283 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:43:02,286 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:43:02,291 - livekit.agents - DEBUG - job exiting
2025-03-18 10:44:02,331 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:44:02,341 - livekit.agents - INFO - starting worker
2025-03-18 10:44:02,664 - livekit.agents - INFO - registered worker
2025-03-18 10:44:12,590 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:44:12,600 - livekit.agents - INFO - starting worker
2025-03-18 10:44:12,947 - livekit.agents - INFO - registered worker
2025-03-18 10:44:21,685 - livekit.agents - INFO - received job request
2025-03-18 10:44:21,755 - livekit.agents - INFO - initializing job runner
2025-03-18 10:44:21,756 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:44:22,013 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:44:22,015 - livekit.agents - INFO - job runner initialized
2025-03-18 10:44:22,016 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:44:22,018 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-KQwtU7Gd5nxnauKiZymWrv
2025-03-18 10:44:22,019 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:44:22,019 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:44:22,021 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 10:44:22,023 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 10:44:22,026 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:44:22,111 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:44:22,112 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:44:22,114 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:44:22,115 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:44:22,194 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:44:22,196 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:44:22,197 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:44:22,198 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:44:22,363 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:44:22,735 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:44:22,736 - portuguese-restaurant-assistant - INFO - Participant joined: cloudy-script
2025-03-18 10:44:22,737 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:44:22,738 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 10:44:23,466 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:44:23,539 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:44:24,616 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=0ba2e0bd2f04, ttfb=0.7130445000366308, audio_duration=4.05
2025-03-18 10:44:24,625 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:44:28,670 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:44:28,671 - portuguese-restaurant-assistant - INFO - Agent speech committed: Olá! Bem-vindo ao Restaurante Português. Como posso ajudar você hoje?
2025-03-18 10:44:28,671 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:44:29,026 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-18 10:44:31,355 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:44:32,578 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:44:32,579 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c62005bebe8f, end_of_utterance_delay=0.55, transcription_delay=0.00
2025-03-18 10:44:32,598 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:44:32,600 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 10:44:32,601 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:44:32,602 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=8ebff2370268, end_of_utterance_delay=0.58, transcription_delay=0.57
2025-03-18 10:44:32,614 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:44:32,616 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c62005bebe8f, ttft=-1.00, input_tokens=0, output_tokens=0, tokens_per_second=0.00
2025-03-18 10:44:34,025 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-18 10:44:34,212 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=8ebff2370268, ttft=1.19, input_tokens=114, output_tokens=21, tokens_per_second=13.06
2025-03-18 10:44:34,766 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:44:34,813 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=8ebff2370268, ttfb=0.9200243999948725, audio_duration=4.49
2025-03-18 10:44:36,356 - portuguese-restaurant-assistant - INFO - User speech committed: Preciso de encomendar.
2025-03-18 10:44:39,026 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-18 10:44:39,247 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:44:39,249 - portuguese-restaurant-assistant - INFO - Agent speech committed: Claro, como posso ajudar com seu pedido? Gostaria de saber o que temos no menu hoje?
2025-03-18 10:44:39,250 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:44:42,053 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:44:42,424 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:44:42,425 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c9724c9a0029, end_of_utterance_delay=0.76, transcription_delay=0.38
2025-03-18 10:44:43,551 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c9724c9a0029, ttft=0.71, input_tokens=146, output_tokens=44, tokens_per_second=39.17
2025-03-18 10:44:44,077 - livekit.agents - INFO - Pipeline STT metrics: duration=20.04, audio_duration=5.05
2025-03-18 10:44:44,546 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:44:44,645 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c9724c9a0029, ttfb=1.365153300052043, audio_duration=10.87
2025-03-18 10:44:46,186 - portuguese-restaurant-assistant - INFO - User speech committed: Ser por favor.
2025-03-18 10:44:49,188 - livekit.agents - INFO - Pipeline STT metrics: duration=25.15, audio_duration=5.00
2025-03-18 10:44:55,430 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:44:55,435 - portuguese-restaurant-assistant - INFO - Agent speech committed: Claro! Hoje temos bacalhau à Brás, francesinha, arroz de polvo e bife à portuguesa. De sobremesa, há pastel de nata e pudim de ovos. O que gostaria de pedir?
2025-03-18 10:44:55,437 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:45:11,853 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:45:11,857 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:45:11,858 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:45:11,867 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:45:11,867 - livekit.agents - DEBUG - job exiting
2025-03-18 10:45:11,875 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=260, llm_completion_tokens=65, tts_characters_count=310, stt_audio_duration=25.04999999999995)
2025-03-18 10:45:11,878 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 10:45:56,948 - livekit.agents - INFO - received job request
2025-03-18 10:45:57,016 - livekit.agents - INFO - initializing job runner
2025-03-18 10:45:57,018 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 10:45:57,263 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 10:45:57,264 - livekit.agents - INFO - job runner initialized
2025-03-18 10:45:57,264 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 10:45:57,266 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-d3kKAMSrae39bHBCzLnwfc
2025-03-18 10:45:57,267 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 10:45:57,267 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 10:45:57,269 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 10:45:57,376 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 10:45:57,377 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 10:45:57,378 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 10:45:57,378 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 10:45:57,457 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 10:45:57,458 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 10:45:57,458 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 10:45:57,459 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 10:45:57,622 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 10:45:58,040 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 10:45:58,042 - portuguese-restaurant-assistant - INFO - Participant joined: wireless-virtualenv
2025-03-18 10:45:58,043 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 10:45:58,044 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 10:45:58,535 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 10:45:58,539 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 10:45:59,751 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=d953597fc211, ttfb=0.5447333000483923, audio_duration=4.55
2025-03-18 10:46:00,532 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:46:03,536 - livekit.agents - INFO - Pipeline STT metrics: duration=5.00, audio_duration=5.00
2025-03-18 10:46:05,068 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:05,069 - portuguese-restaurant-assistant - INFO - Agent speech committed: Olá! Bem-vindo ao Restaurante Português. Como posso ajudar você hoje?
2025-03-18 10:46:05,074 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:46:08,535 - livekit.agents - INFO - Pipeline STT metrics: duration=10.00, audio_duration=5.00
2025-03-18 10:46:09,583 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:46:10,256 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:46:10,257 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=904aaa2d4f23, end_of_utterance_delay=0.55, transcription_delay=0.00
2025-03-18 10:46:10,409 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:46:10,411 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 10:46:10,412 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:46:10,412 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=0b7c310100be, end_of_utterance_delay=0.70, transcription_delay=0.70
2025-03-18 10:46:10,425 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:10,428 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=904aaa2d4f23, ttft=-1.00, input_tokens=0, output_tokens=0, tokens_per_second=0.00
2025-03-18 10:46:11,593 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=0b7c310100be, ttft=0.75, input_tokens=117, output_tokens=28, tokens_per_second=23.75
2025-03-18 10:46:11,696 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 10:46:11,697 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:13,536 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-18 10:46:14,169 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:46:14,525 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:46:14,527 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=bf9b5c77cb8b, end_of_utterance_delay=0.82, transcription_delay=0.46
2025-03-18 10:46:16,262 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:46:16,670 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=bf9b5c77cb8b, ttft=0.82, input_tokens=134, output_tokens=44, tokens_per_second=20.54
2025-03-18 10:46:17,904 - portuguese-restaurant-assistant - INFO - User speech committed: Precisava de 1 frango e, 1 costelinha em Guimarães. Onde é que eu posso encontrar?
2025-03-18 10:46:18,182 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=bf9b5c77cb8b, ttfb=0.7195894999895245, audio_duration=12.67
2025-03-18 10:46:18,535 - livekit.agents - INFO - Pipeline STT metrics: duration=19.99, audio_duration=5.00
2025-03-18 10:46:23,535 - livekit.agents - INFO - Pipeline STT metrics: duration=24.99, audio_duration=5.00
2025-03-18 10:46:28,535 - livekit.agents - INFO - Pipeline STT metrics: duration=30.00, audio_duration=5.00
2025-03-18 10:46:28,920 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:28,922 - portuguese-restaurant-assistant - INFO - Agent speech committed: No nosso restaurante em Guimarães temos pratos deliciosos! Você pode saborear nosso famoso Frango à Portuguesa e suculentas Costelinhas Assadas. Está interessado em fazer uma reserva ou alguma outra questão?
2025-03-18 10:46:28,924 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:46:32,771 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:46:33,125 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:46:33,127 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=3f8d7c0ce0b5, end_of_utterance_delay=0.70, transcription_delay=0.34
2025-03-18 10:46:33,536 - livekit.agents - INFO - Pipeline STT metrics: duration=35.00, audio_duration=5.00
2025-03-18 10:46:34,037 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=3f8d7c0ce0b5, ttft=0.46, input_tokens=195, output_tokens=41, tokens_per_second=45.16
2025-03-18 10:46:35,177 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:46:35,296 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=3f8d7c0ce0b5, ttfb=1.5298622000264004, audio_duration=13.48
2025-03-18 10:46:36,697 - portuguese-restaurant-assistant - INFO - User speech committed: Venha, na churrascaria quitanda.
2025-03-18 10:46:38,537 - livekit.agents - INFO - Pipeline STT metrics: duration=40.00, audio_duration=5.00
2025-03-18 10:46:43,536 - livekit.agents - INFO - Pipeline STT metrics: duration=45.00, audio_duration=5.00
2025-03-18 10:46:48,536 - livekit.agents - INFO - Pipeline STT metrics: duration=50.00, audio_duration=5.00
2025-03-18 10:46:48,643 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:48,645 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ah, entendi! Parece que você está pensando em visitar a Churrascaria Quitanda. Se precisar de mais informações sobre o nosso restaurante ou em fazer uma reserva, estou aqui para ajudar!
2025-03-18 10:46:48,646 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:46:52,221 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:46:52,595 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:46:52,597 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=44006ebe1a89, end_of_utterance_delay=0.81, transcription_delay=0.44
2025-03-18 10:46:53,466 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=44006ebe1a89, ttft=0.54, input_tokens=250, output_tokens=21, tokens_per_second=24.21
2025-03-18 10:46:53,535 - livekit.agents - INFO - Pipeline STT metrics: duration=55.00, audio_duration=5.00
2025-03-18 10:46:54,039 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:46:54,096 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=44006ebe1a89, ttfb=0.7599906999967061, audio_duration=5.04
2025-03-18 10:46:55,626 - portuguese-restaurant-assistant - INFO - User speech committed: Quero fazer 1 reserva.
2025-03-18 10:46:58,536 - livekit.agents - INFO - Pipeline STT metrics: duration=59.99, audio_duration=5.00
2025-03-18 10:46:59,046 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:46:59,048 - portuguese-restaurant-assistant - INFO - Agent speech committed: Claro! Para qual data e hora você gostaria de fazer a reserva? E para quantas pessoas?
2025-03-18 10:46:59,049 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:47:02,868 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:47:03,235 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:47:03,236 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=58c5e1b91b6a, end_of_utterance_delay=0.89, transcription_delay=0.52
2025-03-18 10:47:03,536 - livekit.agents - INFO - Pipeline STT metrics: duration=64.99, audio_duration=5.00
2025-03-18 10:47:04,084 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=58c5e1b91b6a, ttft=0.44, input_tokens=282, output_tokens=19, tokens_per_second=22.46
2025-03-18 10:47:05,956 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:47:06,014 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=58c5e1b91b6a, ttfb=2.2305778000154532, audio_duration=4.39
2025-03-18 10:47:07,179 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 10:47:07,181 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:47:08,539 - livekit.agents - INFO - Pipeline STT metrics: duration=70.00, audio_duration=5.00
2025-03-18 10:47:10,516 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:47:10,716 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:47:10,717 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c7baccaa76b2, end_of_utterance_delay=0.91, transcription_delay=0.71
2025-03-18 10:47:11,543 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c7baccaa76b2, ttft=0.61, input_tokens=287, output_tokens=20, tokens_per_second=24.26
2025-03-18 10:47:12,207 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:47:12,263 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c7baccaa76b2, ttfb=0.8182243999908678, audio_duration=4.41
2025-03-18 10:47:13,536 - livekit.agents - INFO - Pipeline STT metrics: duration=74.99, audio_duration=5.00
2025-03-18 10:47:13,735 - portuguese-restaurant-assistant - INFO - User speech committed: Para para hoje. A 2 pessoas.
2025-03-18 10:47:16,612 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:47:16,614 - portuguese-restaurant-assistant - INFO - Agent speech committed: Perfeito! Então, uma reserva para hoje para 2 pessoas. Qual horário você prefere?
2025-03-18 10:47:16,620 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:47:18,535 - livekit.agents - INFO - Pipeline STT metrics: duration=80.00, audio_duration=5.00
2025-03-18 10:47:19,908 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 10:47:20,126 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 10:47:20,128 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=abf504ef024a, end_of_utterance_delay=0.91, transcription_delay=0.69
2025-03-18 10:47:21,147 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=abf504ef024a, ttft=0.47, input_tokens=320, output_tokens=44, tokens_per_second=43.24
2025-03-18 10:47:22,379 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 10:47:22,466 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=abf504ef024a, ttfb=1.684486599988304, audio_duration=10.34
2025-03-18 10:47:23,537 - livekit.agents - INFO - Pipeline STT metrics: duration=85.00, audio_duration=5.00
2025-03-18 10:47:23,905 - portuguese-restaurant-assistant - INFO - User speech committed: Era o meiodia.
2025-03-18 10:47:28,536 - livekit.agents - INFO - Pipeline STT metrics: duration=90.00, audio_duration=5.00
2025-03-18 10:47:32,724 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 10:47:32,727 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ótimo, então uma reserva para hoje ao meio-dia para 2 pessoas. Está tudo certo! Aguardamos a sua visita. Se precisar de mais alguma coisa, é só avisar. Até logo!
2025-03-18 10:47:32,731 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 10:47:33,536 - livekit.agents - INFO - Pipeline STT metrics: duration=95.00, audio_duration=5.00
2025-03-18 10:47:56,864 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 10:47:56,868 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 10:47:56,877 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-18 10:47:56,882 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 10:47:56,883 - livekit.agents - DEBUG - shutting down job task
2025-03-18 10:47:56,895 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 10:47:56,897 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=1585, llm_completion_tokens=217, tts_characters_count=862, stt_audio_duration=94.9999999999998)
2025-03-18 10:47:56,898 - livekit.agents - DEBUG - job exiting
2025-03-18 10:47:56,904 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 11:03:01,531 - livekit.agents - INFO - shutting down worker
2025-03-18 11:03:01,558 - asyncio - ERROR - Exception in callback _ProactorBasePipeTransport._call_connection_lost(None)
handle: <Handle _ProactorBasePipeTransport._call_connection_lost(None)>
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Python312\Lib\asyncio\proactor_events.py", line 165, in _call_connection_lost
    self._sock.shutdown(socket.SHUT_RDWR)
ConnectionResetError: [WinError 10054] Uma ligação existente foi forçada a fechar pelo anfitrião remoto
2025-03-18 11:03:01,838 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:209> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 11:03:01,843 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 11:03:01,844 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-43' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 11:03:01,845 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 11:03:01,852 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-51' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 11:03:01,853 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-50' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 11:03:01,853 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 11:03:01,854 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 11:03:01,855 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 11:03:01,856 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-45' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 11:03:01,858 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 11:03:01,873 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 11:03:01,876 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-63' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 11:03:01,877 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-62' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 11:03:01,878 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-61' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 11:03:01,879 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-60' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 12:37:08,596 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:37:08,602 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 12:37:42,363 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:37:42,371 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 12:37:45,013 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:37:45,022 - livekit.agents - INFO - starting worker
2025-03-18 12:37:46,162 - livekit.agents - INFO - registered worker
2025-03-18 12:38:01,202 - livekit.agents - INFO - received job request
2025-03-18 12:38:01,275 - livekit.agents - INFO - initializing job runner
2025-03-18 12:38:01,276 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 12:38:01,638 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 12:38:01,640 - livekit.agents - INFO - job runner initialized
2025-03-18 12:38:01,641 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:38:01,644 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-QWJ3DZcsZxraLFFs5U8pUJ
2025-03-18 12:38:01,644 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 12:38:01,645 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 12:38:01,669 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 12:38:01,670 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 12:38:01,716 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 12:38:01,818 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 12:38:01,819 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 12:38:01,821 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 12:38:01,823 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 12:38:01,917 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 12:38:01,917 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 12:38:01,918 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 12:38:01,919 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 12:38:02,110 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 12:38:03,545 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 12:38:03,547 - portuguese-restaurant-assistant - INFO - Participant joined: holographic-token
2025-03-18 12:38:03,548 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 12:38:03,549 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 12:38:04,309 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.
2025-03-18 12:38:04,315 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 230, in entrypoint
    @assistant.on("user_speech_committed")
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 172, in decorator
    self.on(event, callback)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\pipeline_agent.py", line 431, in on
    return super().on(event, callback)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 161, in on
    raise ValueError(
ValueError: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.

2025-03-18 12:38:44,385 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 12:38:44,387 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 12:38:44,390 - livekit.agents - DEBUG - shutting down job task
2025-03-18 12:38:44,390 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 12:38:44,391 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 12:38:44,394 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 12:38:44,395 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 12:38:44,397 - livekit.agents - DEBUG - job exiting
2025-03-18 12:39:00,261 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:39:00,282 - livekit.agents - INFO - starting worker
2025-03-18 12:39:00,286 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 12:39:01,125 - livekit.agents - INFO - registered worker
2025-03-18 12:39:18,124 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:39:18,132 - livekit.agents - INFO - starting worker
2025-03-18 12:39:18,469 - livekit.agents - INFO - registered worker
2025-03-18 12:39:37,875 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:39:37,886 - livekit.agents - INFO - starting worker
2025-03-18 12:39:38,596 - livekit.agents - INFO - registered worker
2025-03-18 12:39:58,779 - livekit.agents - INFO - received job request
2025-03-18 12:39:58,851 - livekit.agents - INFO - initializing job runner
2025-03-18 12:39:58,852 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 12:39:59,610 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 12:39:59,671 - livekit.agents - INFO - job runner initialized
2025-03-18 12:39:59,767 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:39:59,777 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-nks4idLUBAf4bWLZ7uTnvH
2025-03-18 12:39:59,779 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 12:39:59,781 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 12:39:59,836 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 12:39:59,841 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 12:39:59,911 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 12:40:00,011 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 12:40:00,013 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 12:40:00,016 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 12:40:00,018 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 12:40:00,351 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 12:40:00,354 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 12:40:00,356 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 12:40:00,358 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 12:40:00,577 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 12:40:01,057 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 12:40:01,060 - portuguese-restaurant-assistant - INFO - Participant joined: dynamic-container
2025-03-18 12:40:01,061 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 12:40:01,063 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 12:40:01,926 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.
2025-03-18 12:40:01,930 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 230, in entrypoint
    @assistant.on("user_speech_committed")
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 172, in decorator
    self.on(event, callback)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\pipeline_agent.py", line 431, in on
    return super().on(event, callback)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 161, in on
    raise ValueError(
ValueError: Cannot register an async callback with `.on()`. Use `asyncio.create_task` within your synchronous callback instead.

2025-03-18 12:40:12,510 - livekit.agents - INFO - shutting down worker
2025-03-18 12:40:12,511 - livekit.agents - DEBUG - shutting down job task
2025-03-18 12:40:12,514 - livekit.agents - DEBUG - job exiting
2025-03-18 12:40:12,576 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 12:40:12,580 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 12:40:12,581 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 12:41:25,939 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:41:25,944 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 12:41:29,276 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:41:29,291 - livekit.agents - INFO - starting worker
2025-03-18 12:41:29,627 - livekit.agents - INFO - registered worker
2025-03-18 12:41:33,171 - livekit.agents - INFO - received job request
2025-03-18 12:41:33,244 - livekit.agents - INFO - initializing job runner
2025-03-18 12:41:33,245 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 12:41:33,590 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 12:41:33,591 - livekit.agents - INFO - job runner initialized
2025-03-18 12:41:33,592 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:41:33,595 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-VNBEtdDBNLZdFFMpFcG39n
2025-03-18 12:41:33,595 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 12:41:33,597 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 12:41:33,601 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 12:41:33,603 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 12:41:33,607 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 12:41:33,690 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 12:41:33,691 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 12:41:33,692 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 12:41:33,693 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 12:41:33,781 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 12:41:33,782 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 12:41:33,783 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 12:41:33,784 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 12:41:33,944 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 12:41:34,327 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 12:41:34,329 - portuguese-restaurant-assistant - INFO - Participant joined: autonomous-interface
2025-03-18 12:41:34,330 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 12:41:34,331 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 12:41:35,107 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 12:41:35,120 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 12:41:35,919 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 12:41:36,020 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=385d17fe2c9e, ttfb=0.4650324000394903, audio_duration=3.76
2025-03-18 12:41:39,678 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:41:39,679 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Bem-vindo ao Restaurante Português. Em que posso ser útil hoje?
2025-03-18 12:41:39,680 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 12:41:40,157 - livekit.agents - INFO - Pipeline STT metrics: duration=5.03, audio_duration=5.05
2025-03-18 12:41:44,544 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 12:41:44,916 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 12:41:44,917 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=69e994f67fe7, end_of_utterance_delay=0.72, transcription_delay=0.34
2025-03-18 12:41:45,157 - livekit.agents - INFO - Pipeline STT metrics: duration=10.03, audio_duration=5.00
2025-03-18 12:41:46,668 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=69e994f67fe7, ttft=1.19, input_tokens=539, output_tokens=29, tokens_per_second=16.58
2025-03-18 12:41:47,857 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 12:41:47,984 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=69e994f67fe7, ttfb=1.7312861999962479, audio_duration=8.83
2025-03-18 12:41:49,417 - portuguese-restaurant-assistant - INFO - User speech committed: quero que fales em português de portugal, por favor.
2025-03-18 12:41:50,157 - livekit.agents - INFO - Pipeline STT metrics: duration=15.03, audio_duration=5.00
2025-03-18 12:41:55,156 - livekit.agents - INFO - Pipeline STT metrics: duration=20.03, audio_duration=5.00
2025-03-18 12:41:56,686 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:41:56,687 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ora bem, é exatamente isso que estou a fazer! Estou aqui para ajudar o senhor da melhor maneira possível. Como posso ser útil hoje?
2025-03-18 12:41:56,688 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 12:41:59,252 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 12:41:59,607 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 12:41:59,608 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=7d4795de6183, end_of_utterance_delay=0.75, transcription_delay=0.39
2025-03-18 12:42:00,155 - livekit.agents - INFO - Pipeline STT metrics: duration=25.03, audio_duration=5.00
2025-03-18 12:42:00,986 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=7d4795de6183, ttft=0.48, input_tokens=584, output_tokens=61, tokens_per_second=44.37
2025-03-18 12:42:01,830 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 12:42:03,376 - portuguese-restaurant-assistant - INFO - User speech committed: o que é que fez no teu manual?
2025-03-18 12:42:05,158 - livekit.agents - INFO - Pipeline STT metrics: duration=30.03, audio_duration=5.00
2025-03-18 12:42:10,156 - livekit.agents - INFO - Pipeline STT metrics: duration=35.03, audio_duration=5.00
2025-03-18 12:42:12,587 - livekit.agents - INFO - shutting down worker
2025-03-18 12:42:12,591 - livekit.agents - DEBUG - shutting down job task
2025-03-18 12:42:12,594 - livekit.agents - DEBUG - job exiting
2025-03-18 12:42:12,655 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 12:42:12,660 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 12:42:12,661 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=1123, llm_completion_tokens=90, tts_characters_count=205, stt_audio_duration=35.049999999999926)
2025-03-18 12:42:12,664 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 12:45:16,786 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:45:16,793 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 12:45:19,197 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:45:19,207 - livekit.agents - INFO - starting worker
2025-03-18 12:45:19,532 - livekit.agents - INFO - registered worker
2025-03-18 12:45:35,686 - livekit.agents - INFO - received job request
2025-03-18 12:45:35,751 - livekit.agents - INFO - initializing job runner
2025-03-18 12:45:35,752 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 12:45:36,022 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 12:45:36,025 - livekit.agents - INFO - job runner initialized
2025-03-18 12:45:36,025 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:45:36,028 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-F7DeMDsg3LupA8FLPF6yof
2025-03-18 12:45:36,029 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 12:45:36,030 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 12:45:36,033 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 12:45:36,034 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 12:45:36,037 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 12:45:36,109 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 12:45:36,111 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 12:45:36,112 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 12:45:36,113 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 12:45:36,322 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 12:45:36,323 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 12:45:36,325 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 12:45:36,326 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 12:45:36,487 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 12:45:37,860 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 12:45:37,860 - portuguese-restaurant-assistant - INFO - Participant joined: synthetic-registry
2025-03-18 12:45:37,862 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 12:45:37,863 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 12:45:38,513 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 12:45:38,582 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 12:45:38,881 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=081a94e6168c, body=None)
2025-03-18 12:45:38,893 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=081a94e6168c, body=None)
2025-03-18 12:45:38,906 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=081a94e6168c, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 12:45:39,259 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:45:43,656 - livekit.agents - INFO - Pipeline STT metrics: duration=5.00, audio_duration=5.00
2025-03-18 12:45:48,656 - livekit.agents - INFO - Pipeline STT metrics: duration=10.00, audio_duration=5.00
2025-03-18 12:45:53,658 - livekit.agents - INFO - Pipeline STT metrics: duration=15.00, audio_duration=5.00
2025-03-18 12:45:56,631 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 12:45:57,127 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 12:45:57,128 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=8cf635858502, end_of_utterance_delay=1.06, transcription_delay=0.57
2025-03-18 12:45:58,234 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=9800d68e5403, body=None)
2025-03-18 12:45:58,238 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=9800d68e5403, body=None)
2025-03-18 12:45:58,244 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=9800d68e5403, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 12:45:58,414 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=8cf635858502, ttft=0.87, input_tokens=507, output_tokens=32, tokens_per_second=24.94
2025-03-18 12:45:58,656 - livekit.agents - INFO - Pipeline STT metrics: duration=20.00, audio_duration=5.00
2025-03-18 12:45:58,690 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=a2c3abff32f7, body=None)
2025-03-18 12:45:58,695 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=a2c3abff32f7, body=None)
2025-03-18 12:45:58,701 - livekit.agents - WARNING - failed to synthesize speech, retrying in 5.0s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: voice_id_does_not_exist (status_code=500, request_id=a2c3abff32f7, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-18 12:46:03,658 - livekit.agents - INFO - Pipeline STT metrics: duration=25.00, audio_duration=5.00
2025-03-18 12:46:03,719 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:46:03,720 - portuguese-restaurant-assistant - INFO - User speech committed: olá,
2025-03-18 12:46:29,291 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 12:46:29,293 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 12:46:29,298 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-18 12:46:29,300 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-18 12:46:29,303 - livekit.agents - DEBUG - shutting down job task
2025-03-18 12:46:29,308 - livekit.agents - DEBUG - job exiting
2025-03-18 12:46:29,308 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=507, llm_completion_tokens=32, tts_characters_count=0, stt_audio_duration=24.99999999999995)
2025-03-18 12:46:29,309 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-18 12:46:29,312 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 12:49:28,421 - livekit.agents - INFO - shutting down worker
2025-03-18 12:49:34,763 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:49:34,769 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 12:49:37,969 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:49:37,980 - livekit.agents - INFO - starting worker
2025-03-18 12:49:38,310 - livekit.agents - INFO - registered worker
2025-03-18 12:49:42,701 - livekit.agents - INFO - received job request
2025-03-18 12:49:42,763 - livekit.agents - INFO - initializing job runner
2025-03-18 12:49:42,764 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 12:49:42,998 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 12:49:42,999 - livekit.agents - INFO - job runner initialized
2025-03-18 12:49:42,999 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 12:49:43,002 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-CRSGENRxuHpx6q2tfWDz5a
2025-03-18 12:49:43,003 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 12:49:43,004 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 12:49:43,007 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 12:49:43,008 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 12:49:43,010 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 12:49:43,124 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 12:49:43,125 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 12:49:43,127 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 12:49:43,128 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 12:49:43,208 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 12:49:43,209 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 12:49:43,209 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 12:49:43,211 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 12:49:43,375 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 12:49:43,724 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 12:49:43,725 - portuguese-restaurant-assistant - INFO - Participant joined: seamless-network
2025-03-18 12:49:43,726 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 12:49:43,726 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 12:49:44,388 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 12:49:44,457 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 12:49:45,223 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 12:49:45,299 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=3541f814a741, ttfb=0.5450915999826975, audio_duration=4.31
2025-03-18 12:49:49,515 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:49:49,516 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Bem-vindo ao Restaurante Português. Em que posso ser útil hoje?
2025-03-18 12:49:49,517 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 12:49:49,530 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-18 12:49:52,727 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 12:49:53,030 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 12:49:53,032 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=b99b042c5baa, end_of_utterance_delay=0.91, transcription_delay=0.61
2025-03-18 12:49:54,421 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=b99b042c5baa, ttft=0.63, input_tokens=534, output_tokens=45, tokens_per_second=32.47
2025-03-18 12:49:54,529 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-18 12:49:55,310 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 12:49:55,436 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=b99b042c5baa, ttfb=1.5890911999740638, audio_duration=11.52
2025-03-18 12:49:56,972 - portuguese-restaurant-assistant - INFO - User speech committed: quero fazer 1 encomenda.
2025-03-18 12:49:59,530 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-18 12:50:04,532 - livekit.agents - INFO - Pipeline STT metrics: duration=19.99, audio_duration=5.00
2025-03-18 12:50:06,831 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 12:50:06,832 - portuguese-restaurant-assistant - INFO - Agent speech committed: Pronto, não fazemos encomendas directamente por aqui, mas posso ajudar a selecionar pratos do nosso menu ou informar sobre as especialidades da casa. Está à procura de alguma sugestão ou detalhes sobre algum prato em particular?
2025-03-18 12:50:06,834 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 12:50:09,188 - livekit.agents - INFO - shutting down worker
2025-03-18 12:50:09,190 - livekit.agents - DEBUG - shutting down job task
2025-03-18 12:50:09,191 - livekit.agents - DEBUG - job exiting
2025-03-18 12:50:09,256 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 12:50:09,261 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=534, llm_completion_tokens=45, tts_characters_count=302, stt_audio_duration=19.99999999999996)
2025-03-18 12:50:09,262 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 12:50:09,320 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:360> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 12:50:09,325 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 12:50:09,326 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-40' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 12:50:09,327 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 12:50:09,336 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 12:50:09,338 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 12:50:09,339 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 12:50:09,341 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-45' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 12:50:09,342 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 12:50:09,343 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 12:50:09,381 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 12:50:09,382 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 12:50:09,384 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 12:50:09,385 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 12:50:09,386 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 12:50:09,396 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:11:15,847 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 13:11:15,868 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 13:11:21,085 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 13:11:21,127 - livekit.agents - INFO - starting worker
2025-03-18 13:11:21,649 - livekit.agents - INFO - registered worker
2025-03-18 13:11:26,604 - livekit.agents - INFO - received job request
2025-03-18 13:11:26,669 - livekit.agents - INFO - initializing job runner
2025-03-18 13:11:26,672 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 13:11:27,016 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 13:11:27,017 - livekit.agents - INFO - job runner initialized
2025-03-18 13:11:27,017 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 13:11:27,020 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-DJneR3ZvdhjZ8LugeDwUne
2025-03-18 13:11:27,020 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 13:11:27,021 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 13:11:27,037 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 13:11:27,038 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 13:11:27,085 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 13:11:27,167 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 13:11:27,169 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 13:11:27,171 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 13:11:27,171 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 13:11:27,281 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 13:11:27,282 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 13:11:27,283 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 13:11:27,285 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 13:11:27,450 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 13:11:28,896 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 13:11:28,898 - portuguese-restaurant-assistant - INFO - Participant joined: micro-widget
2025-03-18 13:11:28,899 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 13:11:28,900 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'William'
2025-03-18 13:11:29,552 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 13:11:29,623 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 13:11:30,308 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 13:11:30,916 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=1179a0091514, ttfb=0.4398312999983318, audio_duration=6.40
2025-03-18 13:11:34,703 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-18 13:11:36,712 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 13:11:36,715 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Bem-vindo ao Restaurante Português. O que gostaria de encomendar hoje?
2025-03-18 13:11:36,717 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 13:11:39,703 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-18 13:11:41,043 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 13:11:41,423 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 13:11:41,426 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=3ab745264c49, end_of_utterance_delay=0.87, transcription_delay=0.49
2025-03-18 13:11:44,703 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-18 13:11:45,298 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=3ab745264c49, ttft=3.30, input_tokens=435, output_tokens=26, tokens_per_second=6.72
2025-03-18 13:11:45,882 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 13:11:45,965 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=3ab745264c49, ttfb=0.8287425999878906, audio_duration=5.22
2025-03-18 13:11:47,417 - portuguese-restaurant-assistant - INFO - User speech committed: quero 1 frango e 1 batata, por favor.
2025-03-18 13:11:49,701 - livekit.agents - INFO - Pipeline STT metrics: duration=19.99, audio_duration=5.00
2025-03-18 13:11:51,116 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 13:11:51,117 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ora bem, tomou uma boa escolha com o frango e a batata! A que hora deseja levantar o seu pedido?
2025-03-18 13:11:51,117 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 13:11:54,702 - livekit.agents - INFO - Pipeline STT metrics: duration=24.99, audio_duration=5.00
2025-03-18 13:11:55,286 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 13:11:55,642 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 13:11:55,643 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=de09c9d5e527, end_of_utterance_delay=0.88, transcription_delay=0.52
2025-03-18 13:11:56,867 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=de09c9d5e527, ttft=0.64, input_tokens=473, output_tokens=21, tokens_per_second=17.20
2025-03-18 13:11:57,543 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 13:11:57,598 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=de09c9d5e527, ttfb=1.1976276999921538, audio_duration=4.60
2025-03-18 13:11:59,231 - portuguese-restaurant-assistant - INFO - User speech committed: que horas tem disponível?
2025-03-18 13:11:59,703 - livekit.agents - INFO - Pipeline STT metrics: duration=29.99, audio_duration=5.00
2025-03-18 13:12:02,150 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 13:12:02,154 - portuguese-restaurant-assistant - INFO - Agent speech committed: Temos disponibilidade a partir das 12h. Qual seria a hora mais conveniente para o senhor?
2025-03-18 13:12:02,156 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 13:12:04,702 - livekit.agents - INFO - Pipeline STT metrics: duration=34.99, audio_duration=5.00
2025-03-18 13:12:04,987 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 13:12:05,363 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 13:12:05,363 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=5cc77339f0d7, end_of_utterance_delay=0.84, transcription_delay=0.47
2025-03-18 13:12:08,531 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=5cc77339f0d7, ttft=2.31, input_tokens=508, output_tokens=31, tokens_per_second=9.79
2025-03-18 13:12:09,152 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 13:12:09,201 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=5cc77339f0d7, ttfb=1.3221057000337169, audio_duration=5.56
2025-03-18 13:12:09,702 - livekit.agents - INFO - Pipeline STT metrics: duration=39.99, audio_duration=5.00
2025-03-18 13:12:10,810 - portuguese-restaurant-assistant - INFO - User speech committed: prometer e meia por favor.
2025-03-18 13:12:14,700 - livekit.agents - INFO - Pipeline STT metrics: duration=44.99, audio_duration=5.00
2025-03-18 13:12:14,726 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 13:12:14,727 - portuguese-restaurant-assistant - INFO - Agent speech committed: Perfeito, então fica marcado para as 12h30. E como se chama a senhora, por favor, para associar à encomenda?
2025-03-18 13:12:14,728 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 13:12:17,189 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 13:12:17,691 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 13:12:17,692 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=b40be52e93d4, end_of_utterance_delay=1.01, transcription_delay=0.51
2025-03-18 13:12:19,028 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=b40be52e93d4, ttft=0.67, input_tokens=549, output_tokens=42, tokens_per_second=31.48
2025-03-18 13:12:19,702 - livekit.agents - INFO - Pipeline STT metrics: duration=49.99, audio_duration=5.00
2025-03-18 13:12:19,831 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 13:12:19,899 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=b40be52e93d4, ttfb=1.3842381000285968, audio_duration=7.94
2025-03-18 13:12:21,451 - portuguese-restaurant-assistant - INFO - User speech committed: nuno,
2025-03-18 13:12:24,702 - livekit.agents - INFO - Pipeline STT metrics: duration=54.99, audio_duration=5.00
2025-03-18 13:12:27,762 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 13:12:27,763 - portuguese-restaurant-assistant - INFO - Agent speech committed: Muito bem, o senhor Nuno. Então, só para confirmar: 1 frango e 1 batata para levantar às 12h30. Correcto? Muito obrigado, e até logo!
2025-03-18 13:12:27,765 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 13:12:29,702 - livekit.agents - INFO - Pipeline STT metrics: duration=59.99, audio_duration=5.00
2025-03-18 13:12:31,714 - livekit.agents - INFO - shutting down worker
2025-03-18 13:12:31,718 - livekit.agents - DEBUG - shutting down job task
2025-03-18 13:12:31,722 - livekit.agents - DEBUG - job exiting
2025-03-18 13:12:31,784 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 13:12:31,789 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=1965, llm_completion_tokens=120, tts_characters_count=507, stt_audio_duration=59.99999999999989)
2025-03-18 13:12:31,790 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 13:12:31,847 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:353> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 13:12:31,850 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 13:12:31,851 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-40' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 13:12:31,852 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 13:12:31,862 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:12:31,864 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:12:31,865 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 13:12:31,866 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-45' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 13:12:31,867 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 13:12:31,868 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 13:12:31,875 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 13:12:31,879 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 13:12:31,881 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 13:12:31,883 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:12:31,885 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:12:31,896 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 13:12:31,897 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-163' coro=<_DeferredReplyValidation._run.<locals>._run_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 14:17:35,051 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:17:35,056 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 14:17:38,201 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:17:38,227 - livekit.agents - INFO - starting worker
2025-03-18 14:17:38,699 - livekit.agents - INFO - registered worker
2025-03-18 14:17:48,767 - livekit.agents - INFO - received job request
2025-03-18 14:17:48,842 - livekit.agents - INFO - initializing job runner
2025-03-18 14:17:48,847 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 14:17:49,208 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 14:17:49,209 - livekit.agents - INFO - job runner initialized
2025-03-18 14:17:49,209 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:17:49,212 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-eXkfZot2gE9QjCmPQxqjmY
2025-03-18 14:17:49,213 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 14:17:49,214 - portuguese-restaurant-assistant - INFO - Initialized adaptive pacing with starting speed: 1.0
2025-03-18 14:17:49,214 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 14:17:49,238 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 14:17:49,238 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 14:17:49,297 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 14:17:49,434 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 14:17:49,438 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 14:17:49,443 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 14:17:49,446 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 14:17:49,553 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 14:17:49,557 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 14:17:49,563 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 14:17:49,565 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 14:17:49,730 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 14:17:51,207 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 14:17:51,210 - portuguese-restaurant-assistant - INFO - Participant joined: polyglot-virtualenv
2025-03-18 14:17:51,213 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 14:17:51,217 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana' and adaptive pacing
2025-03-18 14:17:51,940 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 14:17:51,942 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: 'TTS' object has no attribute 'voice'
2025-03-18 14:17:51,947 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 497, in entrypoint
    await adaptive_say(
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 342, in adaptive_say
    tts.voice.settings = new_settings
    ^^^^^^^^^
AttributeError: 'TTS' object has no attribute 'voice'. Did you mean: 'once'?

2025-03-18 14:17:52,098 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 14:17:57,093 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-18 14:18:02,090 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-18 14:18:07,090 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-18 14:18:12,093 - livekit.agents - INFO - Pipeline STT metrics: duration=19.99, audio_duration=5.00
2025-03-18 14:18:17,094 - livekit.agents - INFO - Pipeline STT metrics: duration=24.99, audio_duration=5.00
2025-03-18 14:18:22,091 - livekit.agents - INFO - Pipeline STT metrics: duration=29.99, audio_duration=5.00
2025-03-18 14:18:27,091 - livekit.agents - INFO - Pipeline STT metrics: duration=34.99, audio_duration=5.00
2025-03-18 14:18:49,269 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 14:18:49,275 - livekit.agents - DEBUG - shutting down job task
2025-03-18 14:18:49,276 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-18 14:18:49,282 - livekit.agents - DEBUG - job exiting
2025-03-18 14:18:49,306 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=0, stt_audio_duration=34.99999999999993)
2025-03-18 14:18:49,311 - portuguese-restaurant-assistant - INFO - Final voice speed: 1.00
2025-03-18 14:18:49,313 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 14:20:15,640 - watchfiles.main - WARNING - process already dead, exit code: 1
2025-03-18 14:20:18,989 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:20:19,036 - livekit.agents - INFO - starting worker
2025-03-18 14:20:19,049 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-18 14:20:19,390 - livekit.agents - INFO - registered worker
2025-03-18 14:20:24,059 - livekit.agents - INFO - shutting down worker
2025-03-18 14:30:40,555 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:30:40,561 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 14:30:44,662 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:30:44,671 - livekit.agents - INFO - starting worker
2025-03-18 14:30:45,059 - livekit.agents - INFO - registered worker
2025-03-18 14:30:53,705 - livekit.agents - INFO - received job request
2025-03-18 14:30:53,780 - livekit.agents - INFO - initializing job runner
2025-03-18 14:30:53,783 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 14:30:54,218 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 14:30:54,221 - livekit.agents - INFO - job runner initialized
2025-03-18 14:30:54,223 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:30:54,229 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-CpEJ83XdqydLWw2HJeka35
2025-03-18 14:30:54,231 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 14:30:54,232 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 14:30:54,255 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 14:30:54,258 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 14:30:54,308 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 14:30:54,410 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 14:30:54,412 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 14:30:54,412 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 14:30:54,413 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 14:30:54,504 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 14:30:54,506 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 14:30:54,507 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 14:30:54,509 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 14:30:54,667 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 14:30:55,077 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 14:30:55,078 - portuguese-restaurant-assistant - INFO - Participant joined: resilient-blockchain
2025-03-18 14:30:55,080 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 14:30:55,081 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana'
2025-03-18 14:30:56,245 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 14:30:56,247 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: name 'interaction_tracker' is not defined
2025-03-18 14:30:56,266 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 552, in entrypoint
    await adaptive_say(
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 304, in adaptive_say
    verbosity_level = interaction_tracker.analyze_patterns_and_adjust_verbosity()
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'interaction_tracker' is not defined. Did you mean: 'UserInteractionTracker'?

2025-03-18 14:30:56,430 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 14:31:01,467 - livekit.agents - INFO - Pipeline STT metrics: duration=5.04, audio_duration=5.05
2025-03-18 14:31:01,638 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:31:02,080 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:31:06,468 - livekit.agents - INFO - Pipeline STT metrics: duration=10.04, audio_duration=5.00
2025-03-18 14:31:06,753 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:31:08,308 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:31:08,558 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 14:31:08,562 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=d1876f3cf409, end_of_utterance_delay=1.03, transcription_delay=0.78
2025-03-18 14:31:10,692 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:31:10,825 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=d1876f3cf409, ttft=1.25, input_tokens=447, output_tokens=57, tokens_per_second=25.24
2025-03-18 14:31:11,467 - livekit.agents - INFO - Pipeline STT metrics: duration=15.04, audio_duration=5.00
2025-03-18 14:31:12,279 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=d1876f3cf409, ttfb=0.6133341999957338, audio_duration=13.01
2025-03-18 14:31:12,325 - portuguese-restaurant-assistant - INFO - User speech committed: de lugar estar ocupado por 1 corrupto, por 1 ladrão, ser hiperativo, portanto, tu o set bem intencionado mais valo vírus que já a politica. mas aí que me leva a pensar que é, vocês dos
2025-03-18 14:31:16,467 - livekit.agents - INFO - Pipeline STT metrics: duration=20.04, audio_duration=5.00
2025-03-18 14:31:21,467 - livekit.agents - INFO - Pipeline STT metrics: duration=25.04, audio_duration=5.00
2025-03-18 14:31:22,121 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 14:31:22,127 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:31:22,132 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:31:26,466 - livekit.agents - INFO - Pipeline STT metrics: duration=30.03, audio_duration=5.00
2025-03-18 14:31:28,427 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:31:28,525 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 14:31:28,529 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=4763f4ddc468, end_of_utterance_delay=0.91, transcription_delay=0.81
2025-03-18 14:31:29,927 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=4763f4ddc468, ttft=0.67, input_tokens=508, output_tokens=31, tokens_per_second=22.26
2025-03-18 14:31:30,767 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:31:31,156 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=4763f4ddc468, ttfb=1.4784170999773778, audio_duration=6.50
2025-03-18 14:31:31,466 - livekit.agents - INFO - Pipeline STT metrics: duration=35.03, audio_duration=5.00
2025-03-18 14:31:32,323 - portuguese-restaurant-assistant - INFO - User speech committed: era 1 frango.
2025-03-18 14:31:36,468 - livekit.agents - INFO - Pipeline STT metrics: duration=40.04, audio_duration=5.00
2025-03-18 14:31:37,273 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:31:37,277 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ora bem, um frango. Temos Frango Assado com um tempero tradicional delicioso. Posso acrescentar mais alguma coisa ao seu pedido?
2025-03-18 14:31:37,281 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:31:39,598 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:31:39,923 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 14:31:39,924 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=35cc0e927105, end_of_utterance_delay=0.90, transcription_delay=0.58
2025-03-18 14:31:41,211 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=35cc0e927105, ttft=0.79, input_tokens=551, output_tokens=15, tokens_per_second=11.67
2025-03-18 14:31:41,465 - livekit.agents - INFO - Pipeline STT metrics: duration=45.03, audio_duration=5.00
2025-03-18 14:31:41,714 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:31:41,771 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=35cc0e927105, ttfb=0.8131644999957643, audio_duration=2.74
2025-03-18 14:31:43,325 - portuguese-restaurant-assistant - INFO - User speech committed: não é tudo obrigado.
2025-03-18 14:31:44,463 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:31:44,467 - portuguese-restaurant-assistant - INFO - Agent speech committed: Perfeito! A que horas gostaria de vir levantar o seu pedido?
2025-03-18 14:31:44,471 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:31:46,384 - livekit.agents - INFO - shutting down worker
2025-03-18 14:31:46,388 - livekit.agents - DEBUG - shutting down job task
2025-03-18 14:31:46,395 - livekit.agents - DEBUG - job exiting
2025-03-18 14:31:46,459 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 14:31:46,464 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-18 14:31:46,466 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-18 14:31:46,469 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=1506, llm_completion_tokens=103, tts_characters_count=451, stt_audio_duration=45.04999999999991)
2025-03-18 14:31:46,470 - portuguese-restaurant-assistant - ERROR - Failed to get usage summary: name 'interaction_tracker' is not defined
2025-03-18 14:31:46,471 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 14:31:46,553 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 14:31:46,555 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-31' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 14:31:46,556 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 14:31:46,569 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 14:31:46,572 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-38' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 14:31:46,573 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-36' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 14:31:46,574 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 14:31:46,576 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 14:31:46,577 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-33' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 14:31:46,579 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 14:31:46,589 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-35' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 14:31:46,592 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 14:31:46,593 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 14:31:46,595 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-41' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 14:31:46,603 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-43' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 14:33:18,881 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:33:18,886 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 14:33:22,358 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:33:22,370 - livekit.agents - INFO - starting worker
2025-03-18 14:33:22,812 - livekit.agents - INFO - registered worker
2025-03-18 14:33:39,526 - livekit.agents - INFO - received job request
2025-03-18 14:33:39,603 - livekit.agents - INFO - initializing job runner
2025-03-18 14:33:39,609 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 14:33:40,220 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 14:33:40,224 - livekit.agents - INFO - job runner initialized
2025-03-18 14:33:40,226 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:33:40,229 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-Vntz8jPEMAtsoM5DXaDqvb
2025-03-18 14:33:40,229 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 14:33:40,230 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: normal
2025-03-18 14:33:40,231 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-18 14:33:40,231 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 14:33:40,249 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 14:33:40,250 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 14:33:40,294 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 14:33:40,383 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 14:33:40,384 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 14:33:40,385 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 14:33:40,385 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 14:33:40,476 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 14:33:40,476 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 14:33:40,477 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 14:33:40,478 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 14:33:40,641 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 14:33:42,219 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 14:33:42,220 - portuguese-restaurant-assistant - INFO - Participant joined: transparent-swap
2025-03-18 14:33:42,226 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 14:33:42,227 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana'
2025-03-18 14:33:43,538 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 14:33:43,539 - portuguese-restaurant-assistant - INFO - Using normal response style. Length: 81
2025-03-18 14:33:43,541 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: name 'assistant' is not defined
2025-03-18 14:33:43,556 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 557, in entrypoint
    await adaptive_say(
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 318, in adaptive_say
    await assistant.say(adapted_text, allow_interruptions=allow_interruptions)
          ^^^^^^^^^
NameError: name 'assistant' is not defined

2025-03-18 14:33:43,568 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 14:33:48,565 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-18 14:33:53,568 - livekit.agents - INFO - Pipeline STT metrics: duration=10.00, audio_duration=5.00
2025-03-18 14:33:58,566 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-18 14:34:02,954 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:34:03,265 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 14:34:03,267 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=667fc6af8e59, end_of_utterance_delay=1.04, transcription_delay=0.73
2025-03-18 14:34:03,567 - livekit.agents - INFO - Pipeline STT metrics: duration=20.00, audio_duration=5.00
2025-03-18 14:34:04,549 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=667fc6af8e59, ttft=0.85, input_tokens=400, output_tokens=25, tokens_per_second=19.57
2025-03-18 14:34:06,387 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:34:07,246 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=667fc6af8e59, ttfb=1.839933299983386, audio_duration=5.36
2025-03-18 14:34:07,954 - portuguese-restaurant-assistant - INFO - User speech committed: olá,
2025-03-18 14:34:08,566 - livekit.agents - INFO - Pipeline STT metrics: duration=24.99, audio_duration=5.00
2025-03-18 14:34:11,736 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:34:11,737 - portuguese-restaurant-assistant - INFO - Agent speech committed: Olá, boa tarde! O que deseja encomendar do nosso menu hoje? Estou aqui para ajudar com o seu pedido.
2025-03-18 14:34:11,738 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:34:13,567 - livekit.agents - INFO - Pipeline STT metrics: duration=30.00, audio_duration=5.00
2025-03-18 14:34:18,696 - livekit.agents - INFO - shutting down worker
2025-03-18 14:34:18,698 - livekit.agents - DEBUG - shutting down job task
2025-03-18 14:34:18,700 - livekit.agents - DEBUG - job exiting
2025-03-18 14:34:18,709 - livekit.agents - WARNING - exiting forcefully
2025-03-18 14:37:37,835 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:37:37,841 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-18 14:37:40,551 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:37:40,561 - livekit.agents - INFO - starting worker
2025-03-18 14:37:40,921 - livekit.agents - INFO - registered worker
2025-03-18 14:38:19,059 - livekit.agents - INFO - received job request
2025-03-18 14:38:19,128 - livekit.agents - INFO - initializing job runner
2025-03-18 14:38:19,130 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-18 14:38:19,660 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-18 14:38:19,662 - livekit.agents - INFO - job runner initialized
2025-03-18 14:38:19,664 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-18 14:38:19,669 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-6qGDCMNE2Yn7SfLpHLreHg
2025-03-18 14:38:19,670 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-18 14:38:19,672 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: normal
2025-03-18 14:38:19,675 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-18 14:38:19,676 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-18 14:38:19,698 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-18 14:38:19,701 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-18 14:38:19,755 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-18 14:38:19,966 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-18 14:38:19,968 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-18 14:38:19,969 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-18 14:38:19,971 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-18 14:38:20,307 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-18 14:38:20,311 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-18 14:38:20,316 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-18 14:38:20,319 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-18 14:38:20,479 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-18 14:38:20,957 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-18 14:38:20,959 - portuguese-restaurant-assistant - INFO - Participant joined: ubiquitous-circuit
2025-03-18 14:38:20,961 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-18 14:38:20,961 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana'
2025-03-18 14:38:21,989 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-18 14:38:21,991 - portuguese-restaurant-assistant - INFO - Using normal response style. Length: 81
2025-03-18 14:38:22,090 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-18 14:38:22,916 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:38:23,182 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=ceba044737ed, ttfb=0.5279681999818422, audio_duration=5.02
2025-03-18 14:38:25,249 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 14:38:25,252 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:38:25,254 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:38:27,219 - livekit.agents - INFO - Pipeline STT metrics: duration=5.03, audio_duration=5.05
2025-03-18 14:38:32,221 - livekit.agents - INFO - Pipeline STT metrics: duration=10.03, audio_duration=5.00
2025-03-18 14:38:36,048 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 14:38:36,049 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=ce1635b8a050, end_of_utterance_delay=5.56, transcription_delay=0.00
2025-03-18 14:38:37,224 - livekit.agents - INFO - Pipeline STT metrics: duration=15.04, audio_duration=5.00
2025-03-18 14:38:37,391 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=ce1635b8a050, ttft=1.02, input_tokens=415, output_tokens=19, tokens_per_second=14.17
2025-03-18 14:38:38,518 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:38:38,705 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=ce1635b8a050, ttfb=1.4313960000290535, audio_duration=4.94
2025-03-18 14:38:42,219 - livekit.agents - INFO - Pipeline STT metrics: duration=20.03, audio_duration=5.00
2025-03-18 14:38:43,454 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:38:43,491 - portuguese-restaurant-assistant - INFO - Agent speech committed: O que deseja encomendar do nosso menu hoje? Temos várias opções deliciosas à escolha!
2025-03-18 14:38:43,495 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:38:47,220 - livekit.agents - INFO - Pipeline STT metrics: duration=25.03, audio_duration=5.00
2025-03-18 14:38:48,673 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:38:49,049 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 14:38:49,052 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=79ea731ba792, end_of_utterance_delay=0.83, transcription_delay=0.45
2025-03-18 14:38:50,519 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=79ea731ba792, ttft=1.17, input_tokens=449, output_tokens=27, tokens_per_second=18.47
2025-03-18 14:38:51,150 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:38:51,521 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=79ea731ba792, ttfb=0.8868388999835588, audio_duration=4.96
2025-03-18 14:38:52,221 - livekit.agents - INFO - Pipeline STT metrics: duration=30.03, audio_duration=5.00
2025-03-18 14:38:52,699 - portuguese-restaurant-assistant - INFO - User speech committed: pode ser 1 frango e 1 batata, por favor.
2025-03-18 14:38:56,120 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:38:56,124 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ora bem, um frango e uma batata, pois muito bem! E para que hora gostaria de levantar o seu pedido?
2025-03-18 14:38:56,129 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:38:57,221 - livekit.agents - INFO - Pipeline STT metrics: duration=35.03, audio_duration=5.00
2025-03-18 14:38:58,666 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:38:58,940 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 14:38:58,942 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c47606a4b2e5, end_of_utterance_delay=0.93, transcription_delay=0.66
2025-03-18 14:39:00,030 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c47606a4b2e5, ttft=0.48, input_tokens=488, output_tokens=27, tokens_per_second=24.98
2025-03-18 14:39:00,813 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:39:01,238 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c47606a4b2e5, ttfb=1.3615653999731876, audio_duration=5.28
2025-03-18 14:39:02,221 - livekit.agents - INFO - Pipeline STT metrics: duration=40.03, audio_duration=5.00
2025-03-18 14:39:02,388 - portuguese-restaurant-assistant - INFO - User speech committed: pode ser bom dia.
2025-03-18 14:39:06,094 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:39:06,097 - portuguese-restaurant-assistant - INFO - Agent speech committed: Com certeza, então fica combinado para amanhã de manhã. E, por favor, a que nome posso associar a encomenda?
2025-03-18 14:39:06,101 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:39:07,220 - livekit.agents - INFO - Pipeline STT metrics: duration=45.03, audio_duration=5.00
2025-03-18 14:39:09,367 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:39:09,731 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 14:39:09,733 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=0660b28a2e65, end_of_utterance_delay=0.84, transcription_delay=0.48
2025-03-18 14:39:11,148 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=0660b28a2e65, ttft=0.61, input_tokens=533, output_tokens=49, tokens_per_second=34.68
2025-03-18 14:39:12,220 - livekit.agents - INFO - Pipeline STT metrics: duration=50.03, audio_duration=5.00
2025-03-18 14:39:12,399 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:39:13,000 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=0660b28a2e65, ttfb=2.0235667999950238, audio_duration=10.74
2025-03-18 14:39:14,079 - portuguese-restaurant-assistant - INFO - User speech committed: fique em nome de nuno siqueira.
2025-03-18 14:39:17,219 - livekit.agents - INFO - Pipeline STT metrics: duration=55.03, audio_duration=5.00
2025-03-18 14:39:19,132 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-18 14:39:19,136 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:39:19,148 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:39:21,924 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:39:22,189 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:39:22,220 - livekit.agents - INFO - Pipeline STT metrics: duration=60.03, audio_duration=5.00
2025-03-18 14:39:22,560 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 14:39:22,562 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=f96e580488a7, end_of_utterance_delay=0.87, transcription_delay=0.50
2025-03-18 14:39:23,732 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=f96e580488a7, ttft=0.65, input_tokens=577, output_tokens=34, tokens_per_second=29.23
2025-03-18 14:39:24,500 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:39:24,928 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=f96e580488a7, ttfb=1.2680032000062056, audio_duration=6.32
2025-03-18 14:39:26,048 - portuguese-restaurant-assistant - INFO - User speech committed: não é é sequeira.
2025-03-18 14:39:27,219 - livekit.agents - INFO - Pipeline STT metrics: duration=65.03, audio_duration=5.00
2025-03-18 14:39:30,839 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:39:30,842 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ora bem, peço desculpa pelo engano, senhor Nuno. Fica então em nome de Nuno. Alguma dúvida ou está tudo certo assim?
2025-03-18 14:39:30,845 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:39:32,221 - livekit.agents - INFO - Pipeline STT metrics: duration=70.03, audio_duration=5.00
2025-03-18 14:39:33,364 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-18 14:39:33,549 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-18 14:39:33,552 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=36a85598b8c5, end_of_utterance_delay=0.91, transcription_delay=0.72
2025-03-18 14:39:34,576 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=36a85598b8c5, ttft=0.47, input_tokens=623, output_tokens=33, tokens_per_second=32.43
2025-03-18 14:39:35,390 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-18 14:39:35,851 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=36a85598b8c5, ttfb=1.239482200006023, audio_duration=6.64
2025-03-18 14:39:37,000 - portuguese-restaurant-assistant - INFO - User speech committed: está tudo certo obrigado.
2025-03-18 14:39:37,221 - livekit.agents - INFO - Pipeline STT metrics: duration=75.03, audio_duration=5.00
2025-03-18 14:39:42,024 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-18 14:39:42,027 - portuguese-restaurant-assistant - INFO - Agent speech committed: Perfeito, senhor Nuno! Agradeço a sua encomenda. Estará tudo prontinho para si amanhã de manhã. Tenha um ótimo dia!
2025-03-18 14:39:42,030 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-18 14:39:42,219 - livekit.agents - INFO - Pipeline STT metrics: duration=80.03, audio_duration=5.00
2025-03-18 14:39:47,219 - livekit.agents - INFO - Pipeline STT metrics: duration=85.03, audio_duration=5.00
2025-03-18 14:39:47,636 - livekit.agents - INFO - shutting down worker
2025-03-18 14:39:47,639 - livekit.agents - DEBUG - shutting down job task
2025-03-18 14:39:47,640 - livekit.agents - DEBUG - job exiting
2025-03-18 14:39:47,705 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-18 14:39:47,712 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=3085, llm_completion_tokens=189, tts_characters_count=792, stt_audio_duration=85.04999999999983)
2025-03-18 14:39:47,714 - portuguese-restaurant-assistant - INFO - Final verbosity level: normal
2025-03-18 14:39:47,714 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-18 14:39:47,779 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 14:39:47,781 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:576> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-18 14:39:47,783 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-40' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-18 14:39:47,784 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-18 14:39:47,797 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 14:39:47,798 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 14:39:47,800 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 14:39:47,800 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-45' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 14:39:47,801 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-18 14:39:47,804 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-18 14:39:47,812 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-18 14:39:47,814 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-18 14:39:47,816 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-18 14:39:47,817 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 14:39:47,819 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-18 14:39:47,831 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:20:11,317 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:20:11,323 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-20 22:20:15,112 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:20:15,132 - livekit.agents - INFO - starting worker
2025-03-20 22:20:15,476 - livekit.agents - INFO - registered worker
2025-03-20 22:20:31,803 - livekit.agents - INFO - received job request
2025-03-20 22:20:31,866 - livekit.agents - INFO - initializing job runner
2025-03-20 22:20:31,866 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-20 22:20:32,253 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-20 22:20:32,255 - livekit.agents - INFO - job runner initialized
2025-03-20 22:20:32,256 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:20:32,258 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-i6vRnEru87VYaG6NSfYWNT
2025-03-20 22:20:32,259 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-20 22:20:32,259 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: normal
2025-03-20 22:20:32,259 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-20 22:20:32,262 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-20 22:20:32,284 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-20 22:20:32,288 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-20 22:20:32,333 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-20 22:20:32,415 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-20 22:20:32,416 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-20 22:20:32,416 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-20 22:20:32,418 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-20 22:20:32,499 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-20 22:20:32,499 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-20 22:20:32,500 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-20 22:20:32,502 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-20 22:20:32,661 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-20 22:20:33,053 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-20 22:20:33,056 - portuguese-restaurant-assistant - INFO - Participant joined: efficient-pipeline
2025-03-20 22:20:33,057 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-20 22:20:33,058 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana'
2025-03-20 22:20:33,760 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-20 22:20:33,761 - portuguese-restaurant-assistant - INFO - Using normal response style. Length: 81
2025-03-20 22:20:33,866 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-20 22:20:34,309 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=2f8830070ecd, body=None)
2025-03-20 22:20:34,316 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=2f8830070ecd, body=None)
2025-03-20 22:20:34,324 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=2f8830070ecd, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:20:34,598 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:20:38,906 - livekit.agents - INFO - Pipeline STT metrics: duration=5.04, audio_duration=5.05
2025-03-20 22:20:43,905 - livekit.agents - INFO - Pipeline STT metrics: duration=10.04, audio_duration=5.00
2025-03-20 22:20:48,906 - livekit.agents - INFO - Pipeline STT metrics: duration=15.04, audio_duration=5.00
2025-03-20 22:20:53,906 - livekit.agents - INFO - Pipeline STT metrics: duration=20.04, audio_duration=5.00
2025-03-20 22:20:54,430 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-20 22:20:54,776 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-20 22:20:54,779 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=ab7563bae837, end_of_utterance_delay=0.92, transcription_delay=0.58
2025-03-20 22:20:56,575 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=02210285393e, body=None)
2025-03-20 22:20:56,583 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=ab7563bae837, ttft=1.35, input_tokens=400, output_tokens=27, tokens_per_second=15.01
2025-03-20 22:20:56,587 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=02210285393e, body=None)
2025-03-20 22:20:56,594 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=02210285393e, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:20:56,696 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:20:56,697 - portuguese-restaurant-assistant - INFO - User speech committed: olá?
2025-03-20 22:20:58,906 - livekit.agents - INFO - Pipeline STT metrics: duration=25.04, audio_duration=5.00
2025-03-20 22:21:03,908 - livekit.agents - INFO - Pipeline STT metrics: duration=30.04, audio_duration=5.00
2025-03-20 22:21:04,078 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-20 22:21:04,576 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-20 22:21:04,577 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=62df2d779207, end_of_utterance_delay=0.92, transcription_delay=0.42
2025-03-20 22:21:05,370 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=62df2d779207, ttft=0.41, input_tokens=406, output_tokens=27, tokens_per_second=34.20
2025-03-20 22:21:05,419 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=f361fd3ddd80, body=None)
2025-03-20 22:21:05,447 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=f361fd3ddd80, body=None)
2025-03-20 22:21:05,466 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=f361fd3ddd80, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:21:05,588 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:21:05,591 - portuguese-restaurant-assistant - INFO - User speech committed: olá,
2025-03-20 22:21:08,905 - livekit.agents - INFO - Pipeline STT metrics: duration=35.04, audio_duration=5.00
2025-03-20 22:21:33,525 - livekit.agents - INFO - shutting down worker
2025-03-20 22:21:33,530 - livekit.agents - DEBUG - shutting down job task
2025-03-20 22:21:33,536 - livekit.agents - DEBUG - job exiting
2025-03-20 22:21:33,627 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-20 22:21:33,646 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=806, llm_completion_tokens=54, tts_characters_count=0, stt_audio_duration=35.049999999999926)
2025-03-20 22:21:33,649 - portuguese-restaurant-assistant - INFO - Final verbosity level: normal
2025-03-20 22:21:33,652 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-20 22:21:33,771 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:21:33,774 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:576> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-20 22:21:33,777 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-31' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-20 22:21:33,779 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-20 22:21:33,791 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:21:33,794 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-38' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:21:33,795 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-35' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-20 22:21:33,799 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-36' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:21:33,800 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:21:33,801 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:21:33,802 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-33' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-20 22:21:33,803 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-20 22:21:33,845 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:21:33,846 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:21:33,848 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:21:33,849 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:24:47,065 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:24:47,097 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-20 22:24:50,878 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:24:50,895 - livekit.agents - INFO - starting worker
2025-03-20 22:24:51,324 - livekit.agents - INFO - registered worker
2025-03-20 22:24:57,449 - livekit.agents - INFO - received job request
2025-03-20 22:24:57,514 - livekit.agents - INFO - initializing job runner
2025-03-20 22:24:57,514 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-20 22:24:57,825 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-20 22:24:57,825 - livekit.agents - INFO - job runner initialized
2025-03-20 22:24:57,825 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:24:57,833 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-Ggts5jRgbnTvQMCaogNqBn
2025-03-20 22:24:57,833 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-20 22:24:57,835 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: normal
2025-03-20 22:24:57,835 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-20 22:24:57,837 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-20 22:24:57,839 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-20 22:24:57,841 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-20 22:24:57,845 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-20 22:24:57,930 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-20 22:24:57,932 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-20 22:24:57,933 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-20 22:24:57,935 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-20 22:24:58,020 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-20 22:24:58,021 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-20 22:24:58,023 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-20 22:24:58,024 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-20 22:24:58,184 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-20 22:24:59,601 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-20 22:24:59,603 - portuguese-restaurant-assistant - INFO - Participant joined: quantum-resistant-virtualmachine
2025-03-20 22:24:59,605 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-20 22:24:59,606 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana'
2025-03-20 22:25:00,250 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-20 22:25:00,251 - portuguese-restaurant-assistant - INFO - Using normal response style. Length: 81
2025-03-20 22:25:00,325 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-20 22:25:00,713 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=e9690e441395, body=None)
2025-03-20 22:25:00,725 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=e9690e441395, body=None)
2025-03-20 22:25:00,740 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=e9690e441395, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:25:01,042 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:25:05,440 - livekit.agents - INFO - Pipeline STT metrics: duration=5.00, audio_duration=5.00
2025-03-20 22:25:10,433 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-20 22:25:10,667 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-20 22:25:11,038 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-20 22:25:11,042 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=e2da40c30f3b, end_of_utterance_delay=0.80, transcription_delay=0.43
2025-03-20 22:25:12,686 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=715a113d6fec, body=None)
2025-03-20 22:25:12,691 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=715a113d6fec, body=None)
2025-03-20 22:25:12,699 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=715a113d6fec, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:25:12,991 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=e2da40c30f3b, ttft=1.22, input_tokens=400, output_tokens=30, tokens_per_second=15.43
2025-03-20 22:25:13,481 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=685e87f37c5b, body=None)
2025-03-20 22:25:13,494 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=685e87f37c5b, body=None)
2025-03-20 22:25:13,520 - livekit.agents - WARNING - failed to synthesize speech, retrying in 5.0s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=685e87f37c5b, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:25:15,436 - livekit.agents - INFO - Pipeline STT metrics: duration=15.00, audio_duration=5.00
2025-03-20 22:25:18,549 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:25:18,552 - portuguese-restaurant-assistant - INFO - User speech committed: olá.
2025-03-20 22:25:20,439 - livekit.agents - INFO - Pipeline STT metrics: duration=20.00, audio_duration=5.00
2025-03-20 22:25:25,438 - livekit.agents - INFO - Pipeline STT metrics: duration=25.00, audio_duration=5.00
2025-03-20 22:25:27,379 - livekit.agents - INFO - shutting down worker
2025-03-20 22:25:27,381 - livekit.agents - DEBUG - shutting down job task
2025-03-20 22:25:27,387 - livekit.agents - DEBUG - job exiting
2025-03-20 22:25:27,451 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-20 22:25:27,471 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=400, llm_completion_tokens=30, tts_characters_count=0, stt_audio_duration=24.99999999999995)
2025-03-20 22:25:27,474 - portuguese-restaurant-assistant - INFO - Final verbosity level: normal
2025-03-20 22:25:27,478 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-20 22:25:27,580 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:25:27,582 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:576> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-20 22:25:27,585 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-40' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-20 22:25:27,586 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:25:27,587 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-20 22:25:27,597 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:25:27,600 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-20 22:25:27,602 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:25:27,604 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-20 22:25:27,608 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-45' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:25:27,610 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:25:27,611 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-20 22:25:27,619 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:25:27,620 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:25:27,621 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:25:27,623 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:29:01,971 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:29:01,973 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-20 22:29:04,220 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:29:04,253 - livekit.agents - INFO - starting worker
2025-03-20 22:29:04,634 - livekit.agents - INFO - registered worker
2025-03-20 22:29:14,734 - livekit.agents - INFO - received job request
2025-03-20 22:29:14,799 - livekit.agents - INFO - initializing job runner
2025-03-20 22:29:14,799 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-20 22:29:15,219 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-20 22:29:15,224 - livekit.agents - INFO - job runner initialized
2025-03-20 22:29:15,224 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:29:15,228 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-bTY6kobw9xqEMzjbAewNy2
2025-03-20 22:29:15,228 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-20 22:29:15,234 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: normal
2025-03-20 22:29:15,234 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-20 22:29:15,239 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-20 22:29:15,264 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-20 22:29:15,264 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-20 22:29:15,307 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-20 22:29:15,434 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-20 22:29:15,434 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-20 22:29:15,434 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-20 22:29:15,434 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-20 22:29:15,528 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-20 22:29:15,534 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-20 22:29:15,534 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-20 22:29:15,534 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-20 22:29:15,692 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-20 22:29:17,200 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-20 22:29:17,204 - portuguese-restaurant-assistant - INFO - Participant joined: decentralized-syscall
2025-03-20 22:29:17,206 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-20 22:29:17,207 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana'
2025-03-20 22:29:18,802 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-20 22:29:18,802 - portuguese-restaurant-assistant - INFO - Using normal response style. Length: 81
2025-03-20 22:29:18,846 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-20 22:29:19,356 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=0cf1fe78819e, body=None)
2025-03-20 22:29:19,364 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=0cf1fe78819e, body=None)
2025-03-20 22:29:19,376 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=0cf1fe78819e, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:29:19,624 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:29:23,844 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-20 22:29:27,786 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-20 22:29:28,152 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-20 22:29:28,155 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=b2899a36c607, end_of_utterance_delay=0.73, transcription_delay=0.36
2025-03-20 22:29:28,843 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-20 22:29:29,185 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=b2899a36c607, ttft=0.74, input_tokens=403, output_tokens=24, tokens_per_second=23.41
2025-03-20 22:29:29,584 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=af5c9618c8cb, body=None)
2025-03-20 22:29:29,597 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=af5c9618c8cb, body=None)
2025-03-20 22:29:29,619 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=af5c9618c8cb, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:29:29,745 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:29:29,749 - portuguese-restaurant-assistant - INFO - User speech committed: olá, boa tarde.
2025-03-20 22:29:33,843 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-20 22:29:38,841 - livekit.agents - INFO - Pipeline STT metrics: duration=19.99, audio_duration=5.00
2025-03-20 22:29:43,842 - livekit.agents - INFO - Pipeline STT metrics: duration=24.99, audio_duration=5.00
2025-03-20 22:29:48,843 - livekit.agents - INFO - Pipeline STT metrics: duration=29.99, audio_duration=5.00
2025-03-20 22:29:53,843 - livekit.agents - INFO - Pipeline STT metrics: duration=34.99, audio_duration=5.00
2025-03-20 22:29:58,841 - livekit.agents - INFO - Pipeline STT metrics: duration=39.99, audio_duration=5.00
2025-03-20 22:30:03,843 - livekit.agents - INFO - Pipeline STT metrics: duration=44.99, audio_duration=5.00
2025-03-20 22:30:04,779 - livekit.agents - INFO - shutting down worker
2025-03-20 22:30:04,785 - livekit.agents - DEBUG - shutting down job task
2025-03-20 22:30:04,792 - livekit.agents - DEBUG - job exiting
2025-03-20 22:30:04,884 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-20 22:30:04,900 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-20 22:30:04,901 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=403, llm_completion_tokens=24, tts_characters_count=0, stt_audio_duration=44.999999999999915)
2025-03-20 22:30:04,906 - portuguese-restaurant-assistant - INFO - Final verbosity level: normal
2025-03-20 22:30:04,908 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-20 22:30:05,011 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:30:05,014 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:576> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-20 22:30:05,019 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-31' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-20 22:30:05,021 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-20 22:30:05,043 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:30:05,046 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-38' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:30:05,049 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-35' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-20 22:30:05,060 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-36' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:30:05,064 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:30:05,066 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:30:05,069 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-33' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-20 22:30:05,072 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-20 22:30:05,089 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:30:05,091 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:30:05,095 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:30:05,099 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:33:33,762 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:33:33,768 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-20 22:33:38,994 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:33:39,003 - livekit.agents - INFO - starting worker
2025-03-20 22:33:39,360 - livekit.agents - INFO - registered worker
2025-03-20 22:33:48,610 - livekit.agents - INFO - received job request
2025-03-20 22:33:48,679 - livekit.agents - INFO - initializing job runner
2025-03-20 22:33:48,680 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-20 22:33:49,058 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-20 22:33:49,064 - livekit.agents - INFO - job runner initialized
2025-03-20 22:33:49,066 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:33:49,069 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-CGDdiouuRy6cguBoYZkoeb
2025-03-20 22:33:49,069 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-20 22:33:49,069 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: normal
2025-03-20 22:33:49,077 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-20 22:33:49,078 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-20 22:33:49,098 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-20 22:33:49,112 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-20 22:33:49,164 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-20 22:33:49,253 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-20 22:33:49,254 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-20 22:33:49,254 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-20 22:33:49,258 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-20 22:33:49,345 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-20 22:33:49,345 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-20 22:33:49,348 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-20 22:33:49,350 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-20 22:33:49,508 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-20 22:33:49,920 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-20 22:33:49,926 - portuguese-restaurant-assistant - INFO - Participant joined: predictive-warp
2025-03-20 22:33:49,928 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-20 22:33:49,928 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana'
2025-03-20 22:33:51,182 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-20 22:33:51,184 - portuguese-restaurant-assistant - INFO - Using normal response style. Length: 81
2025-03-20 22:33:51,192 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-20 22:33:51,728 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=2a1401d19f09, body=None)
2025-03-20 22:33:51,735 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=2a1401d19f09, body=None)
2025-03-20 22:33:51,752 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=2a1401d19f09, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:33:53,084 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:33:56,235 - livekit.agents - INFO - Pipeline STT metrics: duration=5.04, audio_duration=5.05
2025-03-20 22:34:01,237 - livekit.agents - INFO - Pipeline STT metrics: duration=10.04, audio_duration=5.00
2025-03-20 22:34:06,235 - livekit.agents - INFO - Pipeline STT metrics: duration=15.04, audio_duration=5.00
2025-03-20 22:34:11,234 - livekit.agents - INFO - Pipeline STT metrics: duration=20.04, audio_duration=5.00
2025-03-20 22:34:11,703 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-20 22:34:11,706 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=7d5eabe4363d, end_of_utterance_delay=5.54, transcription_delay=0.00
2025-03-20 22:34:13,280 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=7d5eabe4363d, ttft=1.17, input_tokens=401, output_tokens=41, tokens_per_second=26.16
2025-03-20 22:34:13,315 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=3c65d5b8eb3f, body=None)
2025-03-20 22:34:13,328 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=3c65d5b8eb3f, body=None)
2025-03-20 22:34:13,347 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=3c65d5b8eb3f, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:34:13,465 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:34:16,233 - livekit.agents - INFO - Pipeline STT metrics: duration=25.04, audio_duration=5.00
2025-03-20 22:34:20,695 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-20 22:34:20,698 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=15498d810840, end_of_utterance_delay=5.54, transcription_delay=0.00
2025-03-20 22:34:21,236 - livekit.agents - INFO - Pipeline STT metrics: duration=30.04, audio_duration=5.00
2025-03-20 22:34:21,654 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=15498d810840, ttft=0.53, input_tokens=401, output_tokens=28, tokens_per_second=29.43
2025-03-20 22:34:21,947 - livekit.plugins.elevenlabs - ERROR - Error in recv_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=bc76ede0945d, body=None)
2025-03-20 22:34:21,952 - livekit.plugins.elevenlabs - ERROR - Error in _process_segments
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=bc76ede0945d, body=None)
2025-03-20 22:34:21,959 - livekit.agents - WARNING - failed to synthesize speech, retrying in 0.1s
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 380, in _run
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 373, in _process_segments
    await self._run_ws(word_stream, request_id)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 517, in _run_ws
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 497, in recv_task
    raise APIStatusError(
livekit.agents._exceptions.APIStatusError: only_for_creator+ (status_code=500, request_id=bc76ede0945d, body=None)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\tts\tts.py", line 285, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\elevenlabs\tts.py", line 391, in _run
    raise APIConnectionError() from e
livekit.agents._exceptions.APIConnectionError: Connection error.
2025-03-20 22:34:22,063 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:34:26,232 - livekit.agents - INFO - Pipeline STT metrics: duration=35.04, audio_duration=5.00
2025-03-20 22:34:29,115 - livekit.agents - INFO - shutting down worker
2025-03-20 22:34:29,117 - livekit.agents - DEBUG - shutting down job task
2025-03-20 22:34:29,120 - livekit.agents - DEBUG - job exiting
2025-03-20 22:34:29,183 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-20 22:34:29,216 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=802, llm_completion_tokens=69, tts_characters_count=0, stt_audio_duration=35.049999999999926)
2025-03-20 22:34:29,218 - portuguese-restaurant-assistant - INFO - Final verbosity level: normal
2025-03-20 22:34:29,218 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-20 22:34:29,287 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:34:29,289 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:576> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-20 22:34:29,291 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-31' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-20 22:34:29,293 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-20 22:34:29,303 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:34:29,305 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-38' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:34:29,305 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-35' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-20 22:34:29,311 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-36' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:34:29,313 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:34:29,314 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:34:29,315 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-33' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-20 22:34:29,316 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-20 22:34:29,325 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:34:29,326 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:34:29,328 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:34:29,329 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:41:20,600 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:41:20,600 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-20 22:41:24,428 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:41:24,451 - livekit.agents - INFO - starting worker
2025-03-20 22:41:24,884 - livekit.agents - INFO - registered worker
2025-03-20 22:41:56,837 - livekit.agents - INFO - received job request
2025-03-20 22:41:56,919 - livekit.agents - INFO - initializing job runner
2025-03-20 22:41:56,926 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-20 22:41:57,543 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-20 22:41:57,544 - livekit.agents - INFO - job runner initialized
2025-03-20 22:41:57,545 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-20 22:41:57,549 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-gNnmDoN4Br6CrTKtXwn5vv
2025-03-20 22:41:57,549 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-20 22:41:57,549 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: normal
2025-03-20 22:41:57,549 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-20 22:41:57,554 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-20 22:41:57,581 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-20 22:41:57,584 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-20 22:41:57,634 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-20 22:41:57,754 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-20 22:41:57,760 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-20 22:41:57,763 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-20 22:41:57,764 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-20 22:41:57,845 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-20 22:41:57,845 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-20 22:41:57,845 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-20 22:41:57,854 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-20 22:41:58,004 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-20 22:41:59,474 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-20 22:41:59,474 - portuguese-restaurant-assistant - INFO - Participant joined: ultra-virtualmachine
2025-03-20 22:41:59,481 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-20 22:41:59,481 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana'
2025-03-20 22:42:00,794 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-20 22:42:00,794 - portuguese-restaurant-assistant - INFO - Using normal response style. Length: 81
2025-03-20 22:42:00,877 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-20 22:42:01,715 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-20 22:42:02,494 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=e69e4f5f7d71, ttfb=0.5324099999852479, audio_duration=6.40
2025-03-20 22:42:06,036 - livekit.agents - INFO - Pipeline STT metrics: duration=5.04, audio_duration=5.05
2025-03-20 22:42:08,122 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:42:08,122 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa noite! Bem-vindo ao Restaurante Português. O que gostaria de encomendar hoje?
2025-03-20 22:42:08,126 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-20 22:42:10,617 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-20 22:42:10,984 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-20 22:42:10,984 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c66da0cd6c91, end_of_utterance_delay=0.76, transcription_delay=0.39
2025-03-20 22:42:11,051 - livekit.agents - INFO - Pipeline STT metrics: duration=10.06, audio_duration=5.00
2025-03-20 22:42:12,115 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c66da0cd6c91, ttft=0.80, input_tokens=425, output_tokens=21, tokens_per_second=18.72
2025-03-20 22:42:12,752 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-20 22:42:12,871 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c66da0cd6c91, ttfb=0.9526717999251559, audio_duration=6.24
2025-03-20 22:42:14,366 - portuguese-restaurant-assistant - INFO - User speech committed: olá, boa tarde.
2025-03-20 22:42:16,067 - livekit.agents - INFO - Pipeline STT metrics: duration=15.07, audio_duration=5.05
2025-03-20 22:42:19,001 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:42:19,004 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Ora bem, diga-me então, o que gostaria de encomendar do nosso menu?
2025-03-20 22:42:19,008 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-20 22:42:21,077 - livekit.agents - INFO - Pipeline STT metrics: duration=20.08, audio_duration=5.00
2025-03-20 22:42:23,269 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-20 22:42:23,645 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-20 22:42:23,648 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=bdd03f25c463, end_of_utterance_delay=0.80, transcription_delay=0.43
2025-03-20 22:42:24,689 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=bdd03f25c463, ttft=0.42, input_tokens=469, output_tokens=30, tokens_per_second=28.92
2025-03-20 22:42:25,451 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-20 22:42:25,665 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=bdd03f25c463, ttfb=1.3467704999493435, audio_duration=8.07
2025-03-20 22:42:26,077 - livekit.agents - INFO - Pipeline STT metrics: duration=25.09, audio_duration=5.00
2025-03-20 22:42:27,103 - portuguese-restaurant-assistant - INFO - User speech committed: ora bem preciso de 1 frango 1 batata e é tudo.
2025-03-20 22:42:31,116 - livekit.agents - INFO - Pipeline STT metrics: duration=30.13, audio_duration=5.05
2025-03-20 22:42:33,528 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-20 22:42:33,534 - portuguese-restaurant-assistant - INFO - Agent speech committed: Com certeza! Então, temos aqui um frango e uma porção de batatas. A que hora gostaria de levantar a sua encomenda?
2025-03-20 22:42:33,534 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-20 22:42:37,545 - livekit.agents - INFO - shutting down worker
2025-03-20 22:42:37,547 - livekit.agents - DEBUG - shutting down job task
2025-03-20 22:42:37,550 - livekit.agents - DEBUG - job exiting
2025-03-20 22:42:37,615 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-20 22:42:37,632 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-20 22:42:37,634 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-20 22:42:37,637 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=894, llm_completion_tokens=51, tts_characters_count=273, stt_audio_duration=30.149999999999938)
2025-03-20 22:42:37,642 - portuguese-restaurant-assistant - INFO - Final verbosity level: normal
2025-03-20 22:42:37,643 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-20 22:42:37,752 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:42:37,760 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:576> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-20 22:42:37,769 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-40' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-20 22:42:37,776 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-20 22:42:37,963 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:42:37,972 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:42:37,975 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-20 22:42:38,099 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-45' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:42:38,099 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:42:38,102 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:42:38,102 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-20 22:42:38,110 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-20 22:42:38,249 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-20 22:42:38,256 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:42:38,262 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-20 22:42:38,265 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 11:41:39,881 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 11:41:39,881 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 11:41:42,249 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 11:41:42,261 - livekit.agents - INFO - starting worker
2025-03-21 11:41:42,624 - livekit.agents - INFO - registered worker
2025-03-21 11:42:00,402 - livekit.agents - INFO - received job request
2025-03-21 11:42:00,450 - livekit.agents - INFO - initializing job runner
2025-03-21 11:42:00,450 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 11:42:00,726 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 11:42:00,726 - livekit.agents - INFO - job runner initialized
2025-03-21 11:42:00,726 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 11:42:00,731 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-TrDwcnCYnGYquAEnC6JEkT
2025-03-21 11:42:00,731 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 11:42:00,736 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: normal
2025-03-21 11:42:00,736 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-21 11:42:00,736 - portuguese-restaurant-assistant - INFO - Initialized conversation transcript tracker
2025-03-21 11:42:00,741 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 11:42:00,764 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 11:42:00,767 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 11:42:00,812 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 11:42:00,900 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 11:42:00,902 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 11:42:00,903 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 11:42:00,904 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 11:42:00,958 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 11:42:00,958 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 11:42:00,958 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 11:42:00,958 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 11:42:01,076 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 11:42:01,351 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 11:42:01,353 - portuguese-restaurant-assistant - INFO - Participant joined: autonomous-bit
2025-03-21 11:42:01,354 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 11:42:01,355 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana'
2025-03-21 11:42:01,866 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-21 11:42:01,866 - portuguese-restaurant-assistant - INFO - Using normal response style. Length: 81
2025-03-21 11:42:01,925 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 11:42:03,116 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-21 11:42:07,034 - livekit.agents - INFO - Pipeline STT metrics: duration=5.03, audio_duration=5.05
2025-03-21 11:42:12,033 - livekit.agents - INFO - Pipeline STT metrics: duration=10.03, audio_duration=5.00
2025-03-21 11:42:17,031 - livekit.agents - INFO - Pipeline STT metrics: duration=15.03, audio_duration=5.00
2025-03-21 11:42:17,341 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 11:42:17,342 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=45ec9642c467, end_of_utterance_delay=5.53, transcription_delay=0.00
2025-03-21 11:42:19,174 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=45ec9642c467, ttft=1.21, input_tokens=401, output_tokens=36, tokens_per_second=19.68
2025-03-21 11:42:19,320 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 11:42:19,913 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=45ec9642c467, ttfb=0.5500365999760106, audio_duration=11.65
2025-03-21 11:42:22,031 - livekit.agents - INFO - Pipeline STT metrics: duration=20.03, audio_duration=5.00
2025-03-21 11:42:30,976 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 11:42:30,978 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ora bem, o senhor gostaria de fazer uma encomenda para takeaway? O que deseja encomendar do nosso menu? Temos várias opções deliciosas típicas da gastronomia portuguesa!
2025-03-21 11:42:30,985 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Ora bem, o senhor gostaria de fazer uma encomenda para takeaway? O que deseja encomendar do nosso menu? Temos várias opções deliciosas típicas da gastronomia portuguesa!
2025-03-21 11:42:30,989 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 11:42:45,442 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 11:42:45,447 - livekit.agents - DEBUG - shutting down job task
2025-03-21 11:42:45,448 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-21 11:42:45,455 - livekit.agents - DEBUG - job exiting
2025-03-21 11:42:45,462 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=401, llm_completion_tokens=36, tts_characters_count=169, stt_audio_duration=20.049999999999958)
2025-03-21 11:42:45,465 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-21 11:42:45,468 - portuguese-restaurant-assistant - INFO - Final verbosity level: normal
2025-03-21 11:42:45,472 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-21 11:42:45,475 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-21 11:42:45,509 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-21 11:42:45,827 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-21 11:42:45,832 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-21 11:42:45,837 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-21 11:42:45,840 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 11:43:25,331 - livekit.agents - INFO - shutting down worker
2025-03-21 11:43:25,364 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:813> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-21 11:43:25,364 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-40' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-21 11:43:25,364 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 11:43:25,364 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-21 11:43:25,379 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-44' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-21 11:43:25,433 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 11:43:25,433 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 11:43:25,433 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 11:43:25,433 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-45' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 11:43:25,433 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 11:43:25,433 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-42' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-21 11:43:25,442 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-21 11:43:25,458 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 11:43:25,458 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 11:43:25,458 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future finished result=None> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 11:43:25,474 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 15:49:01,567 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 15:49:01,570 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 15:49:05,179 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 15:49:05,199 - livekit.agents - INFO - starting worker
2025-03-21 15:49:05,563 - livekit.agents - INFO - registered worker
2025-03-21 15:49:31,346 - livekit.agents - INFO - received job request
2025-03-21 15:49:31,422 - livekit.agents - INFO - initializing job runner
2025-03-21 15:49:31,422 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 15:49:31,820 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 15:49:31,820 - livekit.agents - INFO - job runner initialized
2025-03-21 15:49:31,829 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 15:49:31,830 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_SQgntS8JxUqH
2025-03-21 15:49:31,830 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 15:49:31,833 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: normal
2025-03-21 15:49:31,833 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-21 15:49:31,835 - portuguese-restaurant-assistant - INFO - Initialized conversation transcript tracker
2025-03-21 15:49:31,835 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 15:49:31,857 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 15:49:31,857 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 15:49:31,897 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 15:49:32,018 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 15:49:32,020 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 15:49:32,023 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 15:49:32,024 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 15:49:32,117 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 15:49:32,118 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 15:49:32,119 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 15:49:32,119 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 15:49:32,310 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 15:49:33,754 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 15:49:33,759 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-21 15:49:33,762 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 15:49:33,763 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with voice 'Ana'
2025-03-21 15:49:34,316 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-21 15:49:34,317 - portuguese-restaurant-assistant - INFO - Using normal response style. Length: 81
2025-03-21 15:49:34,416 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 15:49:35,599 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 15:49:35,904 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=7d8cf0ff96bb, ttfb=0.8235308000585064, audio_duration=7.05
2025-03-21 15:49:40,622 - livekit.agents - INFO - Pipeline STT metrics: duration=5.04, audio_duration=5.05
2025-03-21 15:49:42,662 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 15:49:42,667 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Bem-vindo ao Restaurante Português. O que gostaria de encomendar hoje?
2025-03-21 15:49:42,672 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Bem-vindo ao Restaurante Português. O que gostaria de encomendar hoje?
2025-03-21 15:49:42,679 - portuguese-restaurant-assistant - INFO - Extracted customer name: ao restaurante
2025-03-21 15:49:42,688 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 15:49:45,624 - livekit.agents - INFO - Pipeline STT metrics: duration=10.04, audio_duration=5.00
2025-03-21 15:49:46,400 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 15:49:46,452 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 15:49:46,454 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=0d387706d3a2, end_of_utterance_delay=0.92, transcription_delay=0.87
2025-03-21 15:49:48,475 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=0d387706d3a2, ttft=1.46, input_tokens=425, output_tokens=20, tokens_per_second=9.92
2025-03-21 15:49:49,115 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 15:49:49,204 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=0d387706d3a2, ttfb=1.1693400000222027, audio_duration=4.99
2025-03-21 15:49:50,620 - livekit.agents - INFO - Pipeline STT metrics: duration=15.03, audio_duration=5.00
2025-03-21 15:49:50,761 - portuguese-restaurant-assistant - INFO - User speech committed: olá, boa tarde.
2025-03-21 15:49:50,764 - portuguese-restaurant-assistant - INFO - Added user message to transcript: olá, boa tarde.
2025-03-21 15:49:54,115 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 15:49:54,120 - portuguese-restaurant-assistant - INFO - Agent speech committed: Ora bem, boa tarde! Como posso ajudar o senhor com a sua encomenda de hoje?
2025-03-21 15:49:54,123 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Ora bem, boa tarde! Como posso ajudar o senhor com a sua encomenda de hoje?
2025-03-21 15:49:54,128 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 15:49:55,623 - livekit.agents - INFO - Pipeline STT metrics: duration=20.04, audio_duration=5.00
2025-03-21 15:50:00,624 - livekit.agents - INFO - Pipeline STT metrics: duration=25.04, audio_duration=5.00
2025-03-21 15:50:03,921 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 15:50:03,925 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=8e92e2cec807, end_of_utterance_delay=5.53, transcription_delay=0.00
2025-03-21 15:50:04,794 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=8e92e2cec807, ttft=0.48, input_tokens=455, output_tokens=16, tokens_per_second=18.54
2025-03-21 15:50:05,351 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 15:50:05,627 - livekit.agents - INFO - Pipeline STT metrics: duration=30.04, audio_duration=5.00
2025-03-21 15:50:05,653 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=8e92e2cec807, ttfb=0.8462628999259323, audio_duration=4.02
2025-03-21 15:50:09,385 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 15:50:09,390 - portuguese-restaurant-assistant - INFO - Agent speech committed: Que pratos gostava de encomendar do nosso menu, se faz favor?
2025-03-21 15:50:09,394 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Que pratos gostava de encomendar do nosso menu, se faz favor?
2025-03-21 15:50:09,398 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 15:50:10,623 - livekit.agents - INFO - Pipeline STT metrics: duration=35.04, audio_duration=5.00
2025-03-21 15:50:32,779 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 15:50:32,786 - livekit.agents - DEBUG - shutting down job task
2025-03-21 15:50:32,787 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-21 15:50:32,795 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-21 15:50:32,796 - livekit.agents - DEBUG - job exiting
2025-03-21 15:50:32,804 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-21 15:50:32,807 - portuguese-restaurant-assistant - INFO - Room disconnected, sending conversation transcript to Make.com
2025-03-21 15:50:32,819 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=880, llm_completion_tokens=36, tts_characters_count=217, stt_audio_duration=35.049999999999926)
2025-03-21 15:50:32,824 - portuguese-restaurant-assistant - INFO - Final verbosity level: normal
2025-03-21 15:50:32,829 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-21 15:50:32,830 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-21 15:50:32,833 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-21 15:50:32,904 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-21 15:50:33,260 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-21 15:50:33,261 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-21 15:50:33,263 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-21 15:50:33,263 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 15:50:37,813 - livekit.agents - INFO - shutting down worker
2025-03-21 15:50:37,917 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 15:50:37,919 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-49' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-21 15:50:37,922 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 15:50:37,922 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:935> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-21 15:50:37,926 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-21 15:50:37,926 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 15:50:37,929 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 15:50:37,930 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-21 15:50:37,942 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-51' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-21 15:50:38,064 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-52' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 15:50:38,068 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 15:50:38,073 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-21 15:50:38,150 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-115' coro=<entrypoint.<locals>.send_transcript_on_disconnect() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:908> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 15:50:38,157 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-63' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 15:50:38,160 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-62' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 15:50:38,167 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-61' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future finished result=None> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 15:50:38,171 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-60' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 15:57:22,305 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 15:57:22,311 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 15:57:25,263 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 15:57:25,270 - livekit.agents - INFO - starting worker
2025-03-21 15:57:25,803 - livekit.agents - INFO - registered worker
2025-03-21 15:57:38,932 - livekit.agents - INFO - received job request
2025-03-21 15:57:39,039 - livekit.agents - INFO - initializing job runner
2025-03-21 15:57:39,043 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 15:57:39,385 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 15:57:39,385 - livekit.agents - INFO - job runner initialized
2025-03-21 15:57:39,386 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 15:57:39,388 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_yXcWEbm6WBDN
2025-03-21 15:57:39,388 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: concise
2025-03-21 15:57:39,388 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-21 15:57:39,391 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-21 15:57:39,392 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 15:57:39,392 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 15:57:39,411 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 15:57:39,411 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 15:57:39,453 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 15:57:39,587 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 15:57:39,589 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 15:57:39,592 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 15:57:39,595 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 15:57:39,686 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 15:57:39,688 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 15:57:39,688 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 15:57:39,689 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 15:57:39,921 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 15:57:40,303 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 15:57:40,306 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-21 15:57:40,310 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 15:57:40,313 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-21 15:57:41,234 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-21 15:57:42,352 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 15:57:42,960 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 15:57:43,148 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=ddd852415d92, ttfb=1.6373211999889463, audio_duration=3.19
2025-03-21 15:57:46,125 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 15:57:46,125 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 15:57:46,127 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 15:57:46,128 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-21 15:57:46,130 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 15:57:47,394 - livekit.agents - INFO - Pipeline STT metrics: duration=5.04, audio_duration=5.05
2025-03-21 15:57:48,865 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 15:57:49,228 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 15:57:49,230 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=a5179374c378, end_of_utterance_delay=0.84, transcription_delay=0.47
2025-03-21 15:57:50,891 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=a5179374c378, ttft=1.17, input_tokens=266, output_tokens=31, tokens_per_second=18.72
2025-03-21 15:57:52,394 - livekit.agents - INFO - Pipeline STT metrics: duration=10.04, audio_duration=5.00
2025-03-21 15:57:52,784 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 15:57:53,205 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=a5179374c378, ttfb=1.8830035999417305, audio_duration=7.62
2025-03-21 15:57:54,289 - portuguese-restaurant-assistant - INFO - User speech committed: alô boa tarde, crio 1 fórum.
2025-03-21 15:57:54,292 - portuguese-restaurant-assistant - INFO - Added user message to transcript: alô boa tarde, crio 1 fórum.
2025-03-21 15:57:56,497 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=1a3e9855b74d, ttfb=2.1716577999759465, audio_duration=0.46
2025-03-21 15:57:57,395 - livekit.agents - INFO - Pipeline STT metrics: duration=15.04, audio_duration=5.00
2025-03-21 15:58:00,415 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 15:58:00,419 - portuguese-restaurant-assistant - INFO - Agent speech committed: Com certeza! Poderia indicar-me os items do menu que gostaria de encomendar, a hora de levantamento, e o seu nome, por favor?
2025-03-21 15:58:00,421 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Com certeza! Poderia indicar-me os items do menu que gostaria de encomendar, a hora de levantamento, e o seu nome, por favor?
2025-03-21 15:58:00,425 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 15:58:00,431 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 15:58:00,884 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 15:58:00,890 - portuguese-restaurant-assistant - INFO - Agent speech committed: Certo.
2025-03-21 15:58:00,893 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Certo.
2025-03-21 15:58:00,896 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 15:58:02,396 - livekit.agents - INFO - Pipeline STT metrics: duration=20.04, audio_duration=5.00
2025-03-21 15:58:27,769 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 15:58:27,773 - livekit.agents - DEBUG - shutting down job task
2025-03-21 15:58:27,774 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-21 15:58:27,784 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-21 15:58:27,786 - livekit.agents - DEBUG - job exiting
2025-03-21 15:58:27,798 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=266, llm_completion_tokens=31, tts_characters_count=185, stt_audio_duration=20.049999999999958)
2025-03-21 15:58:27,803 - portuguese-restaurant-assistant - INFO - Final verbosity level: concise
2025-03-21 15:58:27,807 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-21 15:58:27,810 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-21 15:58:27,830 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-90' coro=<entrypoint.<locals>.process_user_speech() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:866> exception=AttributeError("'ConversationTracker' object has no attribute 'extract_order_details'")>
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 876, in process_user_speech
    conversation_tracker.extract_order_details(content)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ConversationTracker' object has no attribute 'extract_order_details'. Did you mean: '_extract_order_details'?
2025-03-21 15:58:27,848 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-21 15:58:28,217 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-21 15:58:28,222 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-21 15:58:28,227 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-21 15:58:28,230 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 15:58:34,473 - livekit.agents - INFO - received job request
2025-03-21 15:58:34,540 - livekit.agents - INFO - initializing job runner
2025-03-21 15:58:34,541 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 15:58:34,701 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 15:58:34,701 - livekit.agents - INFO - job runner initialized
2025-03-21 15:58:34,703 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 15:58:34,705 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_N5uBYrF8xopV
2025-03-21 15:58:34,705 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: concise
2025-03-21 15:58:34,707 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-21 15:58:34,707 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-21 15:58:34,708 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 15:58:34,708 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 15:58:34,709 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 15:58:34,834 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 15:58:34,838 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 15:58:34,840 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 15:58:34,842 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 15:58:34,932 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 15:58:34,934 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 15:58:34,935 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 15:58:34,938 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 15:58:35,155 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 15:58:36,563 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 15:58:36,565 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-21 15:58:36,568 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 15:58:36,570 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-21 15:58:37,414 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-21 15:58:38,448 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 15:58:39,134 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 15:58:39,380 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=82be3caf638c, ttfb=1.6467017999384552, audio_duration=3.26
2025-03-21 15:58:42,377 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 15:58:42,381 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 15:58:42,385 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 15:58:42,387 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-21 15:58:42,390 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 15:58:43,448 - livekit.agents - INFO - Pipeline STT metrics: duration=5.00, audio_duration=5.00
2025-03-21 15:58:45,033 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 15:58:45,404 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 15:58:45,406 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=b18664314d74, end_of_utterance_delay=0.78, transcription_delay=0.41
2025-03-21 15:58:46,671 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=b18664314d74, ttft=0.81, input_tokens=263, output_tokens=22, tokens_per_second=17.41
2025-03-21 15:58:48,224 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 15:58:48,258 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=b18664314d74, ttfb=1.665686700027436, audio_duration=2.66
2025-03-21 15:58:48,444 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-21 15:58:49,200 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=b18664314d74, ttfb=0.9258546000346541, audio_duration=1.88
2025-03-21 15:58:49,903 - portuguese-restaurant-assistant - INFO - User speech committed: boa tarde queria 1 frango.
2025-03-21 15:58:49,905 - portuguese-restaurant-assistant - INFO - Added user message to transcript: boa tarde queria 1 frango.
2025-03-21 15:58:49,909 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-194' coro=<entrypoint.<locals>.process_user_speech() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:866> exception=AttributeError("'ConversationTracker' object has no attribute 'extract_order_details'")>
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 876, in process_user_speech
    conversation_tracker.extract_order_details(content)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ConversationTracker' object has no attribute 'extract_order_details'. Did you mean: '_extract_order_details'?
2025-03-21 15:58:51,294 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=b0c9e4457797, ttfb=1.3400294999592006, audio_duration=0.64
2025-03-21 15:58:52,759 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 15:58:52,763 - portuguese-restaurant-assistant - INFO - Agent speech committed: Claro! A que horas deseja levantar o frango? E qual é o seu nome, por favor?
2025-03-21 15:58:52,766 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Claro! A que horas deseja levantar o frango? E qual é o seu nome, por favor?
2025-03-21 15:58:52,770 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 15:58:52,776 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 15:58:53,402 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 15:58:53,407 - portuguese-restaurant-assistant - INFO - Agent speech committed: Compreendo.
2025-03-21 15:58:53,409 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Compreendo.
2025-03-21 15:58:53,412 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 15:58:53,449 - livekit.agents - INFO - Pipeline STT metrics: duration=15.00, audio_duration=5.00
2025-03-21 15:59:17,358 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 15:59:17,360 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-21 15:59:17,362 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-21 15:59:17,362 - livekit.agents - DEBUG - shutting down job task
2025-03-21 15:59:17,365 - livekit.agents - DEBUG - job exiting
2025-03-21 15:59:17,366 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-21 15:59:17,367 - portuguese-restaurant-assistant - INFO - Room disconnected, sending conversation transcript to Make.com
2025-03-21 15:59:17,369 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=263, llm_completion_tokens=22, tts_characters_count=140, stt_audio_duration=14.999999999999972)
2025-03-21 15:59:17,370 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-21 15:59:17,370 - portuguese-restaurant-assistant - INFO - Final verbosity level: concise
2025-03-21 15:59:17,371 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-21 15:59:17,371 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-21 15:59:17,374 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-21 15:59:17,576 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-21 15:59:17,577 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-21 15:59:17,578 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-21 15:59:17,579 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 16:00:12,065 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:00:12,082 - livekit.agents - INFO - starting worker
2025-03-21 16:00:12,088 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-21 16:00:12,406 - livekit.agents - INFO - registered worker
2025-03-21 16:03:51,778 - livekit.agents - INFO - shutting down worker
2025-03-21 16:03:51,804 - asyncio - ERROR - Exception in callback _ProactorBasePipeTransport._call_connection_lost(None)
handle: <Handle _ProactorBasePipeTransport._call_connection_lost(None)>
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Python312\Lib\asyncio\proactor_events.py", line 165, in _call_connection_lost
    self._sock.shutdown(socket.SHUT_RDWR)
ConnectionResetError: [WinError 10054] Uma ligação existente foi forçada a fechar pelo anfitrião remoto
2025-03-21 16:03:59,371 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:03:59,374 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 16:04:02,047 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:04:02,047 - livekit.agents - INFO - starting worker
2025-03-21 16:04:02,407 - livekit.agents - INFO - registered worker
2025-03-21 16:04:05,005 - livekit.agents - INFO - received job request
2025-03-21 16:04:05,075 - livekit.agents - INFO - initializing job runner
2025-03-21 16:04:05,078 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 16:04:05,462 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 16:04:05,473 - livekit.agents - INFO - job runner initialized
2025-03-21 16:04:05,474 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:04:05,477 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_evSTP2SGjFtn
2025-03-21 16:04:05,478 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: concise
2025-03-21 16:04:05,478 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-21 16:04:05,479 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-21 16:04:05,479 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 16:04:05,480 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 16:04:05,502 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 16:04:05,502 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 16:04:05,558 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 16:04:05,640 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 16:04:05,643 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 16:04:05,644 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 16:04:05,646 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 16:04:05,742 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 16:04:05,744 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 16:04:05,746 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 16:04:05,748 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 16:04:05,934 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 16:04:07,401 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 16:04:07,405 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-21 16:04:07,408 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 16:04:07,411 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-21 16:04:08,463 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-21 16:04:09,569 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 16:04:10,340 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:04:10,626 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=0866dc15680b, ttfb=1.756921699969098, audio_duration=3.21
2025-03-21 16:04:13,525 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:04:13,529 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 16:04:13,533 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 16:04:13,575 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-21 16:04:13,583 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:04:14,613 - livekit.agents - INFO - Pipeline STT metrics: duration=5.04, audio_duration=5.05
2025-03-21 16:04:16,727 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 16:04:17,042 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 16:04:17,046 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=6a4112d47cfe, end_of_utterance_delay=0.92, transcription_delay=0.60
2025-03-21 16:04:18,079 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=6a4112d47cfe, ttft=0.64, input_tokens=265, output_tokens=21, tokens_per_second=20.45
2025-03-21 16:04:19,482 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:04:19,612 - livekit.agents - INFO - Pipeline STT metrics: duration=10.04, audio_duration=5.00
2025-03-21 16:04:19,706 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=6a4112d47cfe, ttfb=1.3932643999578431, audio_duration=5.05
2025-03-21 16:04:20,977 - portuguese-restaurant-assistant - INFO - User speech committed: olá boa tarde, queiram 1 tango.
2025-03-21 16:04:20,980 - portuguese-restaurant-assistant - INFO - Added user message to transcript: olá boa tarde, queiram 1 tango.
2025-03-21 16:04:22,456 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c5d8de217d22, ttfb=1.4198676999658346, audio_duration=0.64
2025-03-21 16:04:24,527 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:04:24,530 - portuguese-restaurant-assistant - INFO - Agent speech committed: Com certeza! A que horas deseja levantar o seu pedido e em nome de quem, por favor?
2025-03-21 16:04:24,534 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Com certeza! A que horas deseja levantar o seu pedido e em nome de quem, por favor?
2025-03-21 16:04:24,538 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:04:24,545 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:04:24,615 - livekit.agents - INFO - Pipeline STT metrics: duration=15.04, audio_duration=5.00
2025-03-21 16:04:25,171 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:04:25,175 - portuguese-restaurant-assistant - INFO - Agent speech committed: Compreendo.
2025-03-21 16:04:25,179 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Compreendo.
2025-03-21 16:04:25,182 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:04:28,689 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 16:04:29,151 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 16:04:29,155 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=67a6f35719b9, end_of_utterance_delay=1.06, transcription_delay=0.60
2025-03-21 16:04:29,614 - livekit.agents - INFO - Pipeline STT metrics: duration=20.04, audio_duration=5.00
2025-03-21 16:04:30,360 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=67a6f35719b9, ttft=0.59, input_tokens=303, output_tokens=27, tokens_per_second=22.53
2025-03-21 16:04:31,113 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:04:31,460 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=67a6f35719b9, ttfb=1.063391900039278, audio_duration=3.08
2025-03-21 16:04:32,773 - portuguese-restaurant-assistant - INFO - User speech committed: pode ser
2025-03-21 16:04:32,776 - portuguese-restaurant-assistant - INFO - Added user message to transcript: pode ser
2025-03-21 16:04:33,278 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=67a6f35719b9, ttfb=1.5598893000278622, audio_duration=3.00
2025-03-21 16:04:34,613 - livekit.agents - INFO - Pipeline STT metrics: duration=25.04, audio_duration=5.00
2025-03-21 16:04:37,197 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:04:37,201 - portuguese-restaurant-assistant - INFO - Agent speech committed: Perfeito! A que horas deseja levantar o seu Tango? E qual é o nome do senhor ou da senhora, por favor?
2025-03-21 16:04:37,204 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Perfeito! A que horas deseja levantar o seu Tango? E qual é o nome do senhor ou da senhora, por favor?
2025-03-21 16:04:37,209 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:04:37,498 - livekit.agents - INFO - shutting down worker
2025-03-21 16:04:37,504 - livekit.agents - DEBUG - shutting down job task
2025-03-21 16:04:37,512 - livekit.agents - DEBUG - job exiting
2025-03-21 16:04:37,603 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 16:04:37,609 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=568, llm_completion_tokens=48, tts_characters_count=249, stt_audio_duration=25.049999999999947)
2025-03-21 16:04:37,610 - portuguese-restaurant-assistant - INFO - Final verbosity level: concise
2025-03-21 16:04:37,610 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-21 16:04:37,611 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-21 16:04:37,615 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-21 16:04:37,983 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-21 16:04:37,989 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-21 16:04:37,993 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-21 16:04:37,997 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 16:04:38,100 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:1109> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-21 16:04:38,103 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:04:38,105 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-21 16:04:38,106 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-21 16:04:38,115 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 16:04:38,117 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 16:04:38,117 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:04:38,119 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-52' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:04:38,120 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:04:38,121 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-21 16:04:38,128 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-49' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-21 16:04:38,129 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-51' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-21 16:04:38,131 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-60' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-21 16:04:38,134 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 16:04:38,135 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 16:04:38,144 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-59' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 16:08:57,854 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:08:57,860 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 16:09:00,410 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:09:00,422 - livekit.agents - INFO - starting worker
2025-03-21 16:09:00,798 - livekit.agents - INFO - registered worker
2025-03-21 16:09:08,967 - livekit.agents - INFO - received job request
2025-03-21 16:09:09,047 - livekit.agents - INFO - initializing job runner
2025-03-21 16:09:09,052 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 16:09:09,461 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 16:09:09,474 - livekit.agents - INFO - job runner initialized
2025-03-21 16:09:09,474 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:09:09,478 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_ydecVciQATCv
2025-03-21 16:09:09,478 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: concise
2025-03-21 16:09:09,479 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-21 16:09:09,479 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-21 16:09:09,480 - portuguese-restaurant-assistant - INFO - Initialized acknowledgment tracker to prevent duplicate responses
2025-03-21 16:09:09,480 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 16:09:09,480 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 16:09:09,499 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 16:09:09,499 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 16:09:09,556 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 16:09:09,634 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 16:09:09,635 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 16:09:09,636 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 16:09:09,636 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 16:09:09,725 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 16:09:09,726 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 16:09:09,728 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 16:09:09,729 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 16:09:09,922 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 16:09:10,335 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 16:09:10,340 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-21 16:09:10,344 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 16:09:10,346 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-21 16:09:11,283 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-21 16:09:12,361 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 16:09:13,994 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:09:14,321 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=7454510b68d5, ttfb=2.6265820000553504, audio_duration=3.29
2025-03-21 16:09:17,246 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:09:17,251 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 16:09:17,254 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 16:09:17,262 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-21 16:09:17,277 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:09:17,355 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-21 16:09:20,096 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 16:09:20,462 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 16:09:20,467 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=00b2f90e99bd, end_of_utterance_delay=0.91, transcription_delay=0.54
2025-03-21 16:09:21,366 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=00b2f90e99bd, ttft=0.71, input_tokens=266, output_tokens=13, tokens_per_second=14.54
2025-03-21 16:09:22,355 - livekit.agents - INFO - Pipeline STT metrics: duration=9.99, audio_duration=5.00
2025-03-21 16:09:22,415 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:09:22,654 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=00b2f90e99bd, ttfb=1.0381869000848383, audio_duration=3.36
2025-03-21 16:09:24,024 - portuguese-restaurant-assistant - INFO - User speech committed: ora bem, quero 1 frango por favor.
2025-03-21 16:09:24,027 - portuguese-restaurant-assistant - INFO - Added user message to transcript: ora bem, quero 1 frango por favor.
2025-03-21 16:09:24,031 - portuguese-restaurant-assistant - INFO - Sending acknowledgment 'Compreendo.' for content: 'ora bem, quero 1 frango por fa...'
2025-03-21 16:09:25,787 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:09:25,790 - portuguese-restaurant-assistant - INFO - Agent speech committed: Muito bem, deseja mais algum acompanhamento com o frango?
2025-03-21 16:09:25,792 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Muito bem, deseja mais algum acompanhamento com o frango?
2025-03-21 16:09:25,796 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:09:25,886 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:09:25,892 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=0dc451eb62ad, ttfb=1.8451916000340134, audio_duration=0.64
2025-03-21 16:09:26,495 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:09:26,499 - portuguese-restaurant-assistant - INFO - Agent speech committed: Compreendo.
2025-03-21 16:09:26,501 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Compreendo.
2025-03-21 16:09:26,503 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:09:27,352 - livekit.agents - INFO - Pipeline STT metrics: duration=14.99, audio_duration=5.00
2025-03-21 16:09:54,240 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 16:09:54,242 - livekit.agents - DEBUG - shutting down job task
2025-03-21 16:09:54,242 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-21 16:09:54,246 - livekit.agents - DEBUG - job exiting
2025-03-21 16:09:54,249 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-21 16:09:54,250 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=266, llm_completion_tokens=13, tts_characters_count=122, stt_audio_duration=14.999999999999972)
2025-03-21 16:09:54,253 - portuguese-restaurant-assistant - INFO - Final verbosity level: concise
2025-03-21 16:09:54,254 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-21 16:09:54,256 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-21 16:09:54,263 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-21 16:09:54,621 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-21 16:09:54,625 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-21 16:09:54,629 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-21 16:09:54,632 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 16:11:06,319 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:11:06,347 - livekit.agents - INFO - starting worker
2025-03-21 16:11:06,351 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-21 16:11:06,714 - livekit.agents - INFO - registered worker
2025-03-21 16:12:01,733 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:12:01,751 - livekit.agents - INFO - starting worker
2025-03-21 16:12:02,142 - livekit.agents - INFO - registered worker
2025-03-21 16:12:03,542 - livekit.agents - INFO - shutting down worker
2025-03-21 16:12:11,450 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:12:11,454 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 16:12:14,117 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:12:14,127 - livekit.agents - INFO - starting worker
2025-03-21 16:12:14,483 - livekit.agents - INFO - registered worker
2025-03-21 16:12:19,367 - livekit.agents - INFO - received job request
2025-03-21 16:12:19,442 - livekit.agents - INFO - initializing job runner
2025-03-21 16:12:19,451 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 16:12:19,933 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 16:12:19,939 - livekit.agents - INFO - job runner initialized
2025-03-21 16:12:19,940 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:12:19,940 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_4ZHLx76cvNTw
2025-03-21 16:12:19,943 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: concise
2025-03-21 16:12:19,943 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-21 16:12:19,944 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-21 16:12:19,946 - portuguese-restaurant-assistant - INFO - Initialized acknowledgment tracker to prevent duplicate responses
2025-03-21 16:12:19,946 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 16:12:19,947 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 16:12:19,971 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 16:12:19,972 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 16:12:20,019 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 16:12:20,116 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 16:12:20,119 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 16:12:20,121 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 16:12:20,124 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 16:12:20,215 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 16:12:20,217 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 16:12:20,219 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 16:12:20,222 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 16:12:20,414 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 16:12:20,840 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 16:12:20,844 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-21 16:12:20,847 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 16:12:20,850 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-21 16:12:21,936 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-21 16:12:23,027 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 16:12:23,884 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:12:24,303 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=de4b30103d14, ttfb=1.8683447999646887, audio_duration=3.29
2025-03-21 16:12:27,143 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:12:27,148 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 16:12:27,152 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 16:12:27,159 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-21 16:12:27,171 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:12:28,024 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-21 16:12:33,073 - livekit.agents - INFO - Pipeline STT metrics: duration=10.04, audio_duration=5.05
2025-03-21 16:12:35,291 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 16:12:35,294 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=4da7698d300d, end_of_utterance_delay=5.55, transcription_delay=0.00
2025-03-21 16:12:36,186 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=4da7698d300d, ttft=0.67, input_tokens=258, output_tokens=15, tokens_per_second=16.94
2025-03-21 16:12:37,728 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:12:38,073 - livekit.agents - INFO - Pipeline STT metrics: duration=15.04, audio_duration=5.00
2025-03-21 16:12:38,183 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=4da7698d300d, ttfb=1.5359776000259444, audio_duration=3.86
2025-03-21 16:12:41,594 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:12:41,597 - portuguese-restaurant-assistant - INFO - Agent speech committed: Com certeza! Em que posso ajudar com o seu pedido takeaway hoje?
2025-03-21 16:12:41,599 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Com certeza! Em que posso ajudar com o seu pedido takeaway hoje?
2025-03-21 16:12:41,601 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:12:43,072 - livekit.agents - INFO - Pipeline STT metrics: duration=20.04, audio_duration=5.00
2025-03-21 16:12:45,892 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 16:12:46,261 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 16:12:46,263 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=8a3f282e7eb0, end_of_utterance_delay=0.90, transcription_delay=0.53
2025-03-21 16:12:47,002 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=8a3f282e7eb0, ttft=0.50, input_tokens=285, output_tokens=14, tokens_per_second=19.07
2025-03-21 16:12:48,071 - livekit.agents - INFO - Pipeline STT metrics: duration=25.04, audio_duration=5.00
2025-03-21 16:12:48,230 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:12:48,397 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=8a3f282e7eb0, ttfb=1.2179362999740988, audio_duration=3.86
2025-03-21 16:12:49,870 - portuguese-restaurant-assistant - INFO - User speech committed: quero 1 frango de 1 batata.
2025-03-21 16:12:49,873 - portuguese-restaurant-assistant - INFO - Added user message to transcript: quero 1 frango de 1 batata.
2025-03-21 16:12:49,876 - livekit - ERROR - failed to emit event user_speech_committed
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 58, in emit
    callback(*callback_args)
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 945, in on_user_speech_committed
    process_response(msg, content, assistant)
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 951, in process_response
    if content and acknowledgment_tracker.should_acknowledge(content):
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 634, in should_acknowledge
    if current_time < acknowledgment_blocked_until:
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'acknowledgment_blocked_until' is not defined
2025-03-21 16:12:52,078 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:12:52,082 - portuguese-restaurant-assistant - INFO - Agent speech committed: Perfeito! Mais alguma coisa que gostaria de adicionar ao pedido?
2025-03-21 16:12:52,084 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Perfeito! Mais alguma coisa que gostaria de adicionar ao pedido?
2025-03-21 16:12:52,089 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:12:53,071 - livekit.agents - INFO - Pipeline STT metrics: duration=30.04, audio_duration=5.00
2025-03-21 16:12:55,084 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 16:12:55,450 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 16:12:55,453 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=f76f9dfe46ed, end_of_utterance_delay=0.79, transcription_delay=0.42
2025-03-21 16:12:56,705 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=f76f9dfe46ed, ttft=0.59, input_tokens=311, output_tokens=24, tokens_per_second=19.26
2025-03-21 16:12:57,732 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:12:58,076 - livekit.agents - INFO - Pipeline STT metrics: duration=35.04, audio_duration=5.00
2025-03-21 16:12:58,134 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=f76f9dfe46ed, ttfb=1.2027728999964893, audio_duration=3.21
2025-03-21 16:12:59,282 - portuguese-restaurant-assistant - INFO - User speech committed: não é tudo obrigado.
2025-03-21 16:12:59,285 - portuguese-restaurant-assistant - INFO - Added user message to transcript: não é tudo obrigado.
2025-03-21 16:12:59,287 - livekit - ERROR - failed to emit event user_speech_committed
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 58, in emit
    callback(*callback_args)
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 945, in on_user_speech_committed
    process_response(msg, content, assistant)
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 951, in process_response
    if content and acknowledgment_tracker.should_acknowledge(content):
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 634, in should_acknowledge
    if current_time < acknowledgment_blocked_until:
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'acknowledgment_blocked_until' is not defined
2025-03-21 16:12:59,577 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=f76f9dfe46ed, ttfb=1.2963216999778524, audio_duration=2.26
2025-03-21 16:13:03,073 - livekit.agents - INFO - Pipeline STT metrics: duration=40.04, audio_duration=5.00
2025-03-21 16:13:03,181 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:13:03,186 - portuguese-restaurant-assistant - INFO - Agent speech committed: Muito bem. A que horas deseja levantar o seu pedido? E posso ficar com o seu nome, por favor?
2025-03-21 16:13:03,191 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Muito bem. A que horas deseja levantar o seu pedido? E posso ficar com o seu nome, por favor?
2025-03-21 16:13:03,196 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:13:08,073 - livekit.agents - INFO - Pipeline STT metrics: duration=45.04, audio_duration=5.00
2025-03-21 16:13:08,304 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 16:13:08,665 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 16:13:08,669 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=8f6912f1c8bd, end_of_utterance_delay=0.81, transcription_delay=0.45
2025-03-21 16:13:10,253 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=8f6912f1c8bd, ttft=1.07, input_tokens=355, output_tokens=21, tokens_per_second=13.30
2025-03-21 16:13:11,989 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:13:12,262 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=8f6912f1c8bd, ttfb=1.7274066000245512, audio_duration=4.91
2025-03-21 16:13:13,073 - livekit.agents - INFO - Pipeline STT metrics: duration=50.04, audio_duration=5.00
2025-03-21 16:13:13,640 - portuguese-restaurant-assistant - INFO - User speech committed: o pedido pode ser após se inclatar em nome do número.
2025-03-21 16:13:13,642 - portuguese-restaurant-assistant - INFO - Added user message to transcript: o pedido pode ser após se inclatar em nome do número.
2025-03-21 16:13:13,645 - livekit - ERROR - failed to emit event user_speech_committed
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 58, in emit
    callback(*callback_args)
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 945, in on_user_speech_committed
    process_response(msg, content, assistant)
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 951, in process_response
    if content and acknowledgment_tracker.should_acknowledge(content):
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 634, in should_acknowledge
    if current_time < acknowledgment_blocked_until:
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'acknowledgment_blocked_until' is not defined
2025-03-21 16:13:16,896 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:13:16,899 - portuguese-restaurant-assistant - INFO - Agent speech committed: Peço desculpa, poderia clarificar a hora de levantamento e o seu nome, por favor?
2025-03-21 16:13:16,904 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Peço desculpa, poderia clarificar a hora de levantamento e o seu nome, por favor?
2025-03-21 16:13:16,908 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:13:18,071 - livekit.agents - INFO - Pipeline STT metrics: duration=55.04, audio_duration=5.00
2025-03-21 16:13:20,925 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 16:13:21,291 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 16:13:21,293 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=b80fcd3ba5f0, end_of_utterance_delay=0.76, transcription_delay=0.40
2025-03-21 16:13:22,319 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=b80fcd3ba5f0, ttft=0.60, input_tokens=394, output_tokens=23, tokens_per_second=22.55
2025-03-21 16:13:23,070 - livekit.agents - INFO - Pipeline STT metrics: duration=60.04, audio_duration=5.00
2025-03-21 16:13:23,680 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:13:23,718 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=b80fcd3ba5f0, ttfb=1.622027499950491, audio_duration=1.28
2025-03-21 16:13:24,982 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=b80fcd3ba5f0, ttfb=0.9923684999812394, audio_duration=3.84
2025-03-21 16:13:25,305 - portuguese-restaurant-assistant - INFO - User speech committed: a 5 da tarde em nome de nono.
2025-03-21 16:13:25,308 - portuguese-restaurant-assistant - INFO - Added user message to transcript: a 5 da tarde em nome de nono.
2025-03-21 16:13:25,310 - livekit - ERROR - failed to emit event user_speech_committed
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\rtc\event_emitter.py", line 58, in emit
    callback(*callback_args)
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 945, in on_user_speech_committed
    process_response(msg, content, assistant)
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 951, in process_response
    if content and acknowledgment_tracker.should_acknowledge(content):
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 634, in should_acknowledge
    if current_time < acknowledgment_blocked_until:
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'acknowledgment_blocked_until' is not defined
2025-03-21 16:13:26,481 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=b80fcd3ba5f0, ttfb=1.415328499977477, audio_duration=0.59
2025-03-21 16:13:28,072 - livekit.agents - INFO - Pipeline STT metrics: duration=65.04, audio_duration=5.00
2025-03-21 16:13:29,357 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:13:29,359 - portuguese-restaurant-assistant - INFO - Agent speech committed: Obrigado, senhor Nono. O seu pedido estará pronto para levantamento às 5 da tarde. Até breve!
2025-03-21 16:13:29,361 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Obrigado, senhor Nono. O seu pedido estará pronto para levantamento às 5 da tarde. Até breve!
2025-03-21 16:13:29,363 - portuguese-restaurant-assistant - INFO - Extracted pickup time: 05:00
2025-03-21 16:13:29,364 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:13:33,073 - livekit.agents - INFO - Pipeline STT metrics: duration=70.04, audio_duration=5.00
2025-03-21 16:13:54,237 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 16:13:54,238 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-21 16:13:54,240 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-21 16:13:54,243 - livekit.agents - DEBUG - shutting down job task
2025-03-21 16:13:54,246 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=1603, llm_completion_tokens=97, tts_characters_count=446, stt_audio_duration=70.04999999999987)
2025-03-21 16:13:54,246 - livekit.agents - DEBUG - job exiting
2025-03-21 16:13:54,247 - portuguese-restaurant-assistant - INFO - Final verbosity level: concise
2025-03-21 16:13:54,248 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-21 16:13:54,249 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-21 16:13:54,250 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-21 16:13:54,254 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-21 16:13:54,541 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-21 16:13:54,543 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-21 16:13:54,544 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-21 16:13:54,545 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-21 16:13:54,545 - portuguese-restaurant-assistant - INFO - Room disconnected, sending conversation transcript to Make.com
2025-03-21 16:13:54,546 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 16:14:49,938 - livekit.agents - INFO - shutting down worker
2025-03-21 16:18:44,274 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:18:44,274 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 16:18:46,503 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:18:46,519 - livekit.agents - INFO - starting worker
2025-03-21 16:18:46,846 - livekit.agents - INFO - registered worker
2025-03-21 16:18:57,733 - livekit.agents - INFO - received job request
2025-03-21 16:18:57,804 - livekit.agents - INFO - initializing job runner
2025-03-21 16:18:57,806 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 16:18:58,069 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 16:18:58,072 - livekit.agents - INFO - job runner initialized
2025-03-21 16:18:58,072 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:18:58,074 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-GFQHEv4HQRAG9q8jnSCu8d
2025-03-21 16:18:58,075 - portuguese-restaurant-assistant - INFO - Initialized adaptive content with verbosity level: concise
2025-03-21 16:18:58,075 - portuguese-restaurant-assistant - INFO - Initialized interaction tracker for adaptive content
2025-03-21 16:18:58,076 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-21 16:18:58,077 - portuguese-restaurant-assistant - INFO - Initialized acknowledgment tracker to prevent duplicate responses
2025-03-21 16:18:58,078 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 16:18:58,079 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 16:18:58,106 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 16:18:58,107 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 16:18:58,144 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 16:18:58,264 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 16:18:58,264 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 16:18:58,274 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 16:18:58,274 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 16:18:58,368 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 16:18:58,368 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 16:18:58,368 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 16:18:58,368 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 16:18:58,534 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 16:19:00,014 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 16:19:00,017 - portuguese-restaurant-assistant - INFO - Participant joined: ubiquitous-blockchain
2025-03-21 16:19:00,019 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 16:19:00,021 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-21 16:19:00,547 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: STT.__init__() got an unexpected keyword argument 'diarize'
2025-03-21 16:19:00,549 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 879, in entrypoint
    stt = deepgram.STT(
          ^^^^^^^^^^^^^
TypeError: STT.__init__() got an unexpected keyword argument 'diarize'

2025-03-21 16:19:05,207 - livekit.agents - INFO - shutting down worker
2025-03-21 16:19:05,209 - livekit.agents - DEBUG - shutting down job task
2025-03-21 16:19:05,213 - livekit.agents - DEBUG - job exiting
2025-03-21 16:19:05,278 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 16:19:05,281 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-21 16:19:05,282 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 16:19:05,282 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 16:26:13,093 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:26:13,098 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 16:26:15,653 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:26:15,671 - livekit.agents - INFO - starting worker
2025-03-21 16:26:16,016 - livekit.agents - INFO - registered worker
2025-03-21 16:26:17,174 - livekit.agents - INFO - received job request
2025-03-21 16:26:17,254 - livekit.agents - INFO - initializing job runner
2025-03-21 16:26:17,254 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 16:26:17,663 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 16:26:17,664 - livekit.agents - INFO - job runner initialized
2025-03-21 16:26:17,665 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:26:17,666 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-UxrzdugcbQ2Zpjtj2v4hWc
2025-03-21 16:26:17,667 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-21 16:26:17,668 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-21 16:26:17,668 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-21 16:26:17,669 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 16:26:17,670 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 16:26:17,688 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 16:26:17,689 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 16:26:17,725 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 16:26:17,808 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 16:26:17,809 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 16:26:17,812 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 16:26:17,812 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 16:26:17,897 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 16:26:17,897 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 16:26:17,898 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 16:26:17,899 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 16:26:18,059 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 16:26:18,408 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 16:26:18,410 - portuguese-restaurant-assistant - INFO - Participant joined: binary-packet
2025-03-21 16:26:18,411 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 16:26:18,412 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-21 16:26:18,938 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: STT.__init__() got an unexpected keyword argument 'diarize'
2025-03-21 16:26:18,940 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 687, in entrypoint
    stt = deepgram.STT(
          ^^^^^^^^^^^^^
TypeError: STT.__init__() got an unexpected keyword argument 'diarize'

2025-03-21 16:26:24,390 - livekit.agents - INFO - shutting down worker
2025-03-21 16:26:24,392 - livekit.agents - DEBUG - shutting down job task
2025-03-21 16:26:24,395 - livekit.agents - DEBUG - job exiting
2025-03-21 16:26:24,458 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 16:26:24,466 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 16:26:24,467 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 16:27:55,252 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:27:55,252 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 16:27:59,652 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:27:59,671 - livekit.agents - INFO - starting worker
2025-03-21 16:28:00,042 - livekit.agents - INFO - registered worker
2025-03-21 16:28:16,007 - livekit.agents - INFO - received job request
2025-03-21 16:28:16,074 - livekit.agents - INFO - initializing job runner
2025-03-21 16:28:16,074 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 16:28:16,423 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 16:28:16,424 - livekit.agents - INFO - job runner initialized
2025-03-21 16:28:16,428 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:28:16,431 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-Y3r7phJDsZDDA2YMXRsDEo
2025-03-21 16:28:16,432 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-21 16:28:16,433 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-21 16:28:16,433 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-21 16:28:16,434 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 16:28:16,435 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 16:28:16,457 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 16:28:16,459 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 16:28:16,499 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 16:28:16,581 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 16:28:16,582 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 16:28:16,583 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 16:28:16,584 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 16:28:16,671 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 16:28:16,672 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 16:28:16,673 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 16:28:16,675 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 16:28:16,851 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 16:28:17,225 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 16:28:17,228 - portuguese-restaurant-assistant - INFO - Participant joined: hyper-bot
2025-03-21 16:28:17,228 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 16:28:17,229 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-21 16:28:18,124 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: STT.__init__() got an unexpected keyword argument 'tier'
2025-03-21 16:28:18,127 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 687, in entrypoint
    stt = deepgram.STT(
          ^^^^^^^^^^^^^
TypeError: STT.__init__() got an unexpected keyword argument 'tier'

2025-03-21 16:28:30,325 - livekit.agents - INFO - shutting down worker
2025-03-21 16:28:30,326 - livekit.agents - DEBUG - shutting down job task
2025-03-21 16:28:30,328 - livekit.agents - DEBUG - job exiting
2025-03-21 16:28:30,388 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 16:28:30,393 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 16:28:30,394 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 16:29:19,395 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:29:19,411 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 16:29:21,907 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:29:21,907 - livekit.agents - INFO - starting worker
2025-03-21 16:29:22,238 - livekit.agents - INFO - registered worker
2025-03-21 16:29:29,153 - livekit.agents - INFO - received job request
2025-03-21 16:29:29,244 - livekit.agents - INFO - initializing job runner
2025-03-21 16:29:29,246 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 16:29:29,478 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 16:29:29,480 - livekit.agents - INFO - job runner initialized
2025-03-21 16:29:29,481 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:29:29,483 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-8zLMYs7BQsJ8fawdP9b48a
2025-03-21 16:29:29,483 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-21 16:29:29,483 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-21 16:29:29,487 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-21 16:29:29,487 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 16:29:29,488 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 16:29:29,491 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 16:29:29,492 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 16:29:29,496 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 16:29:29,584 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 16:29:29,584 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 16:29:29,588 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 16:29:29,588 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 16:29:29,666 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 16:29:29,667 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 16:29:29,667 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 16:29:29,668 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 16:29:29,828 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 16:29:31,212 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 16:29:31,212 - portuguese-restaurant-assistant - INFO - Participant joined: self-healing-bit
2025-03-21 16:29:31,218 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 16:29:31,218 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-21 16:29:32,122 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-21 16:29:32,128 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 16:29:32,128 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 144, in _stt_stream_co
    async for ev in stt_stream:
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 321, in __anext__
    raise exc from None
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 219, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py", line 529, in _run
    ws = await self._connect_ws()
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py", line 586, in _connect_ws
    _to_deepgram_url(live_config, base_url=self._base_url, websocket=True),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py", line 726, in _to_deepgram_url
    f"{keyword}:{intensifier}" for (keyword, intensifier) in opts["keywords"]
                                   ^^^^^^^^^^^^^^^^^^^^^^
ValueError: too many values to unpack (expected 2)
2025-03-21 16:29:38,989 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:29:39,624 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=9b120f5b468b, ttfb=6.720181299955584, audio_duration=3.28
2025-03-21 16:29:42,247 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:29:42,251 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 16:29:42,254 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 16:29:42,258 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-21 16:29:42,267 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:29:43,612 - livekit.agents - INFO - shutting down worker
2025-03-21 16:29:43,616 - livekit.agents - DEBUG - shutting down job task
2025-03-21 16:29:43,623 - livekit.agents - DEBUG - job exiting
2025-03-21 16:29:43,684 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 16:29:43,688 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-21 16:29:43,690 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=54, stt_audio_duration=0.0)
2025-03-21 16:29:43,691 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-21 16:29:43,692 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-21 16:29:43,696 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-21 16:29:44,032 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-21 16:29:44,035 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-21 16:29:44,036 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-21 16:29:44,038 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 16:29:44,094 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:944> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-21 16:29:44,097 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-31' coro=<HumanInput._recognize_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> exception=ValueError('too many values to unpack (expected 2)')>
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 144, in _stt_stream_co
    async for ev in stt_stream:
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 321, in __anext__
    raise exc from None
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 219, in _main_task
    return await self._run()
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py", line 529, in _run
    ws = await self._connect_ws()
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py", line 586, in _connect_ws
    _to_deepgram_url(live_config, base_url=self._base_url, websocket=True),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py", line 726, in _to_deepgram_url
    f"{keyword}:{intensifier}" for (keyword, intensifier) in opts["keywords"]
                                   ^^^^^^^^^^^^^^^^^^^^^^
ValueError: too many values to unpack (expected 2)
2025-03-21 16:29:44,105 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:31:12,968 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:31:12,978 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-21 16:31:15,472 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:31:15,485 - livekit.agents - INFO - starting worker
2025-03-21 16:31:15,828 - livekit.agents - INFO - registered worker
2025-03-21 16:31:33,900 - livekit.agents - INFO - received job request
2025-03-21 16:31:33,972 - livekit.agents - INFO - initializing job runner
2025-03-21 16:31:33,975 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-21 16:31:34,328 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-21 16:31:34,329 - livekit.agents - INFO - job runner initialized
2025-03-21 16:31:34,331 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-21 16:31:34,332 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-k8wnuZgf2kXKjGtGj7cZkZ
2025-03-21 16:31:34,333 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-21 16:31:34,333 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-21 16:31:34,334 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-21 16:31:34,335 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-21 16:31:34,337 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-21 16:31:34,356 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-21 16:31:34,357 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-21 16:31:34,395 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-21 16:31:34,488 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-21 16:31:34,490 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-21 16:31:34,491 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-21 16:31:34,493 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-21 16:31:34,581 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-21 16:31:34,583 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-21 16:31:34,584 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-21 16:31:34,586 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-21 16:31:34,745 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-21 16:31:36,126 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-21 16:31:36,128 - portuguese-restaurant-assistant - INFO - Participant joined: self-healing-matrix
2025-03-21 16:31:36,129 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-21 16:31:36,130 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-21 16:31:37,025 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-21 16:31:37,029 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-21 16:31:38,737 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:31:38,872 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=dbdfb9fe2caf, ttfb=1.5870154000585899, audio_duration=3.29
2025-03-21 16:31:42,000 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:31:42,003 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 16:31:42,006 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-21 16:31:42,009 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-21 16:31:42,013 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:31:42,030 - livekit.agents - INFO - Pipeline STT metrics: duration=5.00, audio_duration=5.00
2025-03-21 16:31:44,200 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-21 16:31:44,529 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-21 16:31:44,530 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c55f08b8ace2, end_of_utterance_delay=0.90, transcription_delay=0.57
2025-03-21 16:31:45,496 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c55f08b8ace2, ttft=0.81, input_tokens=258, output_tokens=10, tokens_per_second=10.38
2025-03-21 16:31:46,618 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-21 16:31:46,657 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c55f08b8ace2, ttfb=1.1196975000202656, audio_duration=2.15
2025-03-21 16:31:47,028 - livekit.agents - INFO - Pipeline STT metrics: duration=10.00, audio_duration=5.00
2025-03-21 16:31:48,288 - portuguese-restaurant-assistant - INFO - User speech committed: boa tarde.
2025-03-21 16:31:48,289 - portuguese-restaurant-assistant - INFO - Added user message to transcript: boa tarde.
2025-03-21 16:31:48,754 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-21 16:31:48,756 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Como posso ser útil hoje?
2025-03-21 16:31:48,757 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Como posso ser útil hoje?
2025-03-21 16:31:48,758 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-21 16:31:50,275 - livekit.agents - INFO - shutting down worker
2025-03-21 16:31:50,277 - livekit.agents - DEBUG - shutting down job task
2025-03-21 16:31:50,278 - livekit.agents - DEBUG - job exiting
2025-03-21 16:31:50,339 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-21 16:31:50,347 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-21 16:31:50,348 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-21 16:31:50,349 - portuguese-restaurant-assistant - INFO - Room disconnected, sending conversation transcript to Make.com
2025-03-21 16:31:50,349 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=258, llm_completion_tokens=10, tts_characters_count=90, stt_audio_duration=9.99999999999998)
2025-03-21 16:31:50,350 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-21 16:31:50,351 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-21 16:31:50,356 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-21 16:31:50,634 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-21 16:31:50,635 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-21 16:31:50,638 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-21 16:31:50,639 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-21 16:31:50,693 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-35' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-21 16:31:50,709 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:939> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-21 16:31:50,712 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-31' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-21 16:31:50,714 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:31:50,716 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:31:50,718 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-21 16:31:50,728 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-39' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 16:31:50,730 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-38' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 16:31:50,732 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-36' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:31:50,734 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:31:50,735 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-33' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-21 16:31:50,737 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-21 16:31:50,744 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-94' coro=<entrypoint.<locals>.send_transcript_on_disconnect() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:847> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:31:50,746 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-21 16:31:50,748 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 16:31:50,750 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future finished result=None> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-21 16:31:50,752 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:28:16,866 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:28:16,878 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-25 17:28:21,250 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:28:21,262 - livekit.agents - INFO - starting worker
2025-03-25 17:28:21,611 - livekit.agents - INFO - registered worker
2025-03-25 17:28:31,063 - livekit.agents - INFO - received job request
2025-03-25 17:28:31,162 - livekit.agents - INFO - initializing job runner
2025-03-25 17:28:31,164 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-25 17:28:31,446 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-25 17:28:31,447 - livekit.agents - INFO - job runner initialized
2025-03-25 17:28:31,448 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:28:31,451 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_evScZnBFZbuM
2025-03-25 17:28:31,451 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:28:31,452 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:28:31,453 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-25 17:28:31,453 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-25 17:28:31,454 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-25 17:28:31,476 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-25 17:28:31,477 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-25 17:28:31,516 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-25 17:28:31,618 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-25 17:28:31,620 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-25 17:28:31,622 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-25 17:28:31,625 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-25 17:28:31,711 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-25 17:28:31,712 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-25 17:28:31,713 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-25 17:28:31,713 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-25 17:28:31,924 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-25 17:28:33,373 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-25 17:28:33,379 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-25 17:28:33,381 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-25 17:28:33,384 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-25 17:28:34,632 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-25 17:28:35,792 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-25 17:28:35,801 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 128, in _audio_stream_co
    stt_stream.push_frame(ev.frame)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 271, in push_frame
    self._check_not_closed()
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 333, in _check_not_closed
    raise RuntimeError(f"{cls.__module__}.{cls.__name__} is closed")
RuntimeError: livekit.plugins.deepgram.stt.SpeechStream is closed
2025-03-25 17:28:36,820 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:28:37,003 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=af99296b67d7, ttfb=2.1081343999831006, audio_duration=3.25
2025-03-25 17:28:40,055 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:28:40,059 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-25 17:28:40,063 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-25 17:28:40,070 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-25 17:28:40,078 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:29:13,677 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-25 17:29:13,679 - livekit.agents - DEBUG - shutting down job task
2025-03-25 17:29:13,682 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-25 17:29:13,692 - livekit.agents - DEBUG - job exiting
2025-03-25 17:29:13,701 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=54, stt_audio_duration=0.0)
2025-03-25 17:29:13,703 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-25 17:29:13,706 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-25 17:29:13,710 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-25 17:29:13,721 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-25 17:29:14,069 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-25 17:29:14,072 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-25 17:29:14,077 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-25 17:29:14,080 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-25 17:29:52,103 - livekit.agents - INFO - shutting down worker
2025-03-25 17:29:52,172 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:944> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-25 17:29:52,175 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:29:52,178 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-47' coro=<HumanInput._recognize_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> exception=RuntimeError('livekit.plugins.deepgram.stt.SpeechStream is closed')>
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 128, in _audio_stream_co
    stt_stream.push_frame(ev.frame)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 271, in push_frame
    self._check_not_closed()
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 333, in _check_not_closed
    raise RuntimeError(f"{cls.__module__}.{cls.__name__} is closed")
RuntimeError: livekit.plugins.deepgram.stt.SpeechStream is closed
2025-03-25 17:30:43,063 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:30:43,069 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-25 17:30:46,395 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:30:46,409 - livekit.agents - INFO - starting worker
2025-03-25 17:30:46,757 - livekit.agents - INFO - registered worker
2025-03-25 17:30:51,037 - livekit.agents - INFO - received job request
2025-03-25 17:30:51,111 - livekit.agents - INFO - initializing job runner
2025-03-25 17:30:51,113 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-25 17:30:51,666 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-25 17:30:51,667 - livekit.agents - INFO - job runner initialized
2025-03-25 17:30:51,669 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:30:51,673 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-g4zgBgzyeaKcVoaenvu3LH
2025-03-25 17:30:51,674 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:30:51,676 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:30:51,676 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-25 17:30:51,677 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-25 17:30:51,678 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-25 17:30:51,700 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-25 17:30:51,703 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-25 17:30:51,753 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-25 17:30:51,848 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-25 17:30:51,851 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-25 17:30:51,853 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-25 17:30:51,854 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-25 17:30:51,945 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-25 17:30:51,947 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-25 17:30:51,948 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-25 17:30:51,950 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-25 17:30:52,129 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-25 17:30:52,569 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-25 17:30:52,587 - portuguese-restaurant-assistant - INFO - Participant joined: efficient-grid
2025-03-25 17:30:52,588 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-25 17:30:52,590 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-25 17:30:54,279 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-25 17:30:54,756 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-25 17:30:54,770 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 128, in _audio_stream_co
    stt_stream.push_frame(ev.frame)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 271, in push_frame
    self._check_not_closed()
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 333, in _check_not_closed
    raise RuntimeError(f"{cls.__module__}.{cls.__name__} is closed")
RuntimeError: livekit.plugins.deepgram.stt.SpeechStream is closed
2025-03-25 17:30:56,397 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:30:56,460 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=daa141ba1bcb, ttfb=2.0070744999684393, audio_duration=3.20
2025-03-25 17:30:59,578 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:30:59,579 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-25 17:30:59,580 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-25 17:30:59,581 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-25 17:30:59,584 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:31:12,615 - livekit.agents - INFO - shutting down worker
2025-03-25 17:31:12,618 - livekit.agents - DEBUG - shutting down job task
2025-03-25 17:31:12,620 - livekit.agents - DEBUG - job exiting
2025-03-25 17:31:12,694 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-25 17:31:12,705 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-25 17:31:12,705 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-25 17:31:12,706 - portuguese-restaurant-assistant - INFO - Room disconnected, sending conversation transcript to Make.com
2025-03-25 17:31:12,708 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=54, stt_audio_duration=0.0)
2025-03-25 17:31:12,709 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-25 17:31:12,709 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-25 17:31:12,714 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-25 17:31:13,066 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-25 17:31:13,067 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-25 17:31:13,069 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-25 17:31:13,070 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-25 17:31:13,149 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:944> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-25 17:31:13,153 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:31:13,156 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-43' coro=<HumanInput._recognize_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> exception=RuntimeError('livekit.plugins.deepgram.stt.SpeechStream is closed')>
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 128, in _audio_stream_co
    stt_stream.push_frame(ev.frame)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 271, in push_frame
    self._check_not_closed()
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 333, in _check_not_closed
    raise RuntimeError(f"{cls.__module__}.{cls.__name__} is closed")
RuntimeError: livekit.plugins.deepgram.stt.SpeechStream is closed
2025-03-25 17:31:13,163 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-62' coro=<entrypoint.<locals>.send_transcript_on_disconnect() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:855> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:33:07,426 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:33:07,433 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-25 17:33:11,381 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:33:11,396 - livekit.agents - INFO - starting worker
2025-03-25 17:33:11,723 - livekit.agents - INFO - registered worker
2025-03-25 17:33:17,020 - livekit.agents - INFO - received job request
2025-03-25 17:33:17,084 - livekit.agents - INFO - initializing job runner
2025-03-25 17:33:17,087 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-25 17:33:17,522 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-25 17:33:17,524 - livekit.agents - INFO - job runner initialized
2025-03-25 17:33:17,527 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:33:17,532 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_U4nVBRSK2BXx
2025-03-25 17:33:17,534 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:33:17,535 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:33:17,537 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-25 17:33:17,538 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-25 17:33:17,541 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-25 17:33:17,568 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-25 17:33:17,570 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-25 17:33:17,621 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-25 17:33:17,703 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-25 17:33:17,705 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-25 17:33:17,707 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-25 17:33:17,708 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-25 17:33:17,795 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-25 17:33:17,800 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-25 17:33:17,802 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-25 17:33:17,806 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-25 17:33:17,972 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-25 17:33:19,408 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-25 17:33:19,409 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-25 17:33:19,410 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-25 17:33:19,412 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-25 17:33:20,642 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-25 17:33:21,719 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-25 17:33:21,726 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 128, in _audio_stream_co
    stt_stream.push_frame(ev.frame)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 271, in push_frame
    self._check_not_closed()
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 333, in _check_not_closed
    raise RuntimeError(f"{cls.__module__}.{cls.__name__} is closed")
RuntimeError: livekit.plugins.deepgram.stt.SpeechStream is closed
2025-03-25 17:33:22,230 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:33:22,425 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=a2716c421a9f, ttfb=1.5076238999608904, audio_duration=3.30
2025-03-25 17:33:25,528 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:33:25,529 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-25 17:33:25,530 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-25 17:33:25,533 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-25 17:33:25,534 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:33:54,305 - livekit.agents - INFO - shutting down worker
2025-03-25 17:33:54,308 - livekit.agents - DEBUG - shutting down job task
2025-03-25 17:33:54,310 - livekit.agents - DEBUG - job exiting
2025-03-25 17:33:54,374 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-25 17:33:54,382 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-25 17:33:54,385 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=54, stt_audio_duration=0.0)
2025-03-25 17:33:54,395 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-25 17:33:54,396 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-25 17:33:54,402 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-25 17:33:54,761 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-25 17:33:54,765 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-25 17:33:54,770 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-25 17:33:54,772 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-25 17:33:54,881 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:944> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-25 17:33:54,886 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:33:54,887 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-47' coro=<HumanInput._recognize_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> exception=RuntimeError('livekit.plugins.deepgram.stt.SpeechStream is closed')>
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 128, in _audio_stream_co
    stt_stream.push_frame(ev.frame)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 271, in push_frame
    self._check_not_closed()
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py", line 333, in _check_not_closed
    raise RuntimeError(f"{cls.__module__}.{cls.__name__} is closed")
RuntimeError: livekit.plugins.deepgram.stt.SpeechStream is closed
2025-03-25 17:40:59,295 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:40:59,307 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-25 17:41:03,402 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:41:03,413 - livekit.agents - INFO - starting worker
2025-03-25 17:41:03,750 - livekit.agents - INFO - registered worker
2025-03-25 17:41:05,954 - livekit.agents - INFO - received job request
2025-03-25 17:41:06,020 - livekit.agents - INFO - initializing job runner
2025-03-25 17:41:06,022 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-25 17:41:06,347 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-25 17:41:06,348 - livekit.agents - INFO - job runner initialized
2025-03-25 17:41:06,349 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:41:06,351 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_AWqHCSeyZEeb
2025-03-25 17:41:06,351 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:41:06,352 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:41:06,353 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-25 17:41:06,354 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-25 17:41:06,355 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-25 17:41:06,378 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-25 17:41:06,379 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-25 17:41:06,434 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-25 17:41:06,519 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-25 17:41:06,521 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-25 17:41:06,522 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-25 17:41:06,525 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-25 17:41:06,621 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-25 17:41:06,623 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-25 17:41:06,624 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-25 17:41:06,627 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-25 17:41:06,814 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-25 17:41:07,184 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-25 17:41:07,190 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-25 17:41:07,193 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-25 17:41:07,195 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-25 17:41:08,454 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-25 17:41:09,560 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-25 17:41:14,606 - livekit.agents - INFO - Pipeline STT metrics: duration=5.04, audio_duration=5.05
2025-03-25 17:41:14,776 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-25 17:41:14,778 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:41:15,531 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=9812119d1381, ttfb=6.561783500015736, audio_duration=3.18
2025-03-25 17:41:19,608 - livekit.agents - INFO - Pipeline STT metrics: duration=10.04, audio_duration=5.00
2025-03-25 17:41:20,458 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-25 17:41:20,462 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=90bf0cc85fa1, end_of_utterance_delay=5.53, transcription_delay=0.00
2025-03-25 17:41:21,785 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=90bf0cc85fa1, ttft=0.75, input_tokens=243, output_tokens=22, tokens_per_second=16.70
2025-03-25 17:41:22,798 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:41:23,407 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=90bf0cc85fa1, ttfb=1.232821200042963, audio_duration=2.86
2025-03-25 17:41:24,606 - livekit.agents - INFO - Pipeline STT metrics: duration=15.04, audio_duration=5.00
2025-03-25 17:41:24,839 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=90bf0cc85fa1, ttfb=1.2989044000860304, audio_duration=2.81
2025-03-25 17:41:28,486 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:41:28,489 - portuguese-restaurant-assistant - INFO - Agent speech committed: Lamento, parece que a mensagem ficou incompleta. Como posso ajudá-lo com o seu pedido takeaway?
2025-03-25 17:41:28,495 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Lamento, parece que a mensagem ficou incompleta. Como posso ajudá-lo com o seu pedido takeaway?
2025-03-25 17:41:28,501 - portuguese-restaurant-assistant - INFO - Extracted customer name: parece que
2025-03-25 17:41:28,509 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:41:29,605 - livekit.agents - INFO - Pipeline STT metrics: duration=20.03, audio_duration=5.00
2025-03-25 17:41:31,464 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-25 17:41:31,774 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-25 17:41:31,775 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=e7b99bf89b5b, end_of_utterance_delay=0.90, transcription_delay=0.59
2025-03-25 17:41:32,738 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=e7b99bf89b5b, ttft=0.64, input_tokens=270, output_tokens=15, tokens_per_second=15.62
2025-03-25 17:41:34,606 - livekit.agents - INFO - Pipeline STT metrics: duration=25.04, audio_duration=5.00
2025-03-25 17:41:34,646 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:41:34,866 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=e7b99bf89b5b, ttfb=1.9040324999950826, audio_duration=3.65
2025-03-25 17:41:36,286 - portuguese-restaurant-assistant - INFO - User speech committed: olá, boa tarde.
2025-03-25 17:41:36,287 - portuguese-restaurant-assistant - INFO - Added user message to transcript: olá, boa tarde.
2025-03-25 17:41:38,296 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:41:38,300 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Em que posso ajudá-lo com o seu pedido takeaway?
2025-03-25 17:41:38,304 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Em que posso ajudá-lo com o seu pedido takeaway?
2025-03-25 17:41:38,308 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:41:39,608 - livekit.agents - INFO - Pipeline STT metrics: duration=30.04, audio_duration=5.00
2025-03-25 17:41:40,867 - livekit.agents - INFO - shutting down worker
2025-03-25 17:41:40,869 - livekit.agents - DEBUG - shutting down job task
2025-03-25 17:41:40,871 - livekit.agents - DEBUG - job exiting
2025-03-25 17:41:40,930 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-25 17:41:40,935 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=513, llm_completion_tokens=37, tts_characters_count=207, stt_audio_duration=30.049999999999937)
2025-03-25 17:41:40,937 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-25 17:41:40,938 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-25 17:41:40,943 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-25 17:41:41,275 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-25 17:41:41,280 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-25 17:41:41,314 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-25 17:41:41,317 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-25 17:41:41,492 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:936> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-25 17:41:41,502 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:41:41,510 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-25 17:41:41,516 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-25 17:41:41,540 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:41:41,543 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:41:41,549 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-52' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:41:41,552 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:41:41,556 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:41:41,559 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-25 17:41:41,736 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-51' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-25 17:41:41,740 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-49' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-25 17:41:41,745 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-60' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-25 17:41:41,749 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:41:41,753 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:41:41,772 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-59' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:41:48,721 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:41:48,728 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-25 17:41:52,440 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:41:52,456 - livekit.agents - INFO - starting worker
2025-03-25 17:41:52,775 - livekit.agents - INFO - registered worker
2025-03-25 17:41:52,881 - livekit.agents - INFO - received job request
2025-03-25 17:41:52,948 - livekit.agents - INFO - initializing job runner
2025-03-25 17:41:52,949 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-25 17:41:53,188 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-25 17:41:53,189 - livekit.agents - INFO - job runner initialized
2025-03-25 17:41:53,190 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:41:53,192 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_UyAyvNa8c5AN
2025-03-25 17:41:53,193 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:41:53,194 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:41:53,195 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-25 17:41:53,195 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-25 17:41:53,197 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-25 17:41:53,200 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-25 17:41:53,201 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-25 17:41:53,206 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-25 17:41:53,298 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-25 17:41:53,300 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-25 17:41:53,302 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-25 17:41:53,303 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-25 17:41:53,387 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-25 17:41:53,389 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-25 17:41:53,391 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-25 17:41:53,392 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-25 17:41:53,602 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-25 17:41:55,029 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-25 17:41:55,034 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-25 17:41:55,037 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-25 17:41:55,041 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-25 17:41:56,715 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-25 17:41:57,762 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-25 17:42:00,955 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:42:01,175 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=cf6843068100, ttfb=4.15902289992664, audio_duration=3.25
2025-03-25 17:42:02,758 - livekit.agents - INFO - Pipeline STT metrics: duration=4.99, audio_duration=5.00
2025-03-25 17:42:04,198 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:42:04,202 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-25 17:42:04,206 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-25 17:42:04,213 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-25 17:42:04,219 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:42:07,399 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-25 17:42:07,754 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-25 17:42:07,755 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=d780b6dc07f2, end_of_utterance_delay=0.91, transcription_delay=0.55
2025-03-25 17:42:07,759 - livekit.agents - INFO - Pipeline STT metrics: duration=10.00, audio_duration=5.00
2025-03-25 17:42:10,255 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=d780b6dc07f2, ttft=2.15, input_tokens=267, output_tokens=14, tokens_per_second=5.62
2025-03-25 17:42:12,507 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:42:12,761 - livekit.agents - INFO - Pipeline STT metrics: duration=15.00, audio_duration=5.00
2025-03-25 17:42:12,823 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=d780b6dc07f2, ttfb=2.2427509999834, audio_duration=3.45
2025-03-25 17:42:14,134 - portuguese-restaurant-assistant - INFO - User speech committed: olá otávio, quero fazer 1 emenda.
2025-03-25 17:42:14,135 - portuguese-restaurant-assistant - INFO - Added user message to transcript: olá otávio, quero fazer 1 emenda.
2025-03-25 17:42:15,947 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:42:15,950 - portuguese-restaurant-assistant - INFO - Agent speech committed: Com certeza! Quais items do menu gostaria de encomendar?
2025-03-25 17:42:15,951 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Com certeza! Quais items do menu gostaria de encomendar?
2025-03-25 17:42:15,953 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:42:17,758 - livekit.agents - INFO - Pipeline STT metrics: duration=19.99, audio_duration=5.00
2025-03-25 17:42:20,215 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-25 17:42:22,194 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-25 17:42:22,556 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-25 17:42:22,558 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=2c4f2faa3aa5, end_of_utterance_delay=0.83, transcription_delay=0.47
2025-03-25 17:42:22,756 - livekit.agents - INFO - Pipeline STT metrics: duration=24.99, audio_duration=5.00
2025-03-25 17:42:24,021 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=2c4f2faa3aa5, ttft=0.61, input_tokens=304, output_tokens=24, tokens_per_second=16.48
2025-03-25 17:42:25,251 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:42:25,622 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=2c4f2faa3aa5, ttfb=1.4639019999885932, audio_duration=2.70
2025-03-25 17:42:26,927 - portuguese-restaurant-assistant - INFO - User speech committed: pode ser 1 de batata e 1 frango, por favor.
2025-03-25 17:42:26,930 - portuguese-restaurant-assistant - INFO - Added user message to transcript: pode ser 1 de batata e 1 frango, por favor.
2025-03-25 17:42:26,987 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=2c4f2faa3aa5, ttfb=1.1911888999165967, audio_duration=2.39
2025-03-25 17:42:27,759 - livekit.agents - INFO - Pipeline STT metrics: duration=29.99, audio_duration=5.00
2025-03-25 17:42:30,337 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:42:30,342 - portuguese-restaurant-assistant - INFO - Agent speech committed: Muito bem, uma dose de batata e uma de frango. A que hora deseja levantar a encomenda?
2025-03-25 17:42:30,345 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Muito bem, uma dose de batata e uma de frango. A que hora deseja levantar a encomenda?
2025-03-25 17:42:30,349 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:42:32,757 - livekit.agents - INFO - Pipeline STT metrics: duration=34.99, audio_duration=5.00
2025-03-25 17:42:33,995 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-25 17:42:34,277 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-25 17:42:34,279 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=83ae25f98064, end_of_utterance_delay=0.90, transcription_delay=0.62
2025-03-25 17:42:36,042 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=83ae25f98064, ttft=0.82, input_tokens=342, output_tokens=23, tokens_per_second=13.10
2025-03-25 17:42:37,758 - livekit.agents - INFO - Pipeline STT metrics: duration=39.99, audio_duration=5.00
2025-03-25 17:42:42,759 - livekit.agents - INFO - Pipeline STT metrics: duration=44.99, audio_duration=5.00
2025-03-25 17:42:42,902 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:42:43,681 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=83ae25f98064, ttfb=7.465660499990918, audio_duration=2.24
2025-03-25 17:42:44,475 - portuguese-restaurant-assistant - INFO - User speech committed: 5 da tarde, por favor.
2025-03-25 17:42:44,478 - portuguese-restaurant-assistant - INFO - Added user message to transcript: 5 da tarde, por favor.
2025-03-25 17:42:45,454 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=83ae25f98064, ttfb=1.5292386999353766, audio_duration=2.24
2025-03-25 17:42:47,438 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:42:47,442 - portuguese-restaurant-assistant - INFO - Agent speech committed: Perfeito, estará pronto às 17h. Em nome de quem fica a encomenda, por favor?
2025-03-25 17:42:47,446 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Perfeito, estará pronto às 17h. Em nome de quem fica a encomenda, por favor?
2025-03-25 17:42:47,449 - portuguese-restaurant-assistant - INFO - Extracted pickup time: 17:00
2025-03-25 17:42:47,452 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:42:47,757 - livekit.agents - INFO - Pipeline STT metrics: duration=49.99, audio_duration=5.00
2025-03-25 17:42:50,581 - livekit.agents - INFO - shutting down worker
2025-03-25 17:42:50,583 - livekit.agents - DEBUG - shutting down job task
2025-03-25 17:42:50,587 - livekit.agents - DEBUG - job exiting
2025-03-25 17:42:50,649 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-25 17:42:50,653 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-25 17:42:50,654 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-25 17:42:50,655 - portuguese-restaurant-assistant - INFO - Room disconnected, sending conversation transcript to Make.com
2025-03-25 17:42:50,657 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=913, llm_completion_tokens=61, tts_characters_count=270, stt_audio_duration=49.99999999999991)
2025-03-25 17:42:50,658 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-25 17:42:50,659 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-25 17:42:50,663 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-25 17:42:50,976 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-25 17:42:50,977 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-25 17:42:50,978 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-25 17:42:50,979 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-25 17:42:51,049 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:936> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-25 17:42:51,051 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:42:51,052 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-25 17:42:51,053 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-25 17:42:51,063 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:42:51,065 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:42:51,067 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:42:51,069 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-52' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:42:51,070 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:42:51,072 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-25 17:42:51,080 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-49' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-25 17:42:51,082 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-51' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-25 17:42:51,084 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-60' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-25 17:42:51,085 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:42:51,087 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:42:51,094 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-59' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:42:51,095 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-150' coro=<entrypoint.<locals>.send_transcript_on_disconnect() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:844> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:48:45,990 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:48:46,000 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-25 17:48:49,403 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:48:49,412 - livekit.agents - INFO - starting worker
2025-03-25 17:48:49,755 - livekit.agents - INFO - registered worker
2025-03-25 17:48:52,132 - livekit.agents - INFO - received job request
2025-03-25 17:48:52,197 - livekit.agents - INFO - initializing job runner
2025-03-25 17:48:52,200 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-25 17:48:52,532 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-25 17:48:52,535 - livekit.agents - INFO - job runner initialized
2025-03-25 17:48:52,536 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-25 17:48:52,538 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_fM6wGXySoWTk
2025-03-25 17:48:52,539 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:48:52,539 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-25 17:48:52,541 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-25 17:48:52,542 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-25 17:48:52,543 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-25 17:48:52,567 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-25 17:48:52,568 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-25 17:48:52,619 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-25 17:48:52,703 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-25 17:48:52,705 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-25 17:48:52,706 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-25 17:48:52,707 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-25 17:48:52,798 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-25 17:48:52,801 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-25 17:48:52,805 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-25 17:48:52,808 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-25 17:48:52,979 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-25 17:48:53,405 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-25 17:48:53,408 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-25 17:48:53,410 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-25 17:48:53,411 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-25 17:48:54,579 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-25 17:48:55,696 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-25 17:48:57,078 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:48:57,432 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=82c4ffa4eb98, ttfb=2.382790799951181, audio_duration=3.23
2025-03-25 17:49:00,285 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:49:00,287 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-25 17:49:00,288 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Restaurante Português, em que posso ajudar?
2025-03-25 17:49:00,290 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-25 17:49:00,291 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:49:00,785 - livekit.agents - INFO - Pipeline STT metrics: duration=5.08, audio_duration=5.00
2025-03-25 17:49:02,459 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-25 17:49:02,463 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-25 17:49:02,463 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=d5ae5839d406, end_of_utterance_delay=0.73, transcription_delay=0.73
2025-03-25 17:49:03,359 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=d5ae5839d406, ttft=0.57, input_tokens=259, output_tokens=11, tokens_per_second=12.33
2025-03-25 17:49:05,067 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:49:05,197 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=d5ae5839d406, ttfb=1.691876099910587, audio_duration=2.53
2025-03-25 17:49:05,879 - livekit.agents - INFO - Pipeline STT metrics: duration=10.18, audio_duration=5.10
2025-03-25 17:49:06,582 - portuguese-restaurant-assistant - INFO - User speech committed: olá boa tarde.
2025-03-25 17:49:06,586 - portuguese-restaurant-assistant - INFO - Added user message to transcript: olá boa tarde.
2025-03-25 17:49:07,577 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:49:07,582 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Como posso ser útil ao senhor?
2025-03-25 17:49:07,585 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Como posso ser útil ao senhor?
2025-03-25 17:49:07,587 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:49:10,126 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-25 17:49:10,131 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-25 17:49:10,135 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c75a7628ab98, end_of_utterance_delay=0.61, transcription_delay=0.61
2025-03-25 17:49:10,967 - livekit.agents - INFO - Pipeline STT metrics: duration=15.26, audio_duration=5.10
2025-03-25 17:49:11,051 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c75a7628ab98, ttft=0.51, input_tokens=285, output_tokens=20, tokens_per_second=22.02
2025-03-25 17:49:12,474 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:49:12,702 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c75a7628ab98, ttfb=1.6857012000400573, audio_duration=1.40
2025-03-25 17:49:15,070 - portuguese-restaurant-assistant - INFO - User speech committed: quer fazer uma encomenda por favor?
2025-03-25 17:49:15,072 - portuguese-restaurant-assistant - INFO - Added user message to transcript: quer fazer uma encomenda por favor?
2025-03-25 17:49:15,215 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c75a7628ab98, ttfb=2.152158600045368, audio_duration=2.98
2025-03-25 17:49:16,056 - livekit.agents - INFO - Pipeline STT metrics: duration=20.35, audio_duration=5.05
2025-03-25 17:49:17,809 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:49:17,815 - portuguese-restaurant-assistant - INFO - Agent speech committed: Claro, com todo o prazer! Quais são os items do menu que deseja encomendar?
2025-03-25 17:49:17,818 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Claro, com todo o prazer! Quais são os items do menu que deseja encomendar?
2025-03-25 17:49:17,822 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:49:20,727 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-25 17:49:20,731 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-25 17:49:20,735 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=377d4e7304c0, end_of_utterance_delay=0.75, transcription_delay=0.75
2025-03-25 17:49:21,139 - livekit.agents - INFO - Pipeline STT metrics: duration=25.43, audio_duration=5.10
2025-03-25 17:49:22,336 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=377d4e7304c0, ttft=0.60, input_tokens=321, output_tokens=25, tokens_per_second=15.70
2025-03-25 17:49:24,048 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-25 17:49:24,482 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=377d4e7304c0, ttfb=2.425541599979624, audio_duration=2.98
2025-03-25 17:49:25,647 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=377d4e7304c0, ttfb=1.0528053999878466, audio_duration=2.71
2025-03-25 17:49:25,676 - portuguese-restaurant-assistant - INFO - User speech committed: quero frango e umas batata.
2025-03-25 17:49:25,678 - portuguese-restaurant-assistant - INFO - Added user message to transcript: quero frango e umas batata.
2025-03-25 17:49:26,227 - livekit.agents - INFO - Pipeline STT metrics: duration=30.52, audio_duration=5.10
2025-03-25 17:49:29,713 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-25 17:49:29,715 - portuguese-restaurant-assistant - INFO - Agent speech committed: Muito bem, então um frango e uma dose de batatas. Para que hora gostaria de levantar a encomenda?
2025-03-25 17:49:29,717 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Muito bem, então um frango e uma dose de batatas. Para que hora gostaria de levantar a encomenda?
2025-03-25 17:49:29,721 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-25 17:49:31,317 - livekit.agents - INFO - Pipeline STT metrics: duration=35.61, audio_duration=5.10
2025-03-25 17:49:33,377 - livekit.agents - INFO - shutting down worker
2025-03-25 17:49:33,384 - livekit.agents - DEBUG - shutting down job task
2025-03-25 17:49:33,393 - livekit.agents - DEBUG - job exiting
2025-03-25 17:49:33,453 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-25 17:49:33,465 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-25 17:49:33,467 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=865, llm_completion_tokens=56, tts_characters_count=265, stt_audio_duration=35.54999999999993)
2025-03-25 17:49:33,470 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-25 17:49:33,471 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-25 17:49:33,480 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-25 17:49:33,820 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-25 17:49:33,824 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-25 17:49:33,829 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-25 17:49:33,832 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-25 17:49:33,957 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:935> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-25 17:49:33,968 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:49:33,975 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-47' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-25 17:49:33,981 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-25 17:49:34,029 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:49:34,033 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:49:34,037 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:49:34,040 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-52' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:49:34,042 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-25 17:49:34,045 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-25 17:49:34,063 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-49' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-25 17:49:34,066 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-51' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-25 17:49:34,070 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-60' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-25 17:49:34,073 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<SpeechStream._run.<locals>.send_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:49:34,077 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<SpeechStream._run.<locals>.recv_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-25 17:49:34,093 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-59' coro=<SpeechStream._run.<locals>.keepalive_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\deepgram\stt.py:441> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-26 09:21:59,392 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-26 09:21:59,414 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-26 09:22:03,325 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-26 09:22:03,337 - livekit.agents - INFO - starting worker
2025-03-26 09:22:03,690 - livekit.agents - INFO - registered worker
2025-03-26 12:25:50,295 - livekit.agents - WARNING - failed to connect to livekit, retrying in 0s: worker connection closed unexpectedly
2025-03-26 12:25:51,574 - livekit.agents - WARNING - failed to connect to livekit, retrying in 2s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 12:25:53,589 - livekit.agents - WARNING - failed to connect to livekit, retrying in 4s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 12:25:57,632 - livekit.agents - WARNING - failed to connect to livekit, retrying in 6s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 12:26:03,657 - livekit.agents - WARNING - failed to connect to livekit, retrying in 8s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 12:26:11,673 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 12:26:21,686 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 12:26:31,720 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 12:26:43,223 - livekit.agents - INFO - registered worker
2025-03-26 13:48:26,348 - livekit.agents - WARNING - failed to connect to livekit, retrying in 0s: worker connection closed unexpectedly
2025-03-26 13:48:26,406 - livekit.agents - WARNING - failed to connect to livekit, retrying in 2s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 13:48:28,431 - livekit.agents - WARNING - failed to connect to livekit, retrying in 4s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 13:48:32,443 - livekit.agents - WARNING - failed to connect to livekit, retrying in 6s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 13:48:38,462 - livekit.agents - WARNING - failed to connect to livekit, retrying in 8s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 13:48:46,487 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 13:48:56,505 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 13:49:06,513 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 13:49:16,532 - livekit.agents - WARNING - failed to connect to livekit, retrying in 10s: Cannot connect to host cursorquit-304ysaxl.livekit.cloud:443 ssl:default [getaddrinfo failed]
2025-03-26 13:49:27,862 - livekit.agents - INFO - registered worker
2025-03-26 13:50:13,086 - livekit.agents - INFO - shutting down worker
2025-03-26 18:37:04,022 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-26 18:37:04,027 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-26 18:37:06,420 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-26 18:37:06,425 - livekit.agents - INFO - starting worker
2025-03-26 18:37:06,964 - livekit.agents - INFO - registered worker
2025-03-26 18:37:09,779 - livekit.agents - INFO - received job request
2025-03-26 18:37:09,891 - livekit.agents - INFO - initializing job runner
2025-03-26 18:37:09,895 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-26 18:37:10,253 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-26 18:37:10,255 - livekit.agents - INFO - job runner initialized
2025-03-26 18:37:10,255 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-26 18:37:10,257 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_YURunHn5FkNo
2025-03-26 18:37:10,257 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-26 18:37:10,259 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-26 18:37:10,259 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-26 18:37:10,260 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-26 18:37:10,261 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-26 18:37:10,282 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-26 18:37:10,286 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-26 18:37:10,334 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-26 18:37:11,497 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-26 18:37:11,500 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-26 18:37:11,504 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-26 18:37:11,508 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-26 18:37:11,655 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-26 18:37:11,657 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-26 18:37:11,662 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-26 18:37:11,665 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-26 18:37:12,158 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-26 18:37:13,785 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-26 18:37:13,789 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-26 18:37:13,792 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-26 18:37:13,795 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-26 18:37:14,686 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-26 18:37:18,353 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-26 18:37:18,381 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=fc31a6a38f7d, ttfb=2.851326399948448, audio_duration=3.19
2025-03-26 18:37:18,976 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-26 18:37:21,537 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-26 18:37:21,543 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Churrascaria Quitanda, em que posso ajudar?
2025-03-26 18:37:21,546 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Churrascaria Quitanda, em que posso ajudar?
2025-03-26 18:37:21,550 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-26 18:37:21,559 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-26 18:37:24,068 - livekit.agents - INFO - Pipeline STT metrics: duration=5.09, audio_duration=5.00
2025-03-26 18:37:46,065 - livekit.agents - INFO - shutting down worker
2025-03-26 18:37:46,072 - livekit.agents - DEBUG - shutting down job task
2025-03-26 18:37:46,079 - livekit.agents - DEBUG - job exiting
2025-03-26 18:37:46,246 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-26 18:37:46,266 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=54, stt_audio_duration=4.99999999999999)
2025-03-26 18:37:46,270 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-26 18:37:46,273 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-26 18:37:46,422 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-26 18:37:46,894 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-26 18:37:46,899 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-26 18:37:46,904 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-26 18:37:46,907 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-26 18:37:47,043 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:947> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-26 18:37:47,052 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-26 18:37:47,056 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-61' coro=<SpeechStream._run.<locals>.send_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-26 18:37:47,060 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-62' coro=<SpeechStream._run.<locals>.recv_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-26 18:37:47,062 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-64' coro=<Event.wait() done, defined at C:\Python312\Lib\asyncio\locks.py:199> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-26 18:37:47,065 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-50' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-26 18:37:47,067 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-26 18:37:47,069 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-54' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-26 18:37:47,072 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-26 18:37:47,107 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-58' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-26 18:37:47,109 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-57' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-26 18:37:47,112 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-26 18:37:47,114 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-52' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-26 18:37:47,116 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-26 18:37:47,123 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-26 18:37:52,392 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-26 18:37:52,395 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-26 18:37:55,131 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-26 18:37:55,138 - livekit.agents - INFO - starting worker
2025-03-26 18:37:56,255 - livekit.agents - INFO - registered worker
2025-03-26 18:37:58,609 - livekit.agents - INFO - received job request
2025-03-26 18:37:58,792 - livekit.agents - INFO - initializing job runner
2025-03-26 18:37:58,793 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-26 18:37:59,029 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-26 18:37:59,029 - livekit.agents - INFO - job runner initialized
2025-03-26 18:37:59,039 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-26 18:37:59,041 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room call-_+351933792547_ZB7oojCJkUr4
2025-03-26 18:37:59,041 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-26 18:37:59,043 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-26 18:37:59,043 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-26 18:37:59,044 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-26 18:37:59,045 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-26 18:37:59,048 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-26 18:37:59,049 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-26 18:37:59,051 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-26 18:38:02,214 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-26 18:38:02,218 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-26 18:38:02,222 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-26 18:38:02,225 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-26 18:38:02,421 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-26 18:38:02,424 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-26 18:38:02,425 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-26 18:38:02,429 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-26 18:38:02,757 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-26 18:38:04,376 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-26 18:38:04,381 - portuguese-restaurant-assistant - INFO - Participant joined: sip_+351933792547
2025-03-26 18:38:04,383 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-26 18:38:04,386 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-26 18:38:05,434 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-26 18:38:06,968 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-26 18:38:07,482 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-26 18:38:07,898 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=ed14aa4c0835, ttfb=1.9104099001269788, audio_duration=3.28
2025-03-26 18:38:10,757 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-26 18:38:10,759 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Churrascaria Quitanda, em que posso ajudar?
2025-03-26 18:38:10,762 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Churrascaria Quitanda, em que posso ajudar?
2025-03-26 18:38:10,769 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-26 18:38:10,779 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-26 18:38:12,064 - livekit.agents - INFO - Pipeline STT metrics: duration=5.09, audio_duration=5.00
2025-03-26 18:38:13,878 - livekit.agents - INFO - shutting down worker
2025-03-26 18:38:13,885 - livekit.agents - DEBUG - shutting down job task
2025-03-26 18:38:13,896 - livekit.agents - DEBUG - job exiting
2025-03-26 18:38:13,974 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-26 18:38:13,987 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-26 18:38:13,992 - portuguese-restaurant-assistant - INFO - Room disconnected
2025-03-26 18:38:13,994 - portuguese-restaurant-assistant - INFO - Room disconnected, sending conversation transcript to Make.com
2025-03-26 18:38:13,998 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=54, stt_audio_duration=4.99999999999999)
2025-03-26 18:38:14,001 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-26 18:38:14,004 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-26 18:38:14,015 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-26 18:38:14,553 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-26 18:38:14,557 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-26 18:38:14,561 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-26 18:38:14,564 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-26 18:38:14,641 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:947> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:239, _JobProc._run_job_task.<locals>.log_exception() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\job_proc_lazy_main.py:241]>
2025-03-26 18:38:14,643 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-28' coro=<VoicePipelineAgent._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-26 18:38:14,644 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-61' coro=<SpeechStream._run.<locals>.send_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-26 18:38:14,646 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-62' coro=<SpeechStream._run.<locals>.recv_task() done, defined at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:13> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-26 18:38:14,647 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-64' coro=<Event.wait() done, defined at C:\Python312\Lib\asyncio\locks.py:199> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
2025-03-26 18:38:14,649 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-68' coro=<entrypoint.<locals>.send_transcript_on_disconnect() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:859> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-26 18:38:14,650 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-48' coro=<HumanInput._recognize_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<_GatheringFuture pending cb=[Task.task_wakeup()]>>
2025-03-26 18:38:14,651 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-50' coro=<VADStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py:16> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:104, VADStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\plugins\silero\vad.py:209]>
2025-03-26 18:38:14,652 - livekit.agents.pipeline - ERROR - Error in _recognize_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 158, in _recognize_task
    await asyncio.gather(*tasks)
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py", line 160, in _recognize_task
    await utils.aio.gracefully_cancel(*tasks)
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\__init__.py", line 12, in gracefully_cancel
    loop = asyncio.get_running_loop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop
2025-03-26 18:38:14,659 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<HumanInput._recognize_task.<locals>._stt_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:144> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-26 18:38:14,661 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-55' coro=<HumanInput._recognize_task.<locals>._vad_stream_co() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\pipeline\human_input.py:132> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at C:\Python312\Lib\asyncio\tasks.py:767]>
2025-03-26 18:38:14,663 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-52' coro=<RecognizeStream._main_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:219> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[RecognizeStream.__init__.<locals>.<lambda>() at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:204]>
2025-03-26 18:38:14,695 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='TTS._metrics_task' coro=<VADStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\vad.py:115> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-26 18:38:14,700 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-53' coro=<STTSegmentsForwarder._run() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py:64> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-26 18:38:14,701 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='STT._metrics_task' coro=<RecognizeStream._metrics_monitor_task() running at C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\stt\stt.py:249> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2025-03-26 18:38:14,702 - livekit.agents - ERROR - error in stt transcription
Traceback (most recent call last):
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
GeneratorExit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\transcription\stt_forwarder.py", line 64, in _run
    seg = await self._queue.get()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 160, in get
    getter.cancel()  # Just in case getter is not done yet.
    ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\base_events.py", line 795, in call_soon
    self._check_closed()
  File "C:\Python312\Lib\asyncio\base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-03-28 16:32:46,888 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:32:46,894 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-28 16:32:52,691 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:32:52,707 - livekit.agents - INFO - starting worker
2025-03-28 16:32:53,043 - livekit.agents - INFO - registered worker
2025-03-28 16:33:13,415 - livekit.agents - INFO - received job request
2025-03-28 16:33:13,483 - livekit.agents - INFO - initializing job runner
2025-03-28 16:33:13,485 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-28 16:33:13,896 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-28 16:33:13,896 - livekit.agents - INFO - job runner initialized
2025-03-28 16:33:13,901 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:33:13,903 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-D8DqyF3jdKeJkCvFhBCa47
2025-03-28 16:33:13,907 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:33:13,907 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:33:13,907 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-28 16:33:13,907 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-28 16:33:13,907 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-28 16:33:13,931 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-28 16:33:13,933 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-28 16:33:13,971 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-28 16:33:14,052 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-28 16:33:14,054 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-28 16:33:14,055 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-28 16:33:14,056 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-28 16:33:14,159 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-28 16:33:14,162 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-28 16:33:14,164 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-28 16:33:14,165 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-28 16:33:14,361 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-28 16:33:14,775 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-28 16:33:14,775 - portuguese-restaurant-assistant - INFO - Participant joined: virtualized-wireframe
2025-03-28 16:33:14,777 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-28 16:33:14,777 - portuguese-restaurant-assistant - INFO - Using OpenAI TTS (fallback)
2025-03-28 16:33:16,609 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-28 16:33:19,491 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-28 16:33:19,507 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=4f66d1a4e7e2, ttfb=2.812502299901098, audio_duration=3.23
2025-03-28 16:33:22,733 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:33:22,735 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Churrascaria Quitanda, em que posso ajudar?
2025-03-28 16:33:22,737 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Churrascaria Quitanda, em que posso ajudar?
2025-03-28 16:33:22,739 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-28 16:33:22,743 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-28 16:33:51,994 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-28 16:33:51,997 - livekit.agents - DEBUG - shutting down job task
2025-03-28 16:33:51,999 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-28 16:33:52,005 - livekit.agents - DEBUG - job exiting
2025-03-28 16:33:52,028 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-28 16:33:52,059 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=54, stt_audio_duration=0.0)
2025-03-28 16:33:52,062 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-28 16:33:52,065 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-28 16:33:52,130 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-28 16:33:52,426 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-28 16:33:52,433 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-28 16:33:52,439 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-28 16:33:52,441 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-28 16:33:52,443 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-28 16:34:33,481 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:34:33,493 - livekit.agents - INFO - starting worker
2025-03-28 16:34:33,503 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-28 16:34:33,828 - livekit.agents - INFO - registered worker
2025-03-28 16:34:44,443 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:34:44,448 - livekit.agents - INFO - starting worker
2025-03-28 16:34:44,803 - livekit.agents - INFO - registered worker
2025-03-28 16:35:23,263 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:35:23,291 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-28 16:35:26,889 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:35:26,902 - livekit.agents - INFO - starting worker
2025-03-28 16:35:27,217 - livekit.agents - INFO - registered worker
2025-03-28 16:35:34,672 - livekit.agents - INFO - received job request
2025-03-28 16:35:34,744 - livekit.agents - INFO - initializing job runner
2025-03-28 16:35:34,752 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-28 16:35:35,201 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-28 16:35:35,201 - livekit.agents - INFO - job runner initialized
2025-03-28 16:35:35,203 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:35:35,206 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-49dUZDfSKVhLpzjqkuUQuT
2025-03-28 16:35:35,206 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:35:35,208 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:35:35,209 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-28 16:35:35,209 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-28 16:35:35,210 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-28 16:35:35,233 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-28 16:35:35,234 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-28 16:35:35,282 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-28 16:35:35,362 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-28 16:35:35,364 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-28 16:35:35,365 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-28 16:35:35,366 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-28 16:35:35,460 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-28 16:35:35,462 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-28 16:35:35,464 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-28 16:35:35,465 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-28 16:35:35,625 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-28 16:35:35,963 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-28 16:35:35,964 - portuguese-restaurant-assistant - INFO - Participant joined: self-healing-git
2025-03-28 16:35:35,965 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-28 16:35:38,314 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: cannot import name 'generate' from 'elevenlabs' (C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\elevenlabs\__init__.py)
2025-03-28 16:35:38,334 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 664, in entrypoint
    from elevenlabs import VoiceSettings, generate, stream
ImportError: cannot import name 'generate' from 'elevenlabs' (C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\elevenlabs\__init__.py)

2025-03-28 16:35:38,337 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:599> result=None> took too long: 2.38 seconds
2025-03-28 16:35:38,339 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:599> result=None> took too long: 2.38 seconds
2025-03-28 16:36:11,697 - livekit.agents - INFO - received job request
2025-03-28 16:36:11,876 - livekit.agents - INFO - initializing job runner
2025-03-28 16:36:11,878 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-28 16:36:12,537 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-28 16:36:12,539 - livekit.agents - INFO - job runner initialized
2025-03-28 16:36:12,543 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:36:12,552 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-cqFdy2cPHQLcW6ucxdxsnA
2025-03-28 16:36:12,553 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:36:12,555 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:36:12,555 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-28 16:36:12,556 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-28 16:36:12,559 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-28 16:36:12,574 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-28 16:36:12,576 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-28 16:36:12,610 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-28 16:36:12,751 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-28 16:36:12,757 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-28 16:36:12,763 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-28 16:36:12,766 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-28 16:36:12,870 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-28 16:36:12,872 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-28 16:36:12,874 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-28 16:36:12,876 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-28 16:36:13,029 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-28 16:36:13,384 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-28 16:36:13,388 - portuguese-restaurant-assistant - INFO - Participant joined: synthetic-virtualenv
2025-03-28 16:36:13,391 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-28 16:36:15,813 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: cannot import name 'generate' from 'elevenlabs' (C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\elevenlabs\__init__.py)
2025-03-28 16:36:15,822 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 664, in entrypoint
    from elevenlabs import VoiceSettings, generate, stream
ImportError: cannot import name 'generate' from 'elevenlabs' (C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\elevenlabs\__init__.py)

2025-03-28 16:36:15,826 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:599> result=None> took too long: 2.44 seconds
2025-03-28 16:36:15,827 - livekit.agents - WARNING - Running <Task finished name='job_user_entrypoint' coro=<entrypoint() done, defined at C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py:599> result=None> took too long: 2.44 seconds
2025-03-28 16:36:26,357 - livekit.agents - DEBUG - shutting down job task
2025-03-28 16:36:26,358 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-28 16:36:26,366 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-28 16:36:26,367 - livekit.agents - DEBUG - job exiting
2025-03-28 16:36:26,371 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-28 16:36:26,372 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-28 16:36:26,372 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-28 16:36:26,385 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: RoomClosed
2025-03-28 16:36:32,259 - livekit.agents - INFO - shutting down worker
2025-03-28 16:36:32,276 - livekit.agents - DEBUG - shutting down job task
2025-03-28 16:36:32,297 - livekit.agents - DEBUG - job exiting
2025-03-28 16:36:32,388 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-28 16:36:32,415 - livekit - INFO - livekit::room:1191:livekit::room - disconnected from room with reason: ClientInitiated
2025-03-28 16:36:32,420 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-28 16:36:32,422 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-28 16:39:40,305 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:39:40,365 - livekit.agents - INFO - starting worker
2025-03-28 16:39:40,733 - livekit.agents - INFO - registered worker
2025-03-28 16:40:06,258 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:40:06,263 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-28 16:40:09,619 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:40:09,626 - livekit.agents - INFO - starting worker
2025-03-28 16:40:09,958 - livekit.agents - INFO - registered worker
2025-03-28 16:40:20,690 - livekit.agents - INFO - received job request
2025-03-28 16:40:20,747 - livekit.agents - INFO - initializing job runner
2025-03-28 16:40:20,754 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-28 16:40:21,254 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-28 16:40:21,259 - livekit.agents - INFO - job runner initialized
2025-03-28 16:40:21,262 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:40:21,264 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-RKkgV7J37mDBp3pfVWo6Yg
2025-03-28 16:40:21,264 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:40:21,264 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:40:21,264 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-28 16:40:21,270 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-28 16:40:21,273 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-28 16:40:21,300 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-28 16:40:21,302 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-28 16:40:21,365 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-28 16:40:21,494 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-28 16:40:21,497 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-28 16:40:21,499 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-28 16:40:21,500 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-28 16:40:21,594 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-28 16:40:21,594 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-28 16:40:21,594 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-28 16:40:21,594 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-28 16:40:21,762 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-28 16:40:22,202 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-28 16:40:22,205 - portuguese-restaurant-assistant - INFO - Participant joined: smart-webhook
2025-03-28 16:40:22,205 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-28 16:40:22,207 - portuguese-restaurant-assistant - ERROR - Error in entrypoint: TTS.__init__() got an unexpected keyword argument 'settings'
2025-03-28 16:40:22,211 - portuguese-restaurant-assistant - ERROR - Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\cursorquit\agent.py", line 667, in entrypoint
    tts = TTS(
          ^^^^
TypeError: TTS.__init__() got an unexpected keyword argument 'settings'

2025-03-28 16:41:38,238 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:41:38,242 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:41:38,265 - livekit.agents - INFO - starting worker
2025-03-28 16:41:38,273 - livekit.agents - ERROR - Error in _read_ipc_task
Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 35, in recv_bytes
    len_bytes = await self._reader.readexactly(4)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\streams.py", line 750, in readexactly
    raise exceptions.IncompleteReadError(incomplete, n)
asyncio.exceptions.IncompleteReadError: 0 bytes read on a total of 4 expected bytes

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\log.py", line 16, in async_fn_logs
    return await fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\cli\watcher.py", line 120, in _read_ipc_task
    msg = await channel.arecv_message(self._pch, proto.IPC_MESSAGES)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\ipc\channel.py", line 47, in arecv_message
    return _read_message(await dplx.recv_bytes(), messages)
                         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Utilizador\Desktop\livekit quit\venv\Lib\site-packages\livekit\agents\utils\aio\duplex_unix.py", line 43, in recv_bytes
    raise DuplexClosed()
livekit.agents.utils.aio.duplex_unix.DuplexClosed
2025-03-28 16:41:38,631 - livekit.agents - INFO - registered worker
2025-03-28 16:41:51,126 - livekit.agents - INFO - received job request
2025-03-28 16:41:51,223 - livekit.agents - INFO - initializing job runner
2025-03-28 16:41:51,223 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-28 16:41:51,959 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-28 16:41:51,959 - livekit.agents - INFO - job runner initialized
2025-03-28 16:41:52,398 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:41:52,398 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-RKkgV7J37mDBp3pfVWo6Yg
2025-03-28 16:41:52,398 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:41:52,398 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:41:52,406 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-28 16:41:52,406 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-28 16:41:52,406 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-28 16:41:52,430 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-28 16:41:52,438 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-28 16:41:52,487 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-28 16:41:52,623 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-28 16:41:52,625 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-28 16:41:52,626 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-28 16:41:52,627 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-28 16:41:52,717 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-28 16:41:52,718 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-28 16:41:52,719 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-28 16:41:52,722 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-28 16:41:52,881 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-28 16:41:53,288 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-28 16:41:53,290 - portuguese-restaurant-assistant - INFO - Participant joined: smart-webhook
2025-03-28 16:41:53,291 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-28 16:41:53,292 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with Ana voice
2025-03-28 16:41:53,970 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:41:53,976 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-28 16:41:54,152 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-28 16:41:54,223 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-28 16:41:55,384 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=3e679de39306, ttfb=0.4686961998231709, audio_duration=3.53
2025-03-28 16:41:55,663 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-28 16:41:59,126 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:41:59,150 - livekit.agents - INFO - starting worker
2025-03-28 16:41:59,199 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:41:59,202 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Churrascaria Quitanda, em que posso ajudar?
2025-03-28 16:41:59,203 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Churrascaria Quitanda, em que posso ajudar?
2025-03-28 16:41:59,206 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-28 16:41:59,211 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-28 16:41:59,460 - livekit.agents - INFO - registered worker
2025-03-28 16:42:22,187 - livekit.agents - INFO - shutting down worker
2025-03-28 16:42:27,539 - livekit.agents - INFO - shutting down worker
2025-03-28 16:42:28,665 - livekit.agents - DEBUG - shutting down job task
2025-03-28 16:42:28,669 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-28 16:42:28,676 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-28 16:42:28,678 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-28 16:42:28,681 - livekit.agents - DEBUG - job exiting
2025-03-28 16:42:28,687 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=0, llm_completion_tokens=0, tts_characters_count=54, stt_audio_duration=0.0)
2025-03-28 16:42:28,688 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-28 16:42:28,690 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-28 16:42:28,750 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-28 16:42:29,197 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-28 16:42:29,205 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-28 16:42:29,209 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-28 16:42:29,212 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
2025-03-28 16:42:38,829 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:42:38,835 - livekit.agents - DEV - Watching C:\Users\Utilizador\Desktop\livekit quit\cursorquit
2025-03-28 16:42:44,381 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:42:44,392 - livekit.agents - INFO - starting worker
2025-03-28 16:42:44,725 - livekit.agents - INFO - registered worker
2025-03-28 16:43:00,442 - livekit.agents - INFO - received job request
2025-03-28 16:43:00,511 - livekit.agents - INFO - initializing job runner
2025-03-28 16:43:00,517 - portuguese-restaurant-assistant - INFO - Preloading VAD model...
2025-03-28 16:43:01,125 - portuguese-restaurant-assistant - INFO - VAD model preloaded successfully
2025-03-28 16:43:01,126 - livekit.agents - INFO - job runner initialized
2025-03-28 16:43:01,128 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-28 16:43:01,131 - portuguese-restaurant-assistant - INFO - Starting Portuguese restaurant voice assistant for room sbx-16jzjr-NsmbwWK6S2KFYTWUD6pChd
2025-03-28 16:43:01,132 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:43:01,132 - portuguese-restaurant-assistant - INFO - Initialized simplified interaction tracker
2025-03-28 16:43:01,133 - portuguese-restaurant-assistant - INFO - Initialized conversation tracker for order details and transcript
2025-03-28 16:43:01,135 - portuguese-restaurant-assistant - INFO - Setting up assistant system prompt
2025-03-28 16:43:01,135 - portuguese-restaurant-assistant - INFO - Connecting to LiveKit room...
2025-03-28 16:43:01,142 - livekit - INFO - livekit_ffi::server:138:livekit_ffi::server - initializing ffi server v0.12.16
2025-03-28 16:43:01,144 - livekit - INFO - livekit_ffi::cabi:36:livekit_ffi::cabi - initializing ffi server v0.12.16
2025-03-28 16:43:01,170 - livekit - INFO - livekit_api::signal_client::signal_stream:96:livekit_api::signal_client::signal_stream - connecting to wss://cursorquit-304ysaxl.livekit.cloud/rtc?sdk=python&protocol=15&auto_subscribe=0&adaptive_stream=0&version=0.22.0&access_token=...
2025-03-28 16:43:01,253 - livekit - DEBUG - rustls::anchors:150:rustls::anchors - add_parsable_certificates processed 39 valid and 0 invalid certs
2025-03-28 16:43:01,254 - livekit - DEBUG - tokio_tungstenite::tls::encryption::rustls:103:tokio_tungstenite::tls::encryption::rustls - Added 39/39 native root certificates (ignored 0)
2025-03-28 16:43:01,255 - livekit - DEBUG - rustls::client::hs:73:rustls::client::hs - No cached session for DnsName("cursorquit-304ysaxl.livekit.cloud")
2025-03-28 16:43:01,257 - livekit - DEBUG - rustls::client::hs:132:rustls::client::hs - Not resuming any session
2025-03-28 16:43:01,364 - livekit - DEBUG - rustls::client::hs:615:rustls::client::hs - Using ciphersuite TLS13_AES_128_GCM_SHA256
2025-03-28 16:43:01,365 - livekit - DEBUG - rustls::client::tls13:142:rustls::client::tls13 - Not resuming
2025-03-28 16:43:01,366 - livekit - DEBUG - rustls::client::tls13:381:rustls::client::tls13 - TLS1.3 encrypted extensions: []
2025-03-28 16:43:01,367 - livekit - DEBUG - rustls::client::hs:472:rustls::client::hs - ALPN protocol is None
2025-03-28 16:43:01,559 - livekit - DEBUG - tungstenite::handshake::client:95:tungstenite::handshake::client - Client handshake done.
2025-03-28 16:43:01,941 - portuguese-restaurant-assistant - INFO - Waiting for a participant to join...
2025-03-28 16:43:01,942 - portuguese-restaurant-assistant - INFO - Participant joined: immutable-container
2025-03-28 16:43:01,943 - portuguese-restaurant-assistant - INFO - Initializing voice assistant...
2025-03-28 16:43:01,943 - portuguese-restaurant-assistant - INFO - Using ElevenLabs TTS with Ana voice
2025-03-28 16:43:02,713 - portuguese-restaurant-assistant - INFO - Starting voice assistant...
2025-03-28 16:43:02,805 - livekit.agents - DEBUG - http_session(): creating a new httpclient ctx
2025-03-28 16:43:03,491 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=9b88cc1aec00, ttfb=0.4833539999090135, audio_duration=3.53
2025-03-28 16:43:03,520 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-28 16:43:07,041 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:43:07,043 - portuguese-restaurant-assistant - INFO - Agent speech committed: Boa tarde! Churrascaria Quitanda, em que posso ajudar?
2025-03-28 16:43:07,044 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Boa tarde! Churrascaria Quitanda, em que posso ajudar?
2025-03-28 16:43:07,047 - portuguese-restaurant-assistant - INFO - Extracted customer name: em que
2025-03-28 16:43:07,050 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-28 16:43:24,960 - livekit.plugins.silero - WARNING - inference is slower than realtime
2025-03-28 16:43:27,965 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:43:27,967 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-28 16:43:27,967 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=71b775e8cb71, end_of_utterance_delay=0.79, transcription_delay=0.79
2025-03-28 16:43:29,393 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=71b775e8cb71, ttft=0.94, input_tokens=432, output_tokens=33, tokens_per_second=23.20
2025-03-28 16:43:29,676 - livekit.agents - INFO - Pipeline STT metrics: duration=5.06, audio_duration=5.00
2025-03-28 16:43:30,594 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-28 16:43:30,783 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=71b775e8cb71, ttfb=1.6596214999444783, audio_duration=9.95
2025-03-28 16:43:32,272 - portuguese-restaurant-assistant - INFO - User speech committed: quero frango por favor.
2025-03-28 16:43:32,277 - portuguese-restaurant-assistant - INFO - Added user message to transcript: quero frango por favor.
2025-03-28 16:43:34,767 - livekit.agents - INFO - Pipeline STT metrics: duration=10.15, audio_duration=5.10
2025-03-28 16:43:39,859 - livekit.agents - INFO - Pipeline STT metrics: duration=15.24, audio_duration=5.10
2025-03-28 16:43:40,550 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:43:40,552 - portuguese-restaurant-assistant - INFO - Agent speech committed: Certamente! Temos Frango do Churrasco no nosso menu. Gostaria de acompanhar com batatas fritas, arroz, salada ou broa?
2025-03-28 16:43:40,554 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Certamente! Temos Frango do Churrasco no nosso menu. Gostaria de acompanhar com batatas fritas, arroz, salada ou broa?
2025-03-28 16:43:40,556 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-28 16:43:44,950 - livekit.agents - INFO - Pipeline STT metrics: duration=20.33, audio_duration=5.05
2025-03-28 16:43:45,125 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:43:45,432 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:43:46,469 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-28 16:43:46,470 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=5731714f446e, end_of_utterance_delay=0.19, transcription_delay=0.00
2025-03-28 16:43:47,012 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:43:47,207 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-28 16:43:47,209 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:43:47,212 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=5731714f446e, ttft=0.45, input_tokens=0, output_tokens=0, tokens_per_second=0.00
2025-03-28 16:43:49,288 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-28 16:43:49,290 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=b6e1d7cdeb52, end_of_utterance_delay=0.19, transcription_delay=0.00
2025-03-28 16:43:50,029 - livekit.agents - INFO - Pipeline STT metrics: duration=25.41, audio_duration=5.10
2025-03-28 16:43:50,217 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:43:50,218 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-28 16:43:50,219 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-28 16:43:50,220 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=179e0f799090, end_of_utterance_delay=1.12, transcription_delay=1.12
2025-03-28 16:43:50,221 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:43:50,247 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=b6e1d7cdeb52, ttft=0.76, input_tokens=0, output_tokens=0, tokens_per_second=0.00
2025-03-28 16:43:52,157 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=179e0f799090, ttft=0.61, input_tokens=499, output_tokens=49, tokens_per_second=25.32
2025-03-28 16:43:52,306 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-28 16:43:53,656 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=179e0f799090, ttfb=1.2760989000089467, audio_duration=12.88
2025-03-28 16:43:53,996 - portuguese-restaurant-assistant - INFO - User speech committed: dose ser, portanto, frango, uma batata, e uma salada mas quero o frango com picante por favor.
2025-03-28 16:43:53,998 - portuguese-restaurant-assistant - INFO - Added user message to transcript: dose ser, portanto, frango, uma batata, e uma salada mas quero o frango com picante por favor.
2025-03-28 16:43:55,119 - livekit.agents - INFO - Pipeline STT metrics: duration=30.50, audio_duration=5.10
2025-03-28 16:44:00,209 - livekit.agents - INFO - Pipeline STT metrics: duration=35.59, audio_duration=5.10
2025-03-28 16:44:05,193 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:44:05,198 - portuguese-restaurant-assistant - INFO - Agent speech committed: Peço desculpa, mas não conseguimos preparar o frango com picante, apenas a nossa versão padrão do Frango do Churrasco. A dose inclui batatas fritas e salada. Posso registar o pedido assim?
2025-03-28 16:44:05,202 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Peço desculpa, mas não conseguimos preparar o frango com picante, apenas a nossa versão padrão do Frango do Churrasco. A dose inclui batatas fritas e salada. Posso registar o pedido assim?
2025-03-28 16:44:05,207 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-28 16:44:05,296 - livekit.agents - INFO - Pipeline STT metrics: duration=40.68, audio_duration=5.05
2025-03-28 16:44:07,670 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:44:07,676 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-28 16:44:07,679 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=c2246ea6038a, end_of_utterance_delay=0.57, transcription_delay=0.56
2025-03-28 16:44:08,902 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=c2246ea6038a, ttft=0.40, input_tokens=563, output_tokens=45, tokens_per_second=37.15
2025-03-28 16:44:09,865 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-28 16:44:09,993 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=c2246ea6038a, ttfb=1.6920380999799818, audio_duration=12.67
2025-03-28 16:44:10,377 - livekit.agents - INFO - Pipeline STT metrics: duration=45.76, audio_duration=5.10
2025-03-28 16:44:11,498 - portuguese-restaurant-assistant - INFO - User speech committed: sim, pode ser, pode ser.
2025-03-28 16:44:11,502 - portuguese-restaurant-assistant - INFO - Added user message to transcript: sim, pode ser, pode ser.
2025-03-28 16:44:15,468 - livekit.agents - INFO - Pipeline STT metrics: duration=50.85, audio_duration=5.10
2025-03-28 16:44:20,558 - livekit.agents - INFO - Pipeline STT metrics: duration=55.94, audio_duration=5.10
2025-03-28 16:44:22,530 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:44:22,532 - portuguese-restaurant-assistant - INFO - Agent speech committed: Perfeito, ficou registado: uma dose de Frango do Churrasco com batatas fritas e salada. A que horas pretende fazer o levantamento? E o nome para a encomenda, por favor.
2025-03-28 16:44:22,533 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: Perfeito, ficou registado: uma dose de Frango do Churrasco com batatas fritas e salada. A que horas pretende fazer o levantamento? E o nome para a encomenda, por favor.
2025-03-28 16:44:22,534 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-28 16:44:25,646 - livekit.agents - INFO - Pipeline STT metrics: duration=61.03, audio_duration=5.05
2025-03-28 16:44:27,697 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:44:27,731 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:44:28,908 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-28 16:44:28,911 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=714711e30bc0, end_of_utterance_delay=0.20, transcription_delay=0.00
2025-03-28 16:44:29,285 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:44:29,287 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-28 16:44:29,291 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-28 16:44:29,295 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=2aae2bdd683e, end_of_utterance_delay=0.59, transcription_delay=0.58
2025-03-28 16:44:29,302 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:44:29,345 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=714711e30bc0, ttft=-1.00, input_tokens=0, output_tokens=0, tokens_per_second=0.00
2025-03-28 16:44:30,736 - livekit.agents - INFO - Pipeline STT metrics: duration=66.12, audio_duration=5.10
2025-03-28 16:44:31,147 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=2aae2bdd683e, ttft=0.92, input_tokens=630, output_tokens=28, tokens_per_second=15.21
2025-03-28 16:44:31,892 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-28 16:44:32,014 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=2aae2bdd683e, ttfb=1.4621119000948966, audio_duration=7.94
2025-03-28 16:44:33,466 - portuguese-restaurant-assistant - INFO - User speech committed: pode ser em nome de nuno, queira, para a a tarde.
2025-03-28 16:44:33,471 - portuguese-restaurant-assistant - INFO - Added user message to transcript: pode ser em nome de nuno, queira, para a a tarde.
2025-03-28 16:44:35,818 - livekit.agents - INFO - Pipeline STT metrics: duration=71.20, audio_duration=5.10
2025-03-28 16:44:38,918 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-28 16:44:38,925 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:44:38,928 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-28 16:44:40,000 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:44:40,908 - livekit.agents - INFO - Pipeline STT metrics: duration=76.29, audio_duration=5.10
2025-03-28 16:44:41,098 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-28 16:44:41,099 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=7d1c6afe351c, end_of_utterance_delay=0.19, transcription_delay=0.00
2025-03-28 16:44:41,624 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:44:41,625 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-28 16:44:41,626 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-28 16:44:41,627 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=d98dc740c27b, end_of_utterance_delay=0.72, transcription_delay=0.72
2025-03-28 16:44:41,629 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:44:41,659 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=7d1c6afe351c, ttft=0.43, input_tokens=0, output_tokens=0, tokens_per_second=0.00
2025-03-28 16:44:42,519 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=d98dc740c27b, ttft=0.47, input_tokens=673, output_tokens=27, tokens_per_second=30.42
2025-03-28 16:44:42,935 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-28 16:44:43,350 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=d98dc740c27b, ttfb=0.5667154002003372, audio_duration=7.29
2025-03-28 16:44:44,460 - portuguese-restaurant-assistant - INFO - User speech committed: não não não não. para às cinco da tarde.
2025-03-28 16:44:44,468 - portuguese-restaurant-assistant - INFO - Added user message to transcript: não não não não. para às cinco da tarde.
2025-03-28 16:44:45,999 - livekit.agents - INFO - Pipeline STT metrics: duration=81.38, audio_duration=5.05
2025-03-28 16:44:49,544 - livekit.agents.pipeline - DEBUG - received user transcript
2025-03-28 16:44:49,546 - livekit.agents.pipeline - DEBUG - agent interrupted
2025-03-28 16:44:49,547 - livekit.agents.pipeline - DEBUG - validated agent reply
2025-03-28 16:44:49,550 - livekit.agents - INFO - Pipeline EOU metrics: sequence_id=833fde3166ab, end_of_utterance_delay=0.77, transcription_delay=0.76
2025-03-28 16:44:49,592 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:44:49,594 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-28 16:44:50,101 - livekit.agents - INFO - Pipeline LLM metrics: sequence_id=833fde3166ab, ttft=0.42, input_tokens=705, output_tokens=7, tokens_per_second=12.79
2025-03-28 16:44:50,520 - livekit.agents.pipeline - DEBUG - speech playout started
2025-03-28 16:44:50,620 - livekit.agents - INFO - Pipeline TTS metrics: sequence_id=833fde3166ab, ttfb=0.5314810001291335, audio_duration=2.14
2025-03-28 16:44:51,089 - livekit.agents - INFO - Pipeline STT metrics: duration=86.47, audio_duration=5.10
2025-03-28 16:44:52,217 - portuguese-restaurant-assistant - INFO - User speech committed: obrigado.
2025-03-28 16:44:52,220 - portuguese-restaurant-assistant - INFO - Added user message to transcript: obrigado.
2025-03-28 16:44:52,667 - livekit.agents.pipeline - DEBUG - speech playout finished
2025-03-28 16:44:52,668 - portuguese-restaurant-assistant - INFO - Agent speech committed: De nada. Até logo!
2025-03-28 16:44:52,670 - portuguese-restaurant-assistant - INFO - Added assistant message to transcript: De nada. Até logo!
2025-03-28 16:44:52,673 - livekit.agents.pipeline - DEBUG - committed agent speech
2025-03-28 16:44:56,169 - livekit.agents - INFO - Pipeline STT metrics: duration=91.55, audio_duration=5.10
2025-03-28 16:45:21,463 - livekit.agents - DEBUG - shutting down job task
2025-03-28 16:45:21,479 - livekit.agents - DEBUG - job exiting
2025-03-28 16:45:21,479 - livekit - DEBUG - tungstenite::protocol:666:tungstenite::protocol - Received close frame: Some(CloseFrame { code: Normal, reason: "" })
2025-03-28 16:45:21,494 - portuguese-restaurant-assistant - INFO - Usage summary: UsageSummary(llm_prompt_tokens=3502, llm_completion_tokens=189, tts_characters_count=746, stt_audio_duration=91.49999999999983)
2025-03-28 16:45:21,494 - livekit - DEBUG - tungstenite::protocol:683:tungstenite::protocol - Replying to close with Frame { header: FrameHeader { is_final: true, rsv1: false, rsv2: false, rsv3: false, opcode: Control(Close), mask: None }, payload: [3, 232] }
2025-03-28 16:45:21,500 - portuguese-restaurant-assistant - INFO - Sending conversation transcript to Make.com webhook
2025-03-28 16:45:21,505 - portuguese-restaurant-assistant - INFO - Sending transcript to Make.com webhook: https://hook.eu2.make.com/bsguyya5mpx4j3nnq715lmetg3jer76k
2025-03-28 16:45:21,527 - livekit - WARNING - livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"" UnknownReason Resume
2025-03-28 16:45:21,569 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): hook.eu2.make.com:443
2025-03-28 16:45:21,916 - urllib3.connectionpool - DEBUG - https://hook.eu2.make.com:443 "POST /bsguyya5mpx4j3nnq715lmetg3jer76k HTTP/1.1" 200 8
2025-03-28 16:45:21,929 - portuguese-restaurant-assistant - INFO - Transcript successfully sent to Make.com
2025-03-28 16:45:21,933 - portuguese-restaurant-assistant - INFO - Transcript sent: True
2025-03-28 16:45:21,933 - livekit.agents - DEBUG - http_session(): closing the httpclient ctx
